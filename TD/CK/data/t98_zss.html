zk.load('zul,zul.layout, zul.inp, zul.tab, zul.menu, zul.box',function(){if(zk._p=zkpi('zss'))try{
(function(){function k(){if(zkS.t(zss.Spreadsheet.scrollWidth)){return}var p=document.body,r=jq('<div style="position:absolute;top:0px;left:0px;width:80px;height:50px;overflow:auto;"></div>')[0],q=jq('<div style="width:100px;height:100px;overflow: scroll;"></div>')[0];r.appendChild(q);p.appendChild(r);zss.Spreadsheet.scrollWidth=(r.offsetWidth-r.clientWidth);if(zss.Spreadsheet.scrollWidth==0){zss.Spreadsheet.scrollWidth=r.offsetHeight-r.clientHeight}p.removeChild(r);return}function l(s,p,r,q){s.sheetCtrl._skipMove=r.sk;s.sheetCtrl._cmdCellUpdate(p,r);if(q){zkS.doCallback(q)}delete s.sheetCtrl._skipMove}function f(y,x,q){var r=y._cacheCtrl.getSelectedSheet(),v=x.type;if(r&&v!="ack"){var u=x.data,w=x.top,p=x.left,s=w+x.height-1,t=p+x.width-1;r.update(u);y.sheetCtrl._cmdBlockUpdate(v,u.dir,w,p,s,t)}if(q){zkS.doCallback(q)}}function m(q,r,p){q._cmdInsertRC(r);if(p!=""){zkS.doCallback(p)}}function b(q,r,p){q._cmdRemoveRC(r,true);if(p!=""){zkS.doCallback(p)}}function c(q,r,p){q._cmdMerge(jq.evalJSON(r),true);if(p!=""){zkS.doCallback(p)}}function j(q,r,p){q._cmdSize(r,true);if(p!=""){zkS.doCallback(p)}}function o(p,q){p._cmdMaxrow(q)}function i(p,q){p._cmdMaxcolumn(q)}function g(r){var p=document.getElementsByTagName("head")[0];for(var q=p.firstChild;q;q=q.nextSibling){if(q.id==r){return q}}return null}function a(q,u){var p=document.getElementsByTagName("head")[0],s=document.createElement("style"),t;jq(s).attr("type","text/css");if(u){jq(s).attr("id",u)}if(zk.ie&&zk.ie<11){p.appendChild(s);t=s.styleSheet;t.cssText=q}else{try{s.appendChild(document.createTextNode(q))}catch(r){s.cssText=q}p.appendChild(s);t=e(s)}return t}function h(q){var p=document.getElementById(q);if(p&&p.type=="text/css"){if(zk.ie>=10){p.removeAttribute("href")}p.parentNode.removeChild(p)}}function e(){if(zk.ie&&zk.ie<11){return function(p){return p.styleSheet}}else{return function(p){return p.sheet}}}function n(p){if(zk.mac&&p.metaKey){p.ctrlKey=true;p.data.ctrlKey=true}return p}var d=zss.Spreadsheet=zk.$extends(zul.wgt.Div,{_ctrlPasteDown:false,_linkToNewTab:true,_cellPadding:2,_protect:false,_maxRows:20,_maxColumns:10,_rowFreeze:-1,_columnFreeze:-1,_rowHeight:20,_clientCacheDisabled:false,_topPanelHeight:20,_leftPanelWidth:36,_maxRenderedCellSize:8000,_displayGridlines:true,_showContextMenu:false,_selectionRect:null,_focusRect:null,_highLightRect:null,_colorPickerExUsed:false,$init:function(){this.$supers(d,"$init",arguments);this.appendChild(this.cave=new zul.layout.Borderlayout({vflex:true,sclass:"zscave"}));this._onResponseCallback=[]},$define:{clientCacheDisabled:null,dataBlockUpdate:_dataUpdate=function(p){var s=this.sheetCtrl;if(!s){return}var r=p[0],q=jq.evalJSON(p[2]);if(s._initiated){f(this,q,r)}else{s.addSSInitLater(f,this,q,r)}},dataBlockUpdateJump:_dataUpdate,dataBlockUpdateEast:_dataUpdate,dataBlockUpdateWest:_dataUpdate,dataBlockUpdateSouth:_dataUpdate,dataBlockUpdateNorth:_dataUpdate,dataBlockUpdateError:_dataUpdate,dataUpdate:_updateCell=function(p){var s=this.sheetCtrl;if(!s){return}var r=p[0],q=p[1],t=p[2];if(s._initiated){l(this,q,t,r)}else{s.addSSInitLater(l,this,q,t,r)}},dataUpdateStart:_updateCell,dataUpdateCancel:_updateCell,dataUpdateStop:_updateCell,dataUpdateRetry:_updateCell,redrawWidget:function(p){var q=this.sheetCtrl;if(!q){return}var s=p[0],t=p[1],r=function(){var u=zk.Widget.$(t);if(u){u.redrawWidgetTo(q)}};if(!this.isSheetCSSReady()){q.addSSInitLater(r)}else{r()}},insertRowColumn:function(p){var r=this.sheetCtrl;if(!r){return}var q=p[0],s=p[2],r=this.sheetCtrl;if(r._initiated){m(r,s,q)}else{r.addSSInitLater(m,r,s,q)}},removeRowColumn:function(p){var r=r=this.sheetCtrl;if(!r){return}var q=p[0],s=p[2];if(r._initiated){b(r,s,q)}else{r.addSSInitLater(b,r,s,q)}},mergeCell:function(p){var r=this.sheetCtrl;if(!r){return}var q=p[0],s=p[2];if(r._initiated){c(r,s,q)}else{r.addSSInitLater(c,r,s,q)}},columnSize:_size=function(p){var q=this.sheetCtrl;if(!q){return}var r=p[2];if(q._initiated){j(q,r)}else{q.addSSInitLater(j,q,r)}},protect:function(q){var r=this.sheetCtrl;if(r){r.fireProtectSheet(q);var p=r.getLastSelection();if(q){if(!r.isRangeSelectable(p.left,p.top,p.right,p.bottom)){r.hideCellFocus();r.hideCellSelection()}}else{var s=r.getLastFocus();r.moveCellFocus(s.row,s.column,true);r.showCellSelection()}}if(this._sheetBar){this._sheetBar.getSheetSelector().setProtectSheetCheckmark(q)}},rowSize:_size,preloadRowSize:null,preloadColumnSize:null,initRowSize:null,initColumnSize:null,maxRenderedCellSize:null,maxRows:function(p){if(this.sheetCtrl){this.sheetCtrl._cmdMaxrow(p)}},maxColumns:function(p){if(this.sheetCtrl){this.sheetCtrl._cmdMaxcolumn(p)}},rowFreeze:null,columnFreeze:null,columntitle:null,rowtitle:null,rowHeight:null,columnWidth:null,topPanelHeight:null,leftPanelWidth:null,cellPadding:null,scss:function(p){var q=this.getCSS();if(q&&this.bindLevel>=0){q.href=p}},sheetId:function(w,s,u){this._invalidatedSheetId=false;var v=this.sheetCtrl,q=this._cacheCtrl,t=this._sheetBar,r=t?t.getSheetSelector():null;if(r){r.setSelectedSheet(w)}if(v&&q&&q.getSelectedSheet().sheetId!=w){if(!s){q.setSelectedSheetBy(w)}v.doSheetSelected(u)}var p=this._loadSheetStart;if(p){this._loadSheetStart=false}},displayGridlines:function(p){var q=this.sheetCtrl;if(!q){return}if(this.isSheetCSSReady()){q.setDisplayGridlines(p)}else{q.addSSInitLater(function(){q.setDisplayGridlines(p)})}},mergeRange:null,autoFilter:null,csc:null,csr:null,width:function(p){var q=this.sheetCtrl;if(q){q.resizeTo(p,null)}},height:function(p){var q=this.sheetCtrl;if(q){q.resizeTo(null,p)}},rowHeadHidden:null,columnHeadHidden:null,showToolbar:function(r){var q=this._toolbar;if(!q&&r){var p=this._toolbar=new zss.Toolbar(this),t=this.getToolbarPanel();t.appendChild(p);t.setHeight(p.getSize())}else{if(q){var s=q.isVisible();if(s!=r){q.setVisible(r);this.getToolbarPanel().setVisible(r);zUtl.fireSized(this,-1)}}}},actionDisabled:function(q){var p=this._toolbar;if(p){p.setDisabled(q)}if(this.getShowContextMenu()){var r=this.sheetCtrl;if(r){r.setActionDisabled(q)}}var s=this._sheetBar;if(s){s.setDisabled(q)}},showFormulabar:function(q){var p=this._formulabar;if(!p&&q){this.cave.appendChild(this._formulabar=new zss.Formulabar(this))}else{if(p){p.setVisible(q)}}},showSheetbar:function(q){var p=this._sheetBar;if(!p&&q){this.cave.appendChild(this._sheetBar=new zss.Sheetbar(this))}else{if(p){p.setVisible(q)}}},showContextMenu:null,sheetLabels:function(p){var q=this._sheetBar;if(q){q.getSheetSelector().setSheetLabels(p)}},copysrc:null,doPasteFromServer:null,colorPickerExUsed:null,keepCellSelection:false,ignoreAutoHeight:false,showAddRow:function(q){if(this._addRow!=q){this._addRow=q;var p=this._sheetBar;if(p&&p.isVisible()){p.cave.addRowButton.setVisible(q)}}},showAddColumn:function(q){if(this._addColumn!=q){this._addColumn=q;var p=this._sheetBar;if(p&&p.isVisible()){p.cave.addColButton.setVisible(q)}}}},setSelectionRect:function(p){this._selectionRect=this._narrowRect(p)},getSelectionRect:function(){return this._selectionRect},setFocusRect:function(p){this._focusRect=this._narrowRect(p)},getFocusRect:function(){return this._focusRect},setHighLightRect:function(p){this._highLightRect=this._narrowRect(p)},getHighLightRect:function(){return this._highLightRect},_narrowRect:function(t){var s=t.split(",");var v=zk.parseInt(s[0]);var u=zk.parseInt(s[1]);var q=zk.parseInt(s[2]);var p=zk.parseInt(s[3]);if(q>this._maxColumns-1){q=this._maxColumns-1}if(p>this._maxRows-1){p=this._maxRows-1}return v+","+u+","+q+","+p},clearCachedSize_:function(){this.getToolbarPanel().clearCachedSize_();this.cave.clearCachedSize_();this.$supers(zss.Spreadsheet,"clearCachedSize_",arguments)},getToolbarPanel:function(){var p=this._toolbarPanel;if(!p){p=this._toolbarPanel=new zul.layout.Borderlayout({vflex:"min"});this.insertBefore(p,this.firstChild)}return p},getSheetCSSId:function(){return this.uuid+"-sheet"},getSelectorPrefix:function(){return"#"+this.uuid},isSheetCSSReady:function(){if(this._invalidatedSheetId){return false}return !!zcss.findRule(this.getSelectorPrefix()+" .zs_indicator_"+this.getSheetId(),this.getSheetCSSId())},setActiveRange:function(r){var t=this._cacheCtrl;if(!t){this._cacheCtrl=t=new zss.CacheCtrl(this,r);var p=new zul.layout.Center({border:0});p.appendChild(this.sheetCtrl=new zss.SSheetCtrl(this));this.cave.appendChild(p)}else{var s=this.sheetCtrl,q;if(s){t.setSelectedSheet(r);this._triggerContentsChanged=true}}},syncWidgetPos:function(v,p){var t=this.$n("wp"),s=jq(this.$n("wp")).children(".zswidget"),r=this.sheetCtrl,q=s.length;while(q--){var w=s[q],u=zk.Widget.$(w.id);if(u&&((v>=0&&u.getRow()>=v)||(p>=0&&u.getCol()>=p))){u.adjustLocation()}}},setRetrieveFocus:function(q){var r=this.sheetCtrl;if(!r){return}var p=typeof q==="string"?jq.evalJSON(q):q;if(this.isSheetCSSReady()){r._cmdRetriveFocus(p)}else{r.addSSInitLater(function(){r._cmdRetriveFocus(p)})}},setCellFocus:function(p){var q=this.sheetCtrl;if(!q||q.isSwitchingSheet){return}if(this.isSheetCSSReady()){q._cmdCellFocus(p)}else{q.addSSInitLater(function(){q._cmdCellFocus(p)})}},focus:function(q){if(zk.ie&&zk.ie<11){var p=this;var r=p.sheetCtrl;if(r&&r._initiated){r.dp.gainFocus(q)}}else{if(this.sheetCtrl){this.sheetCtrl.dp.gainFocus(q)}}},hasFocus:function(){return jq.isAncestor(this.$n(),document.activeElement)},moveEditorFocus:function(t,r,p,s,q){if(this.sheetCtrl){this.sheetCtrl.moveEditorFocus(t,r,p,zk.parseInt(s),zk.parseInt(q))}},removeEditorFocus:function(p){if(this.sheetCtrl){this.sheetCtrl.removeEditorFocus(p)}},setSelectionHighlight:function(p){var q=this.sheetCtrl;if(!q){return}if(this.isSheetCSSReady()){q._cmdHighlight(p)}else{q.addSSInitLater(function(){q._cmdHighlight(p)})}},setSelection:function(p){var q=this.sheetCtrl;if(!q||q.isSwitchingSheet){return}var s=this,r=function(){if(s._ctrlPasteDown){s._afterPasteCallback=function(){q._cmdSelection(p)}}else{q._cmdSelection(p)}};if(this.isSheetCSSReady()){r()}else{q.addSSInitLater(function(){r()})}},_isFireCellEvt:function(p){var q=zss.Spreadsheet.CELL_MOUSE_EVENT_NAME[p];if("onCellFilter"==q){return true}return q&&this.isListen(q,{asapOnly:true})},_isFireHeaderEvt:function(p){var q=zss.Spreadsheet.HEADER_MOUSE_EVENT_NAME[p];return q&&this.isListen(q,{asapOnly:true})},fireHeaderEvt:function(x,w,u,r,B,q,z,y){var t=this.getSheetId(),p={type:x,shx:w,shy:u,key:r,sheetId:t,row:B,col:q,mx:z,my:y};if(this._isFireHeaderEvt(x)){var A=this;setTimeout(function(){A.fire("onZSSHeaderMouse",p,{toServer:true})},0)}var s=zss.Spreadsheet.HEADER_MOUSE_EVENT_NAME[x];if(s){var v=new zk.Event(this,s,p);v.auStopped=true;this.fireX(v)}},fireCellEvt:function(x,w,u,r,C,q,A,z,y){if("af"==x&&this.isProtect()&&!this.sheetCtrl._wgt.allowAutoFilter){return}var t=this.getSheetId(),p={type:x,shx:w,shy:u,key:r,sheetId:t,row:C,col:q,mx:A,my:z};if(y){p.field=y}if(this._isFireCellEvt(x)){var B=this;setTimeout(function(){B.fire("onZSSCellMouse",p,{toServer:true},25)},0)}var s=zss.Spreadsheet.CELL_MOUSE_EVENT_NAME[x];if(s){var v=new zk.Event(this,s,p);v.auStopped=true;this.fireX(v)}},fireWidgetUpdatEvt:function(z,q,p,y,s,w,r,u,x,t,v){this.fire("onWidgetUpdate",{sheetId:this.getSheetId(),wgtType:z,action:q,wgtId:p,dx1:y,dy1:s,dx2:w,dy2:r,col1:u,row1:x,col2:t,row2:v},{toServer:true},25)},fireToolbarAction:function(r,p){var q={sheetId:this.getSheetId(),tag:"toolbar",action:r};this.fire("onAuxAction",zk.copy(q,p),{toServer:true})},fireSheetAction:function(r,p){var q={sheetId:this.getSheetId(),tag:"sheet",action:r};this.fire("onAuxAction",zk.copy(q,p),{toServer:true})},fireRowAction:function(r,p){var q={sheetId:this.getSheetId(),tag:"row",action:r};this.fire("onAuxAction",zk.copy(q,p),{toServer:true})},fireColAction:function(r,p){var q={sheetId:this.getSheetId(),tag:"column",action:r};this.fire("onAuxAction",zk.copy(q,p),{toServer:true})},fetchActiveRange:function(s,r,q,p){if(!this._fetchActiveRange){this.sheetCtrl.activeBlock.loadstate=zss.MainBlockCtrl.LOADING;this.fire("onZSSFetchActiveRange",{sheetId:this.getSheetId(),top:s,left:r,right:q,bottom:p},{toServer:true});this._fetchActiveRange=true}},setActiveRangeUpdate:function(q){this._fetchActiveRange=null;var p=this._cacheCtrl;if(p){this.sheetCtrl.activeBlock.loadstate=zss.MainBlockCtrl.IDLE;p.getSelectedSheet().fetchUpdate(q);this.sheetCtrl.activeBlock.loadForVisible();this.sheetCtrl.sendSyncblock();if(zk.ie&&zk.ie==9){this.sheetCtrl.sp._resetIE9ScrollPosition()}}},_initFrozenArea:function(){var p=this.getRowFreeze(),r=this.getColumnFreeze();if((p!=undefined&&p>-1)||(r!=undefined&&r>-1)){var q=this.sheetCtrl;if(!q){return}}},getCSS:function(){return g(this.uuid+"-sheet")},_initControl:function(){if(this.getSheetId()==null){return}var p=this.uuid+"-sheet";if(!g(p)){zk.loadCSS(this._scss,p)}this._initFrozenArea()},bind_:function(s,r,q){k();this._initControl();this.$supers("bind_",arguments);var p=this.sheetCtrl;if(p){if(zk.safari){zk(p.$n()).redoCSS()}p.fireProtectSheet(this.isProtect());p.fireDisplayGridlines(this.isDisplayGridlines());if(s._tmpSnaps){if(s._tmpSnapsTimer){clearTimeout(s._tmpSnapsTimer);delete s._tmpSnapsTimer}p.restorePos_(s._tmpSnaps);delete s._tmpSnaps}}zWatch.listen({onResponse:this})},unbind_:function(){if(this._cacheCtrl){var q=this.getSheetId(),p=this.desktop;p._tmpSnaps=this._cacheCtrl.snap(q);p._tmpSnapsTimer=setTimeout(function(){delete p._tmpSnaps},0)}zWatch.unlisten({onResponse:this});this._cacheCtrl=this._maxColumnMap=this._maxRowMap=null;h(this.getSheetCSSId());this.$supers("unbind_",arguments);if(window.CollectGarbage){window.CollectGarbage()}},onResponse:function(){if(this._triggerContentsChanged!=undefined){this.sheetCtrl.fire("onContentsChanged");delete this._triggerContentsChanged}var p=this._onResponseCallback,q=null;while(q=p.shift()){q()}this._sendAu=false},domClass_:function(p){return"zssheet"},_doPartnerBlur:function(r){var q=this.sheetCtrl;var p=zk.currentFocus;while(p){if(p.className.indexOf("zss.")==0||p.className.indexOf("zssex.")==0){return}if(p.zssPartner){q.dp.gainFocus(false);return}p=p.parent}q.dp._doFocusLost()},_doDataPanelBlur:function(r){var s=this.sheetCtrl;if(s.innerClicking<=0&&s.state==zss.SSheetCtrl.FOCUSED){if(s.isPasteFromClipboard){s.dp.gainFocus(false);return}var q=zk.currentFocus;if(!q){var p=document.activeElement;if(p){q=zk.Widget.$(p)}}while(q){if(q.zssPartner){s.dp.gainFocus(false);return}q=q.parent}s.dp._doFocusLost()}else{if(s.state==zss.SSheetCtrl.FOCUSED){s.dp.gainFocus(false)}}},_doDataPanelFocus:function(p){var q=this.sheetCtrl;if(q.state<zss.SSheetCtrl.FOCUSED){q.dp.gainFocus(false)}},_doSelAreaMouseMove:function(p){var q=this.sheetCtrl.selArea;if(q){q._doMouseMove(p)}},_doSelAreaMouseOut:function(p){var q=this.sheetCtrl.selArea;if(q){q._doMouseOut(p)}},doClick_:function(p){if(this.sheetCtrl){this.sheetCtrl._doMouseleftclick(p)}this.$supers("doClick_",arguments)},doMouseDown_:function(p){if(this.sheetCtrl){this.sheetCtrl._doMousedown(p)}this.$supers("doMouseDown_",arguments)},_checkContext:function(){var q=this.getContext(),r=q?this.$f(q):null,p=this;if(r!=this._ctxpopwgt){if(this._ctxpopwgt){this._ctxpopwgt.unlisten({onOpen:[p,p._onOpenCtxpop]});delete this._ctxpopwgt}if(r){this._ctxpopwgt=r;r.listen({onOpen:[p,p._onOpenCtxpop]})}}if(this._closingCtxpop){this.focus();this._closingCtxpop=false}},_onOpenCtxpop:function(p){this._closingCtxpop=!p.open;var q=this;if(!p.open){setTimeout(function(){q._closingCtxpop=false},0)}},doMouseUp_:function(p){if(this.sheetCtrl){this.sheetCtrl._doMouseup(p)}this.$supers("doMouseUp_",arguments)},doRightClick_:function(p){if(this.sheetCtrl){this.sheetCtrl._doMouserightclick(p)}this.$supers("doRightClick_",arguments)},doDoubleClick_:function(p){if(this.sheetCtrl){this.sheetCtrl._doMousedblclick(p)}this.$supers("doDoubleClick_",arguments)},_doDragMouseUp:function(p){var q=this.sheetCtrl.dragging;if(q){q.doMouseup(p)}},_doDragMouseDown:function(p){var q=this.sheetCtrl.dragging;if(q){q.doMousemove(p)}},_releaseClientCache:function(p){if(this._cacheCtrl){this._cacheCtrl.releaseCache(p)}},_releaseSelectedCache:function(p){if(this._cacheCtrl){this._cacheCtrl.releaseSelectedCache(p)}},sendAU_:function(p,r,q){if(p.name=="onCtrlKey"){r=0}this._sendAu=true;this.$supers("sendAU_",arguments)},doKeyDown_:function(p){p=n(p);var q=this.sheetCtrl;if(q){q._doKeydown(p);if(p.ctrlKey&&p.keyCode==86){this._ctrlPasteDown=true}}this.$supers("doKeyDown_",arguments)},afterKeyDown_:function(p){var r=this.sheetCtrl;if(r&&r.state!=zss.SSheetCtrl.EDITING){var u=p.data,t=r.getLastSelection();if(t){u.tRow=t.top;u.lCol=t.left;u.bRow=t.bottom;u.rCol=t.right;u.type=r.selType?r.selType:zss.SEL.CELL}u.sheetId=this.getSheetId();this.$supers("afterKeyDown_",arguments);var v=p.keyCode;if(this.isListen("onCtrlKey",{any:true})&&(v==67||v==86)){var q=this._parsedCtlKeys,w=p.ctrlKey?1:p.altKey?2:p.shiftKey?3:0;if(q&&q[w][v]){p.domStopped=false}r.isPasteFromClipboard=true;r.dp.selectInputNode();var s=this;setTimeout(function(){s.doPaste()},0)}}},doKeyPress_:function(p){p=n(p);if(this.sheetCtrl){this.sheetCtrl._doKeypress(p)}this.$supers("doKeyPress_",arguments)},doKeyUp_:function(p){this.$supers("doKeyUp_",arguments);this._ctrlPasteDown=false},doPaste:function(){if(!this._ctrlPasteDown){return}var p=this,q=this.sheetCtrl,s=function(){p._doPasteFromServer=false};if(q&&q.state==zss.SSheetCtrl.FOCUSED){q.pasteToSheet();var r=this._afterPasteCallback;if(r){r();delete this._afterPasteCallback}}if(this._sendAu){this._onResponseCallback.push(s)}else{s()}},linkTo:function(q,r,p){if(r==1){if(this._linkToNewTab||p.ctrlKey){window.open(q)}else{window.location.href=q}}else{if(r==3){window.location.href=q;this._skipOnbeforeunloadOnce()}}},_skipOnbeforeunloadOnce:function(){var p=window.onbeforeunload;window.onbeforeunload=function(){window.onbeforeunload=p}},setCtrlArrowMoveFocus:function(q){var s=q.sheetId,t=q.row,r=q.col;if(s!=this.getSheetId()){return}var p=this.sheetCtrl;p.dp.moveFocus(t,r,true,true)},setShiftPosFocus:function(q){var s=q.sheetId,t=q.row,r=q.col;if(s!=this.getSheetId()){return}var p=this.sheetCtrl;p.dp.moveFocus(t,r,true,true)}},{CELL_MOUSE_EVENT_NAME:{lc:"onCellClick",rc:"onCellRightClick",dbc:"onCellDoubleClick",af:"onCellFilter",dv:"onCellValidator"},HEADER_MOUSE_EVENT_NAME:{lc:"onHeaderClick",rc:"onHeaderRightClick",dbc:"onHeaderDoubleClick"},SRC_CMD_SET_COL_WIDTH:"setColWidth",initLaterAfterCssReady:function(p){var r=p._wgt,q=r.getSheetId();if(r.isSheetCSSReady()){p._initiated=true;p._doSSInitLater();if(p._initmove){p.showMask(false)}else{if(zk(p._wgt).isRealVisible()&&!p.activeBlock.loadForVisible()){p.showMask(false)}}if(zk.opera){a("",r.uuid+"-sheet-opera")}if(zk.ie6_||zk.ie7_){jq(p.activeBlock.comp).toggleClass("zssnosuch")}setTimeout(function(){p.activeBlock.loadForVisible();p.getStyleMenupopup()},25)}else{setTimeout(function(){zss.Spreadsheet.initLaterAfterCssReady(p)},1)}}})})();
zkreg('zss.Spreadsheet');zk._m={};
zk._m['default']=function(b){var c=this._toolbarPanel;b.push("<div ",this.domAttrs_(),">",c?c.redrawHTML_():"");b.push(this.cave.redraw(b));for(var a=this.firstChild;a;a=a.nextSibling){if(a.ghost){a.redraw(b)}}b.push("</div>")};
;zkmld(zk._p.p.Spreadsheet,zk._m);(function(){zss.SEL={CELL:"cell",ROW:"row",COL:"col",ALL:"all"};zss.SELDRAG={MOVE:"move",RESIZE:"resize"};zss.SCROLL_DIR={BOTH:"both",HORIZONTAL:"horizontal",VERTICAL:"vertical"};zss.SCROLL_POS={NONE:"none",TOP:"top",BOTTOM:"bottom"};zss.clientCopy={maxRowCount:400,maxColumnCount:40};zss.colorPalette={width:180,height:120,color:["#000000","#993300","#333300","#003300","#000080","#003366","#660066","#333333","#800000","#FF8080","#808000","#008000","#008080","#0000FF","#800080","#969696","#FF0000","#FF6600","#FFFF66","#99CC00","#33CCCC","#0066CC","#6666FD","#808080","#FF00FF","#FF9900","#FFFF00","#00FF00","#00FFFF","#00CCFF","#CC99FF","#C0C0C0","#FF99CC","#FFCB90","#FFFF99","#CCFFCC","#CCFFFF","#99CCFF","#9999FF","#FFFFFF"]}})();
(function(){function a(e){var c=e.icomp,d=jq(c).clone()[0];jq(c).replaceWith(d);e.icomp=d}function b(e,d){var c=e.lastRange;if(!c){return}jq(e.comp).css("display","block");jq(e.icomp)[((c.top!=c.bottom)||(c.left!=c.right))?"addClass":"removeClass"]("zsselecti-r");if((zk.ie8&&zk.ie<11)&&d){a(e)}}zss.AreaCtrl=zk.$extends(zk.Object,{$init:function(d,e,c,f){this.$supers("$init",arguments);this.id=e.id;e.ctrl=this;this.comp=e;this.icomp=e.firstChild;this.sheet=d;this.lastRange=c?c:new zss.Range(0,0,0,0);this.mode=f},cleanup:function(){this.invalid=true;if(this.comp){this.comp.ctrl=null}this.comp=this.icomp=this.sheet=null},relocate:function(f){var j=this.sheet;if(!f){f=this.lastRange;if(!f){return}}else{this.lastRange=f}var i=j.custColWidth,e=j.custRowHeight,d=i.getStartPixel(f.left),g=e.getStartPixel(f.top),c=i.getStartPixel(f.right+1)-d,k=e.getStartPixel(f.bottom+1)-g;this.relocate_(d,g,c,k)},relocate_:function(d,f,c,g){var e=this.sheet,i=e.dp;d+=e.leftWidth;f+=e.topHeight+1;d=d-2;f=f-2;c=c+3;g=g+3;if(this.mode=="inner"){d=d+1;f=f+1;c=c-2;g=g-2}jq(this.comp).css({width:jq.px0(c),height:jq.px0(g),left:jq.px(d),top:jq.px(f)})},isVisible:function(){return this.comp.style.display=="block"},showArea:function(){var c=this.lastRange;if(!c){return}jq(this.comp).css("display","block")},hideArea:function(){jq(this.comp).css("display","none")}});zss.SelAreaCtrl=zk.$extends(zss.AreaCtrl,{$init:function(d,e,c,g){this.$supers("$init",arguments);var f=this.sheet._wgt,h=this.comp;f.domListen_(h,"onMouseMove","_doSelAreaMouseMove");f.domListen_(h,"onMouseOut","_doSelAreaMouseOut")},cleanup:function(){var c=this.sheet._wgt,d=this.comp;c.domUnlisten_(d,"onMouseMove","_doSelAreaMouseMove");c.domUnlisten_(d,"onMouseOut","_doSelAreaMouseOut");this.$supers("cleanup",arguments)},showArea:function(){b(this,true)},_doMouseMove:function(i){var f=this.sheet,h=i.pageX,g=i.pageY,k=zss.SSheetCtrl._calCellPos(f,h,g,false),l=k[0],c=k[1],j=f.getCell(l,c);if(j!=null&&j.merr){j=f.getCell(j.mert,j.merl)}if(j){if(f._showCellComment){f._showCellComment(j)}if(this._isStartHyperlink()){return}var e=jq(j.comp).find("a");if(e.length>0){var d=e[0];if(zkS.isOverlapByPoint(d,h,g)){jq(this.icomp).css("cursor","pointer");this._setHyperlinkElment(d);return}}this._resetHyperlink()}},_doMouseOut:function(d){this._resetHyperlink();var f=this.sheet,j=d.pageX,g=d.pageY,i=zss.SSheetCtrl._calCellPos(f,j,g,false),h=i[0],e=i[1],c=f.getCell(h,e);if(c!=null&&c.merr){c=f.getCell(c.mert,c.merl)}if(c&&f._showCellComment){f._showCellComment(c)}},_setHyperlinkElment:function(c){this._hyperlinkElm=c},_startHyperlink:function(e){this._stopHyperlink();if(zk.ie8&&zk.ie<11){this._start=true}var d=1000;this._mdtimeout=(new Date()).getTime()+d;if((e&&e.tagName.toLowerCase()=="a")||this._hyperlinkElm){var f=this,c=e;setTimeout(function(){f._resetHyperlinkCursor(c)},d)}},_tryAndEndHyperlink:function(j,e,i){var g=this._hyperlinkElm;if(g&&g.tagName.toLowerCase()=="a"){if(!this._isHyperlinkTimeout(new Date().getTime())){var c=g.getAttribute("z.href"),h=g.getAttribute("z.t");h=parseInt(h);this.sheet._wgt.linkTo(c,h,i);if(h==2){var k=this.sheet._wgt,f=k._cacheCtrl,d=k.getSheetId();f.snap(d)}this.sheet._sendOnCellHyperlink(j,e,c,h,i)}}this._stopHyperlink()},_stopHyperlink:function(){if(zk.ie8&&zk.ie<11){delete this._start}delete this._mdtimeout;if(this._aelm){jq(this._aelm).css("cursor","");delete this._aelm}},_isStartHyperlink:function(){return this._mdtimeout},_isHyperlinkTimeout:function(c){return c>=this._mdtimeout},_resetHyperlinkCursor:function(c){if(!c){jq(this.icomp).css("cursor","default")}else{this._aelm=c;jq(c).css("cursor","default")}},_resetHyperlink:function(){if((!zk.ie8||zk.ie>=11)||!this._start){delete this._hyperlinkElm;this._resetHyperlinkCursor()}}});zss.SelChgCtrl=zk.$extends(zss.AreaCtrl,{});zss.AreaCtrlCorner=zk.$extends(zss.AreaCtrl,{});zss.SelAreaCtrlCorner=zk.$extends(zss.AreaCtrlCorner,{showArea:function(){b(this)}});zss.SelChgCtrlCorner=zk.$extends(zss.AreaCtrlCorner,{});zss.AreaCtrlLeft=zk.$extends(zss.AreaCtrl,{relocate_:function(d,f,c,g){var e=this.sheet;d+=e.leftWidth-1;if(e.lp.toppad){f-=e.lp.toppad}d=d-2;f=f-2;c=c+3;g=g+3;if(this.mode=="inner"){d=d+1;f=f+1;c=c-2;g=g-2}jq(this.comp).css({width:jq.px0(c),height:jq.px0(g),left:jq.px(d),top:jq.px(f)})}});zss.SelAreaCtrlLeft=zk.$extends(zss.AreaCtrlLeft,{showArea:function(){b(this)}});zss.SelChgCtrlLeft=zk.$extends(zss.AreaCtrlLeft,{});zss.AreaCtrlTop=zk.$extends(zss.AreaCtrl,{relocate_:function(d,f,c,g){var e=this.sheet;f+=e.topHeight;d=d-2;f=f-2;c=c+3;g=g+3;if(this.mode=="inner"){d=d+1;f=f+1;c=c-2;g=g-2}jq(this.comp).css({width:jq.px0(c),height:jq.px0(g),left:jq.px(d),top:jq.px(f)})}});zss.SelAreaCtrlTop=zk.$extends(zss.AreaCtrlTop,{showArea:function(){b(this)}});zss.SelChgCtrlTop=zk.$extends(zss.AreaCtrlTop,{})})();
(function(){var c=40,d=60,b=100;function a(f,h){var e=h.dir;if(e&&e.length>0){var g=function(){a(f,h)};setTimeout(g,zss.AutoScrollCtrl.TIMEOUT)}else{return}var j=f.sp.comp,i=coloff=0;if(e.indexOf("t")>-1){i=-c}else{if(e.indexOf("b")>-1){i=c}}if(e.indexOf("l")>-1){coloff=-d}else{if(e.indexOf("r")>-1){coloff=d}}if(!(h.dironly==zss.AutoScrollCtrl.COLONLY)){j.scrollTop+=i}if(!(h.dironly==zss.AutoScrollCtrl.ROWONLY)&&i==0){j.scrollLeft+=coloff}}zss.AutoScrollCtrl=zk.$extends(zk.Object,{$init:function(f,e,g){this.$supers("$init",arguments);this.sheet=f;this.dir=e;this.dironly=g;a(f,this)},cleanup:function(){this.dir=""},setDir:function(e){this.dir=e},getDir:function(){return this.dir}},{ROWONLY:1,COLONLY:2})})();
(function(){if(zk.ie6_&&!jq.IE6_ALPHAFIX){jq.IE6_ALPHAFIX=".png"}var f={au:true},d={doMouseDown_:function(l){var n=this._wgt;if(n){var m=n.sheetCtrl;if(this._pp){n.focus(false)}else{if(m){if(zk.ie){m.dp.stopEditing("refocus")}m._doMousedown(l)}}}},doMouseUp_:function(l){var n=this._wgt;if(n){var m=n.sheetCtrl;if(this._pp){n.focus(false)}else{if(m){m._doMouseup(l)}}}}},b={doMouseDown_:function(l){var m=this._wgt;if(m){m.focus(false)}},doMouseUp_:function(l){var m=this._wgt;if(m){m.focus(false)}}};zss.FontSizeCombobox=zk.$extends(zul.inp.Combobox,{$init:function(m,n,l){this.$supers(zss.FontSizeCombobox,"$init",[m]);this._wgt=n;this._bd=l},_$action:"fontSize",$define:{$action:null},setDisabled:function(m){var l=this.isDisabled();if(m.$contains(this.get$action())){if(!l){this.$supers(zss.FontSizeCombobox,"setDisabled",[true])}}else{if(l){this.$supers(zss.FontSizeCombobox,"setDisabled",[false])}}},bind_:function(){this.$supers(zss.FontSizeCombobox,"bind_",arguments);this.listen({onSelect:this});var m=this._wgt;if(m){var l=m.sheetCtrl;if(l){l.listen({onCellSelection:this.proxy(this._onCellSelection)})}}},unbind_:function(){var m=this._wgt;if(m){var l=m.sheetCtrl;if(l){l.unlisten({onCellSelection:this.proxy(this._onCellSelection)})}}this.unlisten({onSelect:this});this.$supers(zss.FontSizeCombobox,"unbind_",arguments)},_onCellSelection:function(l){if(this._bd._skipNoShow()){return}var n=l.data;if(this.preRow==n.top&&this.preCol==n.left){return}this.preRow=n.top;this.preCol=n.left;var o=this._wgt.sheetCtrl.getCell(n.top,n.left);if(o){var m=o.getFontSize();if(m==this.preFontSize){return}this.preFontSize=m;this.setValue(m)}},onSelect:function(r){var u=this._wgt,p=u.sheetCtrl,m=r.data.reference;if(p&&m){var v=p.getLastSelection(),q=v.top,l=v.left,n=v.bottom,o=v.right,t=p.selType?p.selType:zss.SEL.CELL;p.triggerSelection(q,l,n,o);u.fireToolbarAction("fontSize",{size:m.getLabel(),tRow:q,lCol:l,bRow:n,rCol:o,type:t})}},_doBtnClick:function(m){var p=this.firstChild;if(!p){var o=["8","9","10","11","12","14","16","18","20","22","24","26","28","36","48","72"];for(var n=0,l=o.length;n<l;n++){this.appendChild(new zul.inp.Comboitem({label:o[n],sclass:"zsfontsize-"+o[n]}))}}this.$supers(zss.FontSizeCombobox,"_doBtnClick",arguments)},getSclass:function(){return"zsfontsize"}});zk.copy(zss.FontSizeCombobox.prototype,b);zss.FontFamilyCombobox=zk.$extends(zul.inp.Combobox,{$init:function(m,n,l){this.$supers(zss.FontFamilyCombobox,"$init",[m]);this._wgt=n;this._bd=l},_$action:"fontFamily",$define:{$action:null},setDisabled:function(m){var l=this.isDisabled();if(m.$contains(this.get$action())){if(!l){this.$supers(zss.FontFamilyCombobox,"setDisabled",[true])}}else{if(l){this.$supers(zss.FontFamilyCombobox,"setDisabled",[false])}}},bind_:function(){this.$supers(zss.FontFamilyCombobox,"bind_",arguments);this.listen({onSelect:this});var m=this._wgt;if(m){var l=m.sheetCtrl;if(l){l.listen({onCellSelection:this.proxy(this._onCellSelection)})}}},unbind:function(){var m=this._wgt;if(m){var l=m.sheetCtrl;if(l){l.unlisten({onCellSelection:this.proxy(this._onCellSelection)})}}this.$supers(zss.FontFamilyCombobox,"unbind",arguments)},_onCellSelection:function(l){if(this._bd._skipNoShow()){return}var n=l.data;if(n.top==this.preRow&&n.left==this.preCol){return}this.preRow=n.top;this.preCol=n.left;var o=this._wgt.sheetCtrl.getCell(n.top,n.left);if(o){var m=o.getFontName();if(this.preFontName==m){return}this.preFontName=m;this.setValue(m)}},unbind_:function(){this.unlisten({onSelect:this});this.$supers(zss.FontFamilyCombobox,"unbind_",arguments)},onSelect:function(r){var u=this._wgt,p=u.sheetCtrl,m=r.data.reference;if(p&&m){var v=p.getLastSelection(),q=v.top,l=v.left,n=v.bottom,o=v.right,t=p.selType?p.selType:zss.SEL.CELL;p.triggerSelection(q,l,n,o);u.fireToolbarAction("fontFamily",{name:m.getLabel(),tRow:q,lCol:l,bRow:n,rCol:o,type:t})}},_doBtnClick:function(t){var v=this.firstChild;if(!v){var n="zsfontfamily",r=["Calibri","Arial","Arial Black","Comic Sans MS","Courier New","Georgia","Impact","Lucida Console","Lucida Sans Unicode","Palatino Linotype","Tahoma","Times New Roman","Trebuchet MS","Verdana","MS Sans Serif","MS Serif"];for(var m=0,p=r.length;m<p;m++){var q=r[m],o=q.toLowerCase().split(/\s+/),u=n;for(var l=0,s=o.length;l<s;l++){u+=("-"+o[l])}this.appendChild(new zul.inp.Comboitem({label:q,sclass:u}))}}this.$supers(zss.FontFamilyCombobox,"_doBtnClick",arguments)},getSclass:function(){return"zsfontfamily"}});zk.copy(zss.FontFamilyCombobox.prototype,b);zss.ToolbarbuttonSeparator=zk.$extends(zul.wgt.Toolbarbutton,{$o:zk.$void,$define:{$action:null},setDisabled:zk.$void,domTextStyleAttr_:function(){var l=zk.ajaxURI("/web/zss/img/sep.gif",{au:true});return zUtl.appendAttr("style","background:url("+l+") repeat-y scroll 0 0 transparent;height: 20px;width:2px;padding:2px 0;")},getSclass:function(){return"zstbtn-sep"}});zss.Toolbarbutton=zk.$extends(zul.wgt.Toolbarbutton,{$o:zk.$void,$init:function(l,m){this.$supers(zss.Toolbarbutton,"$init",[l]);this._wgt=m},$define:{$action:null,clickDisabled:null},setDisabled:function(m){if(m){var l=this.isDisabled();if(m.$contains(this.get$action())){if(!l){this.$supers(zss.Toolbarbutton,"setDisabled",[true])}}else{if(l){this.$supers(zss.Toolbarbutton,"setDisabled",[false])}}}else{this.$supers(zss.Toolbarbutton,"setDisabled",arguments)}},setImage:function(l){if(!this._defaultImage){this._defaultImage=l}this.$supers(zss.Toolbarbutton,"setImage",arguments)},preSel:false,setSelectedEffect:function(m,o){if(this.preSel==m&&this.preMenuItem==o){return}this.preSel=m;this.preMenuItem=o;var l=this.getPopup();var n=jq(this.$n());var p=null;if(m&&l&&o){var p=o.getImage();this._seldImage=p;if(p){this.setImage(p)}}else{if(!o){this._seldImage=null;var p=this._defaultImage;if(p){this.setImage(p)}n.removeClass(this._getSclass()+"-seld")}}if(m){n.addClass(this._getSclass()+"-seld")}else{n.removeClass(this._getSclass()+"-seld")}},bind_:function(){this.$supers(zss.Toolbarbutton,"bind_",arguments);var s=this.$n("cave");if(s&&!this._calWidth){var o=this.isClickDisabled(),l=this._seldImage,t=this._getSclass(),q=jq(this.$n()),m=s.parentNode,n=jq(s),p=n.width()+n.zk.sumStyles("lr",jq.paddings),r=q.width()+p;if(r<=32){r=32}this.setWidth(r+"px");this._calWidth=true;if(o){jq(m).addClass(t+"-clk-disd")}if(l){q.addClass(t+"-seld")}}},doClick_:function(n){var o=this.$n("cave"),m=n.domTarget;if(!this.isDisabled()&&o&&jq.isAncestor(o,m)){var l=this._smartFellow(this.getPopup());if(l){l.open(this,null,"after_start")}}else{if(this.isFireOnClick_(n)){this.fire("onClick")}}},isFireOnClick_:function(l){return !this.isClickDisabled()&&!this.isDisabled()},doMouseOver_:function(m){var n=this.$n("cave"),l=m.domTarget;if(!this.isDisabled()&&n){if(jq.isAncestor(n,l)){jq(n).addClass(this._getSclass()+"-cave-over")}}this.$supers(zss.Toolbarbutton,"doMouseOver_",arguments)},doMouseOut_:function(l){var m=this.$n("cave");if(m){jq(m).removeClass(this._getSclass()+"-cave-over")}this.$supers(zss.Toolbarbutton,"doMouseOut_",arguments)},domContent_:function(){var m=this.$supers(zss.Toolbarbutton,"domContent_",arguments);if(this.getPopup()){var l=this.uuid,n=this._getSclass();return'<div id="'+l+'-real" class="'+n+'-real">'+m+'</div><div id="'+l+'-cave" class="'+n+'-cave"><div class="'+n+'-arrow"></div></div>'}else{return m}},_getSclass:function(){return"zstbtn"},getSclass:function(){return"zstbtn-"+this.get$action()+" "+this._getSclass()}},{_rmActive:function(m){var o=m.$n(),l=m.$n("cave");if(l){jq(l).removeClass(m._getSclass()+"-cave-over")}jq(o).removeClass(m._getSclass()+"-over").removeClass(m.getZclass()+"-over")}});zk.copy(zss.Toolbarbutton.prototype,d);zss.CheckableToolbarButton=zk.$extends(zul.wgt.Toolbarbutton,{$init:function(l,m){this.$supers(zss.CheckableToolbarButton,"$init",[l]);this.setWidth("36px");this._wgt=m},$define:{$action:null,checked:function(l){var m=this.$n("real");if(m){m.style.backgroundImage="url("+this.getCheckImage()+")"}}},setDisabled:function(m){var l=this.isDisabled();if(m.$contains(this.get$action())){if(!l){this.$supers(zss.CheckableToolbarButton,"setDisabled",[true])}}else{if(l){this.$supers(zss.CheckableToolbarButton,"setDisabled",[false])}}},getCheckImage:function(){return zk.ajaxURI("/web/zss/img/"+((this.isChecked()?"ui-check-box":"ui-check-box-uncheck"))+(zk.ie6_?".gif":".png"),{au:true})},domContent_:function(){return'<div id="'+this.uuid+'-real" class="'+this.getSclass()+'-check" style="background: url('+this.getCheckImage()+') no-repeat transparent;"></div>'+this.$supers(zul.wgt.Toolbarbutton,"domContent_",arguments)},getSclass:function(){return"zschktbtn-"+this.get$action()+" zschktbtn"}});zk.copy(zss.CheckableToolbarButton.prototype,d);zss.ProtectSheetCheckbutton=zk.$extends(zss.CheckableToolbarButton,{_$action:"protectSheet",bind_:function(){var l=this._wgt.sheetCtrl;if(l){l.listen({onProtectSheet:this.proxy(this.onProtectSheet)})}this.$supers(zss.ProtectSheetCheckbutton,"bind_",arguments)},onProtectSheet:function(l){this.setChecked(l.data.protect)}});zss.DisplayGridlinesCheckbutton=zk.$extends(zss.CheckableToolbarButton,{_$action:"gridlines",bind_:function(){var l=this._wgt.sheetCtrl;if(l){l.listen({onDisplayGridlines:this.proxy(this.onDisplayGridlines)})}this.$supers(zss.DisplayGridlinesCheckbutton,"bind_",arguments)},onDisplayGridlines:function(l){this.setChecked(l.data.show)}});if(zk.feature.pe){zk.load("zkex.inp",null,function(){zss.ColorPopup=zk.$extends(zkex.inp.Colorbox,{_visible:false,_ref:null,$init:function(l){this.$supers(zss.ColorPopup,"$init",[]);this._ref=l},adjustPosition_:function(){if(this._ref&&this._ref.$n){zk(this.$n("pp")).position(this._ref.$n(),this._getPosition())}},open:function(){this.openPopup();this.adjustPosition_()},openPalette:function(){this.$supers(zss.ColorPopup,"openPalette",arguments);this.adjustPosition_()},openPicker:function(){this.$supers(zss.ColorPopup,"openPicker",arguments);this.adjustPosition_()},shallStackup_:function(){return false},_syncShadow:function(l){},_hideShadow:function(l){}});zss.ColorbuttonEx=zk.$extends(zss.Toolbarbutton,{_color:"#000000",$init:function(m,n,l){this.$supers(zss.ColorbuttonEx,"$init",[m]);this._wgt=n;this._colorPopup=new zss.ColorPopup(this);this.setPopup(this._colorPopup);if(l){l.appendChild(this._colorPopup)}},$define:{image:function(l){var m=this.getImageNode();if(m){m.src=l||""}},color:function(l){var m=this.$n("color");if(m){m.style.backgroundColor=l}}},bind_:function(){this.$supers(zss.ColorbuttonEx,"bind_",arguments);if(this._colorPopup){this._colorPopup.listen({onChange:this.proxy(this.onChange)})}},unbind_:function(){if(this._colorPopup){this._colorPopup.unlisten({onChange:this.proxy(this.onChange)})}this.$supers(zss.ColorbuttonEx,"unbind_",arguments)},doKeyDown_:zk.$void,doKeyUp_:zk.$void,doKeyPress_:zk.$void,onChange:function(l){var m=l.data.color;this.setColor(m);this.fire("onClick");var n=this._wgt;if(n){n.focus(false)}},domContent_:function(){var n=this.uuid;var m=this.$supers(zss.ColorbuttonEx,"domContent_",arguments);var l=new Array();l.push(m);l.push('<div id="'+n+'-color" class="zstbtn-color" style="background:'+this.getColor()+';"></div>');return l.join("")},shallStackup_:function(){return false}})})}if(true){zss.Colorbutton=zk.$extends(zss.Toolbarbutton,{_open:false,_color:"#000000",$init:function(l,m){this.$supers(zss.Colorbutton,"$init",[l]);this._wgt=m},$define:{image:function(l){var m=this.getImageNode();if(m){m.src=l||""}},color:function(l){var m=this.$n("color");if(m){m.style.backgroundColor=l}}},bind_:function(){this.$supers(zss.Colorbutton,"bind_",arguments);zWatch.listen({onFloatUp:this})},unbind_:function(){zWatch.unlisten({onFloatUp:this});this.$supers(zss.Colorbutton,"unbind_",arguments)},onFloatUp:function(l){if(!zUtl.isAncestor(this,l.origin)){this.closePopup()}},doMouseOver_:_onCell=function(l){var n=l.domTarget,m=this.getSclass();if(jq(n).parents("."+m+"-pp")[0]){jq(n).parents("."+m+"-cell")[l.name=="onMouseOver"?"addClass":"removeClass"](m+"-cell-over")}else{jq(this.$n())[l.name=="onMouseOver"?"addClass":"removeClass"](m+"-over")}},doMouseOut_:_onCell,doClick_:function(l){var m=l.domTarget,q=this.$n("pp"),r=jq(l.domTarget),o=this.getSclass();if(jq.isAncestor(q,m)){if(r.attr("class").indexOf(o+"-cell-cnt")>=0){var n=r.children("i").text();this.setColor(n);this.fire("onClick");this.closePopup();r.parent().removeClass(o+"-cell-over")}}else{if(this._open){this.closePopup()}else{this.openPopup()}}},openPopup:function(){this._open=true;var m=this.$n(),l=this.$n("pp");l.style.position="absolute";l.style.overflow="auto";l.style.display="block";l.style.zIndex="88000";jq(l).zk.makeVParent();zk(l).position(m,this._getPosition())},_getPosition:function(){var l=this.parent;if(!l){return}if(l.$instanceof(zul.wgt.Toolbar)){return"vertical"==l.getOrient()?"end_before":"after_start"}return"after_start"},closePopup:function(){this._open=false;var m=this.$n(),l=this.$n("pp");jq(l).zk.undoVParent()},domContent_:function(){var p=this.uuid,m=this.$supers(zss.Colorbutton,"domContent_",arguments),q=zss.colorPalette.color,l=zss.colorPalette.width,s=zss.colorPalette.height,r=q.length,t=this.getSclass(),n=this.getColor();m=m+'<div id="'+p+'-color" class="'+this.getSclass()+'-color" style="background:'+this.getColor()+';"></div><div id="'+p+'-pp" style="display:none;width:'+l+"px;height:"+s+'px;" class="'+t+'-pp">';for(var o=0;o<r;o++){m+='<div class="'+t+'-cell"><div style="background: '+q[o]+';" class="'+t+'-cell-cnt"><i style="display: none">'+q[o]+"</i></div></div>"}m+="</div>";return m}})}zss.Menu=zk.$extends(zul.menu.Menu,{setDisabled:function(m){var l=this.menupopup;if(l&&l.setDisabled){l.setDisabled(m)}},getSclass:function(){return"zsmenu-"+this._sclass}});zss.Menuitem=zk.$extends(zul.menu.Menuitem,{$init:function(l,m){this.$supers(zss.Menuitem,"$init",[l]);this._wgt=m},$define:{$action:null},setDisabled:function(m){if(jq.isArray(m)){var l=this.isDisabled();if(m.$contains(this.get$action())){if(!l){this.$supers(zss.Menuitem,"setDisabled",[true])}}else{if(l){this.$supers(zss.Menuitem,"setDisabled",[false])}}}else{this.$supers(zss.Menuitem,"setDisabled",arguments)}},getSclass:function(){return"zsmenuitem-"+this.get$action()}});zk.copy(zss.Menuitem.prototype,b);zss.StateMenuitem=zk.$extends(zss.Menuitem,{$init:function(l,m){this.$supers(zss.StateMenuitem,"$init",[l]);this.updateState=l.updateState;this._wgt=m},updateState:null});if(zk.feature.pe){zss.ColorMenuEx=zk.$extends(zss.Menu,{bind_:function(){this.$supers(zss.ColorMenuEx,"bind_",arguments);this.listen({onChange:this})},unbind_:function(){this.unlisten({onChange:this});this.$supers(zss.ColorMenuEx,"unbind_",arguments)},getColor:function(){return this.color},onChange:function(l){this.color=l.data.color},getSclass:function(){return"zscolormenu"}})}zss.ColorMenu=zk.$extends(zss.Menu,{_open:false,_color:null,$define:{content:_zkf=function(l){if(!l||l.length==0){return}var m=this.$n("img");if(m){m.style.backgroundColor=l}if(!this._contentHandler){this._contentHandler=new zss.ColorMenuContentHandler(this,l)}else{this._contentHandler.setContent(l)}},color:_zkf},bind_:function(){this.$supers(zss.ColorMenu,"bind_",arguments);var l=this.$n("img");if(l){l.style.backgroundColor=this._color}},unbind_:function(){this.$supers(zss.ColorMenu,"unbind_",arguments)},getSclass:function(){return"zscolormenu"},getColor:function(){return this._color}});zk.copy(zss.ColorMenu.prototype,b);zss.ColorMenuContentHandler=zk.$extends(zk.Widget,{$init:function(m,l){this._wgt=m;this._content=l},setContent:function(l){if(this._content!=l||!this._pp){this._content=l;this._wgt.rerender()}},redraw:function(o){var v=this._wgt,q=v.uuid,r=zss.colorPalette.color,l=zss.colorPalette.width,t=zss.colorPalette.height,s=r.length,u=v.getSclass(),n=this._content;var m='<div id="'+q+'-cnt-pp" style="display:none;width:'+l+"px;height:"+t+'px;" class="'+u+'-cnt-pp">';for(var p=0;p<s;p++){m+='<div class="'+u+'-cell"><div style="background: '+r[p]+';" class="'+u+'-cell-cnt"><i style="display: none">'+r[p]+"</i></div></div>"}m+="</div>";o.push(m)},bind:function(){var l=this._wgt;if(!l.menupopup){l.domListen_(l.$n(),"onClick","onShow");zWatch.listen({onFloatUp:l,onHide:l})}this._pp=jq("#"+l.uuid+"-cnt-pp")[0];l.domListen_(this._pp,"onClick",this.proxy(this._onPaletteClick))},unbind:function(){var l=this._wgt;if(!l.menupopup){if(this._shadow){this._shadow.destroy();this._shadow=null}l.domUnlisten_(l.$n(),"onClick","onShow");zWatch.unlisten({onFloatUp:l,onHide:l})}l.domUnlisten_(this._pp,"onClick",this.proxy(this._onPaletteClick));this._pp=null},isOpen:function(){var l=this._pp;return(l&&zk(l).isVisible())},onShow:function(){var m=this._wgt,l=this._pp;if(!l){return}l.style.position="absolute";l.style.overflow="auto";l.style.display="block";l.style.zIndex="88000";jq(l).zk.makeVParent();zWatch.fireDown("onVParent",this);zk(l).position(m.$n(),this.getPosition());this.syncShadow()},onHide:function(){var l=this._pp;if(!l||!zk(l).isVisible()){return}l.style.display="none";jq(l).zk.undoVParent();zWatch.fireDown("onVParent",this);this.hideShadow()},onFloatUp:function(l){if(!zUtl.isAncestor(this._wgt,l.origin)){this.onHide()}},syncShadow:function(){if(!this._shadow){this._shadow=new zk.eff.Shadow(this._wgt.$n("cnt-pp"),{stackup:(zk.useStackup===undefined?zk.ie6_:zk.useStackup)})}this._shadow.sync()},hideShadow:function(){this._shadow.hide()},destroy:function(){this._wgt.rerender()},getPosition:function(){var m=this._wgt;if(m.isTopmost()){var l=m.getMenubar();if(l){return"vertical"==l.getOrient()?"end_before":"after_start"}}return"end_before"},closePalette:function(m){var l=this._pp;if(!l||!zk(l).isVisible()){return}l.style.display="none";if(m){zWatch.fire("onFloatUp",null)}},_onPaletteClick:function(l){var m=l.domTarget,r=this._wgt,q=this._pp,s=jq(l.domTarget),o=r.getSclass();if(jq.isAncestor(q,m)){if(s.attr("class").indexOf(o+"-cell-cnt")>=0){var n=s.children("i").text();this.closePalette(true);this._wgt.setColor(n);l.stop()}}}});zss.Menupopup=zk.$extends(zul.menu.Menupopup,{$init:function(l){this.$supers(zss.Menupopup,"$init",[]);this._wgt=l;this.z$rod=false},setDisabled:function(m){var l=this.firstChild;for(;l;l=l.nextSibling){if(!l.setDisabled){continue}l.setDisabled(m)}},open:function(){this.$supers(zss.Menupopup,"open",arguments);var l=this._wgt;if(l){l.focus(false)}},onFloatUp:function(l){if(!this.isVisible()){return}if(this._wgt&&this.isOpen()&&zUtl.isAncestor(l.origin,this)){return}this.$supers(zss.Menupopup,"onFloatUp",arguments)},zsync:function(){}},{_rmActive:function(l){if(l.parent.$instanceof(zul.menu.Menu)){l.parent.$class._rmActive(l.parent)}else{if(l.parent.$instanceof(zss.Toolbarbutton)){l.parent.$class._rmActive(l.parent)}}}});zss.StateMenupopup=zk.$extends(zss.Menupopup,{updateItemState:function(l){var m=this.firstChild;for(;m;m=m.nextSibling){if(m.updateState){m.updateState.call(m,l)}}}});function i(o,l,m,n){return new zss.StateMenuitem({$action:l,image:m?zk.ajaxURI(m,{au:true}):null,label:msgzss.action[l],onClick:function(){var p=o.sheetCtrl;if(p){var r=p.getLastSelection(),w=r.top,q=r.left,u=r.bottom,v=r.right,t=p.selType?p.selType:zss.SEL.CELL;p.triggerSelection(w,q,u,v);o.fireToolbarAction(l,{tRow:w,lCol:q,bRow:u,rCol:v,type:t})}},updateState:n},o)}function c(n,l,m){return new zss.Menuitem({$action:l,image:m?zk.ajaxURI(m,{au:true}):null,label:msgzss.action[l],onClick:function(){var o=n.sheetCtrl;if(o){var q=o.getLastSelection(),v=q.top,p=q.left,t=q.bottom,u=q.right,r=o.selType?o.selType:zss.SEL.CELL;o.triggerSelection(v,p,t,u);n.fireToolbarAction(l,{tRow:v,lCol:p,bRow:t,rCol:u,type:r})}}},n)}function k(m,l){return new zss.Menuitem({$action:l,label:msgzss.action[l],onClick:function(){var n=m.sheetCtrl;if(n){var p=n.getLastSelection(),u=p.top,o=p.left,r=p.bottom,t=p.right,q=n.selType?n.selType:zss.SEL.CELL;n.triggerSelection(u,o,r,t);m.fireToolbarAction(l,{tRow:u,lCol:o,bRow:r,rCol:t,type:q})}}},m)}function a(o,l,m,n){return new zss.Menuitem({$action:m,image:n?zk.ajaxURI(n,{au:true}):null,label:msgzss.action[m],onClick:function(){var q=o.sheetCtrl;if(q){var r=q.getLastSelection(),p=l?l.getColor():"",t=q.selType?q.selType:zss.SEL.CELL;o.fireToolbarAction(m,{color:p,tRow:r.top,lCol:r.left,bRow:r.bottom,rCol:r.right,type:t})}}},o)}function j(l){return(!!zss.ColorMenuEx&&l.getColorPickerExUsed())?new zss.ColorMenuEx({$action:"borderColor",label:msgzss.action.borderColor,content:"#color=#000000"},l):new zss.ColorMenu({$action:"borderColor",label:msgzss.action.borderColor,color:"#000000"},l)}function h(n,m,l){return n&&n.isOpen()&&(zUtl.isAncestor(n,m)||(l&&jq.isAncestor(n.$n(),document.activeElement)))}zss.StylePanel=zk.$extends(zul.wgt.Popup,{$init:function(s){this.$supers(zss.StylePanel,"$init",[]);if(zk.ie6_){this.setWidth("186px")}this._wgt=s;this.zssPartner=true;var r=this,m=new zul.wgt.Toolbar({sclass:"zsstylepanel-toolbar"}),n=new zss.ButtonBuilder(s,this),l=n.addAll(["fontFamily","fontSize","fontBold","fontItalic"]).build(),o=l[0],t=l[1],p;var q=new zul.wgt.Div({sclass:"zsstylepanel-upper"});this.appendChild(q);s.listen({onAuxAction:this.proxy(this._closeStylePanel)});o.setWidth("85px");t.setWidth("58px");while(p=l.shift()){m.appendChild(p)}q.appendChild(m);m=new zul.wgt.Toolbar({sclass:"zsstylepanel-toolbar"});l=n.addAll(["fontColor","backColor","border","verticalAlign","horizontalAlign","wrapText"]).build();while(p=l.shift()){m.appendChild(p)}q.appendChild(m);this._styleContainer=q;this._menuContainer=new zul.wgt.Div({sclass:"zsstylepanel-menu"});this.appendChild(this._menuContainer)},getMenuContainer:function(){return this._menuContainer},getStyleContainer:function(){return this._styleContainer},setDisabled:function(m){for(var o=this.firstChild;o;o=o.nextSibling){for(var l=o.firstChild;l;l=l.nextSibling){if(!l.setDisabled){continue}l.setDisabled(m)}}},_closeStylePanel:function(){this.close({sendOnOpen:true});this._wgt.focus(true)},onFloatUp:function(m,p){if(!this.isVisible()){return}var l=m.origin,o=this._wgt.sheetCtrl;if(o){if(zk.ie<11&&l==this){this._closeStylePanel()}var q=[o.getCellMenupopup(),o.getColumnHeaderMenupopup(),o.getRowHeaderMenupopup()];for(var n=q.length-1;n>=0;n--){if(h(q[n],l,zk.ie&&p&&p.triggerByFocus)){return}}}this.$supers(zss.StylePanel,"onFloatUp",arguments)},getSclass:function(){return"zsstylepanel"},shallStackup_:function(){return false}});zss.MenupopupFactory=zk.$extends(zk.Object,{$init:function(l){this._wgt=l},paste:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"paste","/web/zss/img/clipboard-paste.png"));l.appendChild(c(m,"pasteFormula"));l.appendChild(c(m,"pasteValue"));l.appendChild(c(m,"pasteAllExceptBorder"));l.appendChild(c(m,"pasteTranspose"));l.appendChild(c(m,"pasteSpecial"));return l},border:function(){var n=this._wgt,m=new zss.Menupopup(),l=j(n);if(l){m.colorMenu=l}m.appendChild(a(n,l,"borderBottom","/web/zss/img/border-bottom.png"));m.appendChild(a(n,l,"borderTop","/web/zss/img/border-top.png"));m.appendChild(a(n,l,"borderLeft","/web/zss/img/border-left.png"));m.appendChild(a(n,l,"borderRight","/web/zss/img/border-right.png"));m.appendChild(new zul.menu.Menuseparator());m.appendChild(a(n,l,"borderNo","/web/zss/img/border.png"));m.appendChild(a(n,l,"borderAll","/web/zss/img/border-all.png"));m.appendChild(a(n,l,"borderOutside","/web/zss/img/border-outside.png"));m.appendChild(a(n,l,"borderInside","/web/zss/img/border-inside.png"));m.appendChild(new zul.menu.Menuseparator());m.appendChild(a(n,l,"borderInsideHorizontal","/web/zss/img/border-horizontal.png"));m.appendChild(a(n,l,"borderInsideVertical","/web/zss/img/border-vertical.png"));if(l){m.appendChild(new zul.menu.Menuseparator());m.appendChild(l)}return m},verticalAlign:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"verticalAlignTop","/web/zss/img/edit-vertical-alignment-top.png"));l.appendChild(c(m,"verticalAlignMiddle","/web/zss/img/edit-vertical-alignment-middle.png"));l.appendChild(c(m,"verticalAlignBottom","/web/zss/img/edit-vertical-alignment.png"));return l},horizontalAlign:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"horizontalAlignLeft","/web/zss/img/edit-alignment.png"));l.appendChild(c(m,"horizontalAlignCenter","/web/zss/img/edit-alignment-center.png"));l.appendChild(c(m,"horizontalAlignRight","/web/zss/img/edit-alignment-right.png"));return l},mergeAndCenter:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"mergeAndCenter"));l.appendChild(c(m,"mergeAcross"));l.appendChild(c(m,"mergeCell"));l.appendChild(c(m,"unmergeCell"));return l},insert:function(){var o=this._wgt,m=new zss.Menupopup(),l=new zss.Menu({label:msgzss.action.insertCell,sclass:"insertCell"}),n=new zss.Menupopup();n.appendChild(c(o,"shiftCellRight"));n.appendChild(c(o,"shiftCellDown"));l.appendChild(n);m.appendChild(l);m.appendChild(c(o,"insertSheetRow"));m.appendChild(c(o,"insertSheetColumn"));return m},del:function(){var o=this._wgt,n=new zss.Menupopup(),l=new zss.Menu({label:msgzss.action.deleteCell,sclass:"deleteCell"}),m=new zss.Menupopup();m.appendChild(c(o,"shiftCellLeft"));m.appendChild(c(o,"shiftCellUp"));l.appendChild(m);n.appendChild(l);n.appendChild(c(o,"deleteSheetRow"));n.appendChild(c(o,"deleteSheetColumn"));return n},format:function(){},autoSum:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"autoSum"));l.appendChild(c(m,"average"));l.appendChild(c(m,"countNumber"));l.appendChild(c(m,"max"));l.appendChild(c(m,"min"));l.appendChild(c(m,"moreFunction"));return l},clear:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"clearContent"));l.appendChild(c(m,"clearStyle"));l.appendChild(c(m,"clearAll"));return l},sortAndFilter:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"sortAscending","/web/zss/img/asc.png"));l.appendChild(c(m,"sortDescending","/web/zss/img/des.png"));l.appendChild(c(m,"customSort"));l.appendChild(c(m,"filter","/web/zss/img/funnel--pencil.png"));l.appendChild(c(m,"clearFilter","/web/zss/img/funnel--minus.png"));l.appendChild(c(m,"reapplyFilter","/web/zss/img/funnel--arrow.png"));return l},insertChart:function(){var x=this._wgt,m=new zss.Menupopup(),w=new zss.Menu({label:msgzss.action.columnChart,sclass:"columnChart"}),t=new zss.Menu({label:msgzss.action.lineChart,sclass:"lineChart"}),s=new zss.Menu({label:msgzss.action.pieChart,sclass:"pieChart"}),r=new zss.Menu({label:msgzss.action.barChart,sclass:"barChart"}),l=new zss.Menu({label:msgzss.action.otherChart,sclass:"otherChart"}),n=new zss.Menupopup(),q=new zss.Menupopup(),o=new zss.Menupopup(),v=new zss.Menupopup(),u=new zss.Menupopup();n.appendChild(c(x,"columnChart"));n.appendChild(c(x,"columnChart3D"));w.appendChild(n);m.appendChild(w);q.appendChild(c(x,"lineChart"));q.appendChild(c(x,"lineChart3D"));t.appendChild(q);m.appendChild(t);o.appendChild(c(x,"pieChart"));o.appendChild(c(x,"pieChart3D"));s.appendChild(o);m.appendChild(s);v.appendChild(c(x,"barChart"));v.appendChild(c(x,"barChart3D"));r.appendChild(v);m.appendChild(r);m.appendChild(c(x,"areaChart"));m.appendChild(c(x,"scatterChart"));u.appendChild(c(x,"doughnutChart"));l.appendChild(u);m.appendChild(l);return m},columnChart:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"columnChart"));l.appendChild(c(m,"columnChart3D"));return l},lineChart:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"lineChart"));l.appendChild(c(m,"lineChart3D"));return l},pieChart:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"pieChart"));l.appendChild(c(m,"pieChart3D"));return l},barChart:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"barChart"));l.appendChild(c(m,"barChart3D"));return l},otherChart:function(){var m=this._wgt,l=new zss.Menupopup();l.appendChild(c(m,"doughnutChart"));return l},rowHeader:function(){var m=this._wgt,l=new zss.Menupopup(m);l.appendChild(c(m,"cut"));l.appendChild(c(m,"copy"));l.appendChild(c(m,"paste"));l.appendChild(c(m,"pasteSpecial"));l.appendChild(new zul.menu.Menuseparator());l.appendChild(c(m,"insertSheetRow"));l.appendChild(c(m,"deleteSheetRow"));l.appendChild(c(m,"clearContent"));l.appendChild(new zul.menu.Menuseparator());l.appendChild(c(m,"formatCell"));l.appendChild(c(m,"dataValidation"));l.appendChild(c(m,"rowHeight"));l.appendChild(c(m,"hideRow"));l.appendChild(c(m,"unhideRow"));return l},columnHeader:function(){var m=this._wgt,l=new zss.Menupopup(m);l.appendChild(c(m,"cut"));l.appendChild(c(m,"copy"));l.appendChild(c(m,"paste"));l.appendChild(c(m,"pasteSpecial"));l.appendChild(new zul.menu.Menuseparator());l.appendChild(c(m,"insertSheetColumn"));l.appendChild(c(m,"deleteSheetColumn"));l.appendChild(c(m,"clearContent"));l.appendChild(new zul.menu.Menuseparator());l.appendChild(c(m,"formatCell"));l.appendChild(c(m,"dataValidation"));l.appendChild(c(m,"columnWidth"));l.appendChild(c(m,"hideColumn"));l.appendChild(c(m,"unhideColumn"));return l},cell:function(){var w=this._wgt,l=new zss.StateMenupopup(w),m=new zss.Menu({label:msgzss.action.insert,sclass:"insert"}),q=new zss.Menupopup(),n=new zss.Menu({label:msgzss.action.del,sclass:"del"}),r=new zss.Menupopup(),o=new zss.Menu({label:msgzss.action.filter,sclass:"filter"}),u=new zss.Menupopup(),v=new zss.Menu({label:msgzss.action.sort,sclass:"sort"}),t=new zss.Menupopup();l.appendChild(c(w,"cut"));l.appendChild(c(w,"copy"));l.appendChild(c(w,"paste"));l.appendChild(c(w,"pasteSpecial"));l.appendChild(new zul.menu.Menuseparator());q.appendChild(c(w,"shiftCellRight"));q.appendChild(c(w,"shiftCellDown"));q.appendChild(c(w,"insertSheetRow"));q.appendChild(c(w,"insertSheetColumn"));m.appendChild(q);l.appendChild(m);r.appendChild(c(w,"shiftCellLeft"));r.appendChild(c(w,"shiftCellUp"));r.appendChild(c(w,"deleteSheetRow"));r.appendChild(c(w,"deleteSheetColumn"));n.appendChild(r);l.appendChild(n);l.appendChild(c(w,"clearContent"));l.appendChild(new zul.menu.Menuseparator());u.appendChild(c(w,"reapplyFilter","/web/zss/img/funnel--arrow.png"));u.appendChild(c(w,"filter","/web/zss/img/funnel--pencil.png"));o.appendChild(u);l.appendChild(o);t.appendChild(c(w,"sortAscending","/web/zss/img/asc.png"));t.appendChild(c(w,"sortDescending","/web/zss/img/des.png"));t.appendChild(c(w,"customSort"));v.appendChild(t);l.appendChild(v);l.appendChild(new zul.menu.Menuseparator());function s(A){var z=A.pageX,y=A.pageY,x=A.sheet,p=zss.SSheetCtrl._calCellPos(x,z,y);return x.getCell(p[0],p[1])}l.appendChild(i(w,"insertComment",null,function(p){this.setVisible(!s(p).comment)}));l.appendChild(i(w,"editComment",null,function(p){this.setVisible(s(p).comment)}));l.appendChild(i(w,"deleteComment",null,function(p){this.setVisible(s(p).comment)}));l.appendChild(new zul.menu.Menuseparator());l.appendChild(c(w,"formatCell"));l.appendChild(c(w,"dataValidation"));l.appendChild(c(w,"hyperlink"));l.appendChild(c(w,"richTextEdit"));return l},style:function(){return new zss.StylePanel(this._wgt)}});zss.Buttons=zk.$extends(zk.Object,{},{HOME_DEFAULT:["newBook","saveBook","exportPDF","separator","paste","cut","copy","separator","fontFamily","fontSize","fontBold","fontItalic","fontUnderline","fontStrike","border","fontColor","backColor","separator","verticalAlign","horizontalAlign","textIndentDecrease","textIndentIncrease","wrapText","mergeAndCenter","separator","insert","del","format","separator","autoSum","clear","sortAndFilter","separator","protectSheet","gridlines","separator","insertPicture","insertChart","hyperlink"],INSERT_DEFAULT:["insertPicture","separator","columnChart","lineChart","pieChart","barChart","areaChart","scatterChart","otherChart","separator","hyperlink"],FORMULA_DEFAULT:["insertFunction","autoSum","financial","logical","text","dateAndTime","lookupAndReference","mathAndTrig","moreFunction"]});function g(p,n,o,l){var m=msgzss.action[n];return new zss.Toolbarbutton({$action:n,tooltiptext:l?null:m,label:l?m:null,image:o?zk.ajaxURI(o,{au:true}):null,onClick:function(){var q=p.sheetCtrl;if(q){var t=q.getLastSelection(),x=t.top,r=t.left,v=t.bottom,w=t.right,u=q.selType?q.selType:zss.SEL.CELL;q.triggerSelection(x,r,v,w);p.fireToolbarAction(n,{tRow:x,lCol:r,bRow:v,rCol:w,type:u})}else{p.fireToolbarAction(n,{tRow:-1,lCol:-1,bRow:-1,rCol:-1,type:zss.SEL.ALL})}}},p)}function e(l){return(!!zss.ColorbuttonEx&&l.getColorPickerExUsed())?zss.ColorbuttonEx:zss.Colorbutton}zss.ButtonBuilder=zk.$extends(zk.Object,{$init:function(m,l){this._wgt=m;this._popupHodler=l;this.contents=[];this.isStylePanel=l.$instanceof(zss.StylePanel);this.isToolbar=l.$instanceof(zss.ResizeableToolbar)},applyHolder:function(l){if(this._popupHodler){this._popupHodler.appendChild(l)}return l},add:function(l){this.contents.push(l);return this},addAll:function(o){var n=this.contents;for(var m=0,l=o.length;m<l;m++){n.push(o[m])}return this},build:function(){var m=[],l=this.contents;while(fn=l.shift()){m.push(this[fn]())}return m},separator:function(){return new zss.ToolbarbuttonSeparator({$action:"separator"})},newBook:function(){return g(this._wgt,"newBook","/web/zss/img/document-medium.png")},saveBook:function(){return g(this._wgt,"saveBook","/web/zss/img/disk-black.png")},exportPDF:function(){return g(this._wgt,"exportPDF","/web/zss/img/document-pdf.png")},paste:function(){var m=this._wgt;var l=g(m,"paste","/web/zss/img/clipboard-paste.png");l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).paste()));return l},cut:function(){return g(this._wgt,"cut","/web/zss/img/scissors-blue.png")},copy:function(){return g(this._wgt,"copy","/web/zss/img/blue-document-copy.png")},fontFamily:function(){return new zss.FontFamilyCombobox({$action:"fontFamily",width:"115px"},this._wgt,this)},fontSize:function(){return new zss.FontSizeCombobox({$action:"fontSize",width:"55px"},this._wgt,this)},_skipNoShow:function(){return(this.isStylePanel&&!this._wgt.getShowContextMenu())||(this.isToolbar&&!this._wgt.getShowToolbar())},_skipEvent:function(m,l){if(this._skipNoShow()){return true}if(m.name=="onCellSelection"){var n=m.data;if(n.top==l.preRow&&n.left==l.preCol){return true}l.preRow=n.top;l.preCol=n.left;return false}else{if(m.name=="onCellUpdate"){var n=m.data;return(n.top!=l.preRow||n.left!=l.preCol)}}return true},fontBold:function(){var o=this._wgt,l=g(o,"fontBold","/web/zss/img/edit-bold.png"),n=this,m=function(p){if(n._skipEvent(p,l)){return}var q=o.sheetCtrl;if(q){var r=p.data,s=q.getCell(r.top,r.left);if(s){l.setSelectedEffect(s.isFontBold())}}};l.listen({onBind:function(){var p=o.sheetCtrl;if(p){p.listen({onCellSelection:m,onCellUpdate:m})}}});l.listen({onClick:function(){if(!l.isDisabled()){l.setSelectedEffect(true)}}});return l},fontItalic:function(){var o=this._wgt,l=g(this._wgt,"fontItalic","/web/zss/img/edit-italic.png"),n=this,m=function(p){if(n._skipEvent(p,l)){return}var q=o.sheetCtrl;if(q){var r=p.data,s=q.getCell(r.top,r.left);if(s){l.setSelectedEffect(s.isFontItalic())}}};l.listen({onBind:function(){var p=o.sheetCtrl;if(p){p.listen({onCellSelection:m,onCellUpdate:m})}}});l.listen({onClick:function(){if(!l.isDisabled()){l.setSelectedEffect(true)}}});return l},fontUnderline:function(){var o=this._wgt,l=g(this._wgt,"fontUnderline","/web/zss/img/edit-underline.png"),n=this,m=function(p){if(n._skipEvent(p,l)){return}var q=o.sheetCtrl;if(q){var r=p.data,s=q.getCell(r.top,r.left);if(s){l.setSelectedEffect(s.isFontUnderline())}}};l.listen({onBind:function(){var p=o.sheetCtrl;if(p){p.listen({onCellSelection:m,onCellUpdate:m})}}});l.listen({onClick:function(){if(!l.isDisabled()){l.setSelectedEffect(true)}}});return l},fontStrike:function(){var o=this._wgt,l=g(this._wgt,"fontStrike","/web/zss/img/edit-strike.png"),n=this,m=function(p){if(n._skipEvent(p,l)){return}var q=o.sheetCtrl;if(q){var r=p.data,s=q.getCell(r.top,r.left);if(s){l.setSelectedEffect(s.isFontStrikeout())}}};l.listen({onBind:function(){var p=o.sheetCtrl;if(p){p.listen({onCellSelection:m,onCellUpdate:m})}}});l.listen({onClick:function(){if(!l.isDisabled()){l.setSelectedEffect(true)}}});return l},border:function(){var n=this._wgt,m=this.applyHolder(new zss.MenupopupFactory(n).border()),l=new zss.Toolbarbutton({$action:"border",tooltiptext:msgzss.action.border,image:zk.ajaxURI("/web/zss/img/border-bottom.png",f),onClick:function(){var q=n.sheetCtrl;if(q){var p=q.getLastSelection(),o=m.colorMenu?m.colorMenu.getColor():"",r=q.selType?q.selType:zss.SEL.CELL;n.fireToolbarAction("border",{color:o,tRow:p.top,lCol:p.left,bRow:p.bottom,rCol:p.right,type:r})}}},n);l.setPopup(m);return l},backColor:function(){var m=this._wgt;var l=e(m);return new l({$action:"backColor",color:"#FFFFFF",tooltiptext:msgzss.action.backColor,image:zk.ajaxURI("/web/zss/img/paint-can-color.png",f),onClick:function(){var o=m.sheetCtrl;if(o){var n=o.getLastSelection(),p=o.selType?o.selType:zss.SEL.CELL;m.fireToolbarAction("backColor",{color:this.getColor(),tRow:n.top,lCol:n.left,bRow:n.bottom,rCol:n.right,type:p})}}},m,this._popupHodler)},fontColor:function(){var m=this._wgt;var l=e(m);return new l({$action:"fontColor",color:"#000000",tooltiptext:msgzss.action.fontColor,image:zk.ajaxURI("/web/zss/img/edit-color.png",f),onClick:function(){var o=m.sheetCtrl;if(o){var n=o.getLastSelection(),p=o.selType?o.selType:zss.SEL.CELL;m.fireToolbarAction("fontColor",{color:this.getColor(),tRow:n.top,lCol:n.left,bRow:n.bottom,rCol:n.right,type:p})}}},m,this._popupHodler)},verticalAlign:function(){var r=this._wgt,l=g(r,"verticalAlign","/web/zss/img/edit-vertical-alignment-top.png"),q=this.applyHolder(new zss.MenupopupFactory(r).verticalAlign()),n=q.firstChild,o=this,m=function(s){if(o._skipEvent(s,l)){return}var t=r.sheetCtrl;if(t){var v=s.data,w=t.getCell(v.top,v.left);if(w){var p=w.getVerticalAlign(),u=q.firstChild;for(;u;u=u.nextSibling){if(u.get$action()==p){l.setSelectedEffect(true,u);break}}}}};l.listen({onBind:function(){var p=r.sheetCtrl;if(p){p.listen({onCellSelection:m,onCellUpdate:m})}}});for(;n;n=n.nextSibling){n.listen({onClick:function(){if(!l.isDisabled()){l.setSelectedEffect(true,n)}}})}l.setClickDisabled(true);l.setPopup(q);return l},horizontalAlign:function(){var r=this._wgt,l=g(r,"horizontalAlign","/web/zss/img/edit-alignment.png"),q=this.applyHolder(new zss.MenupopupFactory(r).horizontalAlign()),n=q.firstChild,o=this,m=function(s){if(o._skipEvent(s,l)){return}var t=r.sheetCtrl;if(t){var v=s.data,w=t.getCell(v.top,v.left);if(w){var p=w.getHorizontalAlign(),u=q.firstChild;for(;u;u=u.nextSibling){if(u.get$action()==p){l.setSelectedEffect(true,u);break}}}}};l.listen({onBind:function(){var p=r.sheetCtrl;if(p){p.listen({onCellSelection:m,onCellUpdate:m})}}});for(;n;n=n.nextSibling){n.listen({onClick:function(){if(!l.isDisabled()){l.setSelectedEffect(true,n)}}})}l.setClickDisabled(true);l.setPopup(q);return l},textIndentIncrease:function(){return g(this._wgt,"textIndentIncrease","/web/zss/img/edit-indent.png")},textIndentDecrease:function(){return g(this._wgt,"textIndentDecrease","/web/zss/img/edit-outdent.png")},wrapText:function(){var o=this._wgt,l=g(o,"wrapText","/web/zss/img/edit-wrap.png"),n=this,m=function(p){if(n._skipEvent(p,l)){return}var q=o.sheetCtrl;if(q){var r=p.data,s=q.getCell(r.top,r.left);if(s){l.setSelectedEffect(s.wrap)}}};l.listen({onBind:function(){var p=o.sheetCtrl;if(p){p.listen({onCellSelection:m,onCellUpdate:m})}}});return l},mergeAndCenter:function(){var m=this._wgt,l=g(m,"mergeAndCenter",null,true);l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).mergeAndCenter()));return l},insert:function(){var m=this._wgt,l=g(m,"insert","/web/zss/img/document-insert.png");l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).insert()));l.setClickDisabled(true);return l},del:function(){var m=this._wgt,l=g(m,"del","/web/zss/img/document-hf-delete-footer.png");l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).del()));l.setClickDisabled(true);return l},format:function(){},insertPicture:function(){return g(this._wgt,"insertPicture","/web/zss/img/image.png")},insertChart:function(){var m=this._wgt,l=g(m,"insertChart","/web/zss/img/chart.png");l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).insertChart()));return l},columnChart:function(){var m=this._wgt,l=g(m,"columnChart",null,true);l.setClickDisabled(true);l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).columnChart()));return l},lineChart:function(){var m=this._wgt,l=g(m,"lineChart",null,true);l.setClickDisabled(true);l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).lineChart()));return l},pieChart:function(){var m=this._wgt,l=g(m,"pieChart",null,true);l.setClickDisabled(true);l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).pieChart()));return l},barChart:function(){var m=this._wgt,l=g(m,"barChart",null,true);l.setClickDisabled(true);l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).barChart()));return l},areaChart:function(){var l=g(this._wgt,"areaChart",null,true);return l},scatterChart:function(){return g(this._wgt,"scatterChart",null,true)},otherChart:function(){var m=this._wgt,l=g(m,"otherChart",null,true);l.setClickDisabled(true);l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).otherChart()));return l},hyperlink:function(){return g(this._wgt,"hyperlink","/web/zss/img/hyperlink.png")},clear:function(){var m=this._wgt,l=g(m,"clear","/web/zss/img/broom.png");l.setClickDisabled(true);l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).clear()));return l},sortAndFilter:function(){var m=this._wgt,l=g(m,"sortAndFilter","/web/zss/img/sort-filter.png");l.setPopup(this.applyHolder(new zss.MenupopupFactory(m).sortAndFilter()));l.setClickDisabled(true);return l},autoSum:function(){},insertFunction:function(){return g(this._wgt,"insertFunction",null,true)},financial:function(){return g(this._wgt,"financial",null,true)},logical:function(){return g(this._wgt,"logical",null,true)},text:function(){return g(this._wgt,"text",null,true)},dateAndTime:function(){return g(this._wgt,"dateAndTime",null,true)},lookupAndReference:function(){return g(this._wgt,"lookupAndReference",null,true)},mathAndTrig:function(){return g(this._wgt,"mathAndTrig",null,true)},moreFunction:function(){return g(this._wgt,"moreFunction",null,true)},protectSheet:function(){var m=this._wgt,l=new zss.ProtectSheetCheckbutton({checked:m.isProtect(),tooltiptext:msgzss.action.protectSheet,image:zk.ajaxURI("/web/zss/img/lock.png",f),onClick:function(){m.fireToolbarAction("protectSheet")}},m);return l},gridlines:function(){var m=this._wgt,l=new zss.DisplayGridlinesCheckbutton({checked:m.isDisplayGridlines(),tooltiptext:msgzss.action.gridlines,image:zk.ajaxURI("/web/zss/img/grid.png",f),onClick:function(){m.fireToolbarAction("gridlines")}},m);return l}})})();
(function(){function d(o,l,m,n){return{top:o,left:l,bottom:m,right:n}}function h(n,r){var q=r.hs,o=r.s,l=r.e,m=0;for(;o<=l;o++){var p=n[o]=q[m++];p.i=o}}var a=1,e=2,c=3,i=4,k=5,f=6;function g(l,m,q,o,n,p){var r={update:function(L,x,y,t,H,M){var C=x==a,B=(C||x==e),A=(C||x==c),D=(C||x==i),R=(C||x==k),E=(C||x==f),Q=L.ct;this.cellType=Q!=undefined?Q:3;this._cah=L._cah;this._txtwd=L.wd;if(B){var O=L.meft;if(O!=undefined){this.text=this.editText=this.formatText=t[O]||""}else{var W=L.t,P=L.et;fId=L.ft;this.text=W!=undefined?t[W]:"";this.editText=P!=undefined?t[P]:"";this.formatText=fId!=undefined?t[fId]:""}}if(A){var F=L.s,Y=L.is,V=L.os,I=L.wp,u=L.rb,X=L.l,K=L.ha,z=L.va,w=L.fs,T=L.ff,S=L.rot;this.style=F!=undefined?H[F]:"";this.innerStyle=Y!=undefined?H[Y]:"";this.fontStyle=V!=undefined?H[V]:"";this.wrap=I!=undefined;this.indention=L.ind||0;this.lock=X!=undefined?X!="f":true;this.halign=K||"l";this.valign=z||"b";this.rightBorder=u!=undefined;if(w){this.fontSize=w}this.fontFormat=T;if(L.db){this.db_tlbr=L.db}else{delete this.db_tlbr}if(L.af){this.af_tlbr=L.af}else{delete this.af_tlbr}if(L.dbar){this.dbar=L.dbar}else{delete this.dbar}this.rotate=S}if(D){this.overflow=!!L.ovf;this.overflowOpt=L.ovf?L.ovf:0}if(R){var N=L.mi,s=L.mc;if(N!=undefined){var U=M.r[N],J=M.cs[s];this.mergeId=U.i;this.mergeCls=J;if(this.mergeId){this.merge=d(U.t,U.l,U.b,U.r)}}else{if(this.mergeId){delete this.mergeId;delete this.mergeCls;delete this.merge}}}if(E){var G=L.cmt;if(G!=undefined){this.comment=G}else{delete this.comment}}}};r.update(l,m,q,o,n,p);return r}function j(l,n,r,m,p,o,q){var s={r:l.r,heightId:l.h,cells:{},updateRowHeightId:function(v){this.heightId=v;var t=this.cells;for(var u in t){t[u].heightId=v}},update:function(B,D,v,G,w,H,y){var u=B.cs,z=v,x=0,F,t=this.r,A=this.cells,E=this.heightId;for(;z<=G;z++){var C=A[z];if(!C){C=A[z]=g(u[x++],D,E,w,H,y);C.r=t;C.c=z}else{C.update(u[x++],D,E,w,H,y)}if(!C.heightId&&E){C.heightId=E}}},removeColumns:function(u,w,z){var y=this.cells,v=w,x=u;for(var A=u;A<=z;A++){var t=y[A];if(t){if(v>0){delete y[A];v--}else{delete y[A];t.c-=w;y[t.c]=t}}}},getCell:function(t){return this.cells[t]}};s.update(l,n,r,m,p,o,q);return s}zss.ActiveRange=zk.$extends(zk.Object,{rect:null,$init:function(l){this.rows={};this.rowHeaders={};this.columnHeaders={};this.update(l);this.id=l.id},size:function(){var n=this.rect,l=(n.bottom-n.top)+1,m=(n.right-n.left)+1;return l*m},updateColumnWidthId:function(l,s){var m=this.rect,p=m.top,o=m.bottom,n=this.rows,q=this.columnHeaders[l];if(q){q.p=s}if(this.topFrozen){this.topFrozen.updateColumnWidthId(l,s)}if(this.leftFrozen){this.leftFrozen.updateColumnWidthId(l,s)}if(this.cornerFrozen){this.cornerFrozen.updateColumnWidthId(l,s)}},getColumnWidthId:function(l){var m=this.columnHeaders[l];return m?m.p:null},updateRowHeightId:function(m,o){var l=this.rows[m],n=this.rowHeaders[m];if(l){l.updateRowHeightId(o)}if(n){n.p=o}if(this.topFrozen){this.topFrozen.updateRowHeightId(m,o)}if(this.leftFrozen){this.leftFrozen.updateRowHeightId(m,o)}if(this.cornerFrozen){this.cornerFrozen.updateRowHeightId(m,o)}},getRowHeightId:function(m){var l=this.rowHeaders[m];return l?l.p:null},updateBoundary:function(m,r,q,o,n){var p=this.rect;var l;if(!p){this.rect=d(r,q,o,n);return}else{if(this.containsRange(r,q,o,n)){return}else{var p=this.rect;switch(m){case"visible":p.right=n;p.bottom=o;break;case"jump":delete this.rect;delete this.columnHeaders;this.rect=d(r,q,o,n);this.rows={};this.rowHeaders={};this.columnHeaders={};break;case"east":case"west":if(r==p.top&&o==p.bottom){if(m=="east"){p.right=n}else{if(m=="west"){p.left=q}}}else{if(r>p.bottom||o<p.top){l=d(r,q,o,n)}else{r=Math.max(r,p.top);o=Math.min(o,p.bottom);q=(m=="west"?q:p.left);n=(m=="east"?n:p.right);l=d(r,q,o,n)}this.pruneOutside(l);this.rect=l}break;case"south":case"north":if(q==p.left&&n==p.right){if(m=="south"){p.bottom=o}else{if(m=="north"){p.top=r}}}else{if(q>p.right||n<p.left){l=d(r,q,o,n)}else{r=(m=="north"?r:p.top);o=(m=="south"?o:p.bottom);q=Math.max(q,p.left);n=Math.min(n,p.right);l=d(r,q,o,n)}this.pruneOutside(l);this.rect=l}break}}}},pruneOutside:function(l){var n=this.rows;var m,o;for(m=this.rect.top;m<=this.rect.bottom;++m){if(l.top<=m&&m<=l.bottom){for(o=this.rect.left;o<=this.rect.right;++o){if(!(l.left<=o&&o<=l.right)){if(n[m]&&n[m].cells[o]){delete n[m].cells[o]}}}}else{delete n[m]}}},pruneLeft:function(v){var u=this.rows,o=this.rect.left,n=this.columnHeaders;for(var m in u){var l=u[m],t=l.cells,s=o,q=v;while(q--){delete t[s++]}}s=o;q=v;while(q--){delete n[s++]}this.rect.left=o+v;if(this.topFrozen){this.topFrozen.pruneLeft(v)}},pruneRight:function(v){var u=this.rows,t=this.rect.right,n=this.columnHeaders;for(var m in u){var l=u[m],s=l.cells,q=t,o=v;while(o--){delete s[q--]}}q=t,o=v;while(o--){delete n[q--]}this.rect.right=t-v;if(this.topFrozen){this.topFrozen.pruneRight(v)}},pruneTop:function(o){var p=this.rows,l=this.rowHeaders,n=this.rect.top,m=o;while(m--){delete p[n];delete l[n];n++}if(this.leftFrozen){this.leftFrozen.pruneTop(o)}this.rect.top+=o},pruneBottom:function(o){var p=this.rows,l=this.rowHeaders,n=this.rect.bottom,m=o;while(m--){delete p[n];delete l[n];n--}if(this.leftFrozen){this.leftFrozen.pruneBottom(o)}this.rect.bottom-=o},containsRange:function(p,l,n,o){var m=this.rect;return p>=m.top&&l>=m.left&&n<=m.bottom&&o<=m.right},insertNewColumn:function(n,l,m){this.insertNewColumn_(n,l,m);if(this.cornerFrozen){this.cornerFrozen.insertNewColumn(n,l,m)}if(this.topFrozen){this.topFrozen.insertNewColumn(n,l,m)}if(this.leftFrozen){this.leftFrozen.insertNewColumn(n,l,m)}},removeColumns:function(l,m,n){this.removeColumns_(l,m,n);if(this.cornerFrozen){this.cornerFrozen.removeColumns(l,m,n)}if(this.topFrozen){this.topFrozen.removeColumns(l,m,n)}if(this.leftFrozen){this.leftFrozen.removeColumns(l,m,n)}},insertNewRow:function(m,l,n){this.insertNewRow_(m,l,n);if(this.cornerFrozen){this.cornerFrozen.insertNewRow(m,l,n)}if(this.topFrozen){this.topFrozen.insertNewRow(m,l,n)}if(this.leftFrozen){this.leftFrozen.insertNewRow(m,l,n)}},removeRows:function(n,l,m){this.removeRows_(n,l,m);if(this.cornerFrozen){this.cornerFrozen.removeRows(n,l,m)}if(this.topFrozen){this.topFrozen.removeRows(n,l,m)}if(this.leftFrozen){this.leftFrozen.removeRows(n,l,m)}},insertNewColumn_:function(u,B,p){var m=this.rect;if(u<m.left||m.right<u){return}h(this.columnHeaders,p);var A=this.rows;var v=m.right;for(var l=m.top;l<=m.bottom;l++){var w=A[l].cells;var x=u;var t=u+B;var n=[];var s=zss.ActiveRange.clone;for(;x<t;x++){n.push(s(w[x]))}t=u-1;x=v;while(x>t){var y=w[x--];var z=y.c;var o=z+B;y.c=o;w[o]=y;w[z]=null}var q;x=u;while(q=n.shift()){w[x++]=q}}this.rect.right+=B},removeColumns_:function(o,v,n){var m=this.rect;if(o<m.left||m.right<o){return}h(this.columnHeaders,n);var u=this.rows;var q=m.right;var s=m.top;var p=m.bottom;for(var l=s;l<=p;l++){var t=u[l];if(t){t.removeColumns(o,v,q)}}this.rect.right-=v},insertNewRow_:function(p,A,s){var m=this.rect;if(p<m.top||m.bottom<p){return}h(this.rowHeaders,s);var z=this.rows;var o=m.left;var v=m.right;var l=p;var n=p+A;var w=[];var t=zss.ActiveRange.copyRow;for(;l<n;l++){w.push(t(o,v,z[l]))}n=p-1;l=m.bottom;while(l>n){var y=z[l--];var x=y.r;var q=x+A;y.r=q;z[q]=y;z[x]=null}var u;l=p;while(u=w.shift()){z[l++]=u}this.rect.bottom+=A},removeRows_:function(t,n,s){var l=this.rect;if(t<l.top||l.bottom<t){return}h(this.rowHeaders,s);var p=this.rows;var q=this.rect.bottom;var m=n;for(var o=t;o<=q;o++){var t=p[o];if(t){if(m>0){delete p[o];m--}else{delete p[o];t.r-=n;p[t.r]=t}}}this.rect.bottom-=n},fetchUpdate:function(l){var q=l.t,p=l.l,n=l.b,m=l.r,o=this.rect;if(o.top==n+1){this.update(l,"north")}else{if(o.left==m+1){this.update(l,"west")}else{if(o.right==p-1){this.update(l,"east")}else{if(o.bottom==q-1){this.update(l,"south")}}}}},update:function(l,m){if(l.leftFrozen){l.leftFrozen.dir=l.dir}if(l.topFrozen){l.topFrozen.dir=l.dir}if(l.cornerFrozen){l.cornerFrozen.dir=l.dir}if(l.leftFrozen){if(this.leftFrozen){this.leftFrozen.update(l.leftFrozen,m)}else{this.leftFrozen=new zss.FreezeActiveRange(l.leftFrozen)}}if(l.topFrozen){if(this.topFrozen){this.topFrozen.update(l.topFrozen,m)}else{this.topFrozen=new zss.FreezeActiveRange(l.topFrozen)}}if(l.cornerFrozen){if(this.cornerFrozen){this.cornerFrozen.update(l.cornerFrozen,m)}else{this.cornerFrozen=new zss.FreezeActiveRange(l.cornerFrozen)}}this.updateCells(l,m)},updateCells:function(w,C){var J=w.at;var A=w.t;var n=w.l;var r=w.b;var H=w.r;var p=w.rs;var q=w.s;var I=w.st;var G=w.m;var m=w.rhs;var B=w.chs;var E=A;var y=0;var C=C||w.dir;var D;var u={};var x={};if("jump"==C){u=this.oldRows=this.rows,x=this.oldRowHeaders=this.rowHeaders}this.updateBoundary(C,A,n,r,H);var t=this.rows;for(;E<=r;E++){var o=t[E];if(!o){o=t[E]=j(p[y++],J,n,H,q,I,G);if("jump"==C){D=u[E];if(D&&D.heightId&&!o.heightId){o.updateRowHeightId(D.heightId)}}}else{o.update(p[y++],J,n,H,q,I,G)}}if(m){h(this.rowHeaders,m);if("jump"==C){var l=this.rowHeaders;for(var E in l){var F=l[E],z=x[E];if(!F.p&&z&&z.p){F.p=z.p}}}}if(B){h(this.columnHeaders,B)}if("jump"==C){delete this.oldRows;delete this.oldRowHeaders}},getRow:function(l){return this.rows[l]},clone:function(y,o,u,v,n){var A=this.rows,w=this.rowHeaders,t=this.columnHeaders,p=n.rowHeaders,z=n.columnHeaders,q=zss.ActiveRange.copyRow,s=zss.ActiveRange.clone;for(var m=y;m<=u;m++){var l=n.getRow(m);A[m]=q(o,v,l);w[m]=s(p[m])}for(var x=o;x<=v;x++){t[x]=s(z[x])}}},{copyRow:function(m,o,l){var n={r:l.r,heightId:l.heightId,cells:{},update:l.update,getCell:l.getCell,updateRowHeightId:l.updateRowHeightId,removeColumns:l.removeColumns};zss.ActiveRange.copyCells(m,o,l,n);return n},copyCells:function(o,r,m,q){var l=m.cells,p=q.cells,n=zss.ActiveRange.clone;for(var s=o;s<=r;s++){p[s]=n(l[s])}},clone:function(m){var n={};for(var l in m){n[l]=m[l]}return n}});function b(p,o,l){for(var m in l){var n=l[m];p[n]=o[n]}}zss.Snapshot=zk.$extends(zk.Object,{$init:function(u){var r=u.sheetCtrl,o=r.dp,n=r.lp,q=r.tp,p=r.sp,m=zss.SSheetCtrl._getVisibleRange(r);b(this,u,["_scss","_displayGridlines","_rowFreeze","_columnFreeze","_rowHeight","_columnWidth","_protect","_maxRows","_maxColumns"]);this.setCustRowHeight(r.custRowHeight.custom);this.setCustRowLastId(r.custRowHeight.ids.last);this.setCustColWidth(r.custColWidth.custom);this.setCustColLastId(r.custColWidth.ids.last);this.setMergeMatrix(r.mergeMatrix.mergeMatrix);this.setVisibleRange(m);this.setFocus(r.getLastFocus());this.setSelection(r.getLastSelection());if(r.isHighlightVisible()){this.setHighlight(r.getLastHighlight())}this.setDataPanelSize({width:o.width,height:o.height});this.setScrollPanelPos({scrollLeft:p.currentLeft,scrollTop:p.currentTop});this.setLeftPanelPos(n.toppos);this.setTopPanelPos(q.leftpos);if(u.getDataValidations){var l=u.getDataValidations();if(l){this.setDataValidations(l)}}if(u.getAutoFilter){var s=u.getAutoFilter();if(s){this.setAutoFilter(s)}}if(u.getTableFilters){var t=u.getTableFilters();if(t){this.setTableFilters(t)}}},$define:{scss:null,rowFreeze:null,columnFreeze:null,rowHeight:null,columnWidth:null,protect:null,displayGridlines:null,custRowHeight:null,custRowLastId:null,custColWidth:null,custColLastId:null,mergeMatrix:null,visibleRange:null,dataPanelSize:null,scrollPanelPos:null,leftPanelPos:null,topPanelPos:null,focus:null,selection:null,highlight:null,dataValidations:null,autoFilter:null,tableFilters:null,maxRows:null,maxColumns:null}});zss.CacheCtrl=zk.$extends(zk.Object,{selected:null,$init:function(m,l){this._wgt=m;this.sheet=m.sheetCtrl;this.sheets={};this.snapshots={};this.setSelectedSheet(l)},snap:function(l){return this.snapshots[l]=new zss.Snapshot(this._wgt)},getSnapshot:function(l){return this.snapshots[l]},isCached:function(l){return !!this.sheets[l]},releaseCache:function(l){if(this.sheets[l]&&this.sheets[l]!=this.selected){delete this.sheets[l]}if(this.snapshots[l]){delete this.snapshots[l]}},releaseSelectedCache:function(l){if(this.selected&&this.selected.id==l){delete this.sheets[l];delete this.selected}if(this.snapshots[l]){delete this.snapshots[l]}},setSelectedSheetBy:function(l){this.selected=this.sheets[l]},getSheetBy:function(l){return this.sheets[l]},setSelectedSheet:function(m){var n=m.id,l=this.sheets[n]=new zss.ActiveRange(m);this.selected=l},getSelectedSheet:function(){return this.selected}});zss.FreezeActiveRange=zk.$extends(zss.ActiveRange,{$init:function(l){this.$supers(zss.FreezeActiveRange,"$init",[l])},update:function(l,m){this.updateCells(l,m)},insertNewColumn:function(n,l,m){this.insertNewColumn_(n,l,m)},removeColumns:function(l,m,n){this.removeColumns_(l,m,n)},insertNewRow:function(m,l,n){this.insertNewRow_(m,l,n)},removeRows:function(n,l,m){this.removeRows_(n,l,m)}})})();
(function(){zss.CellBlockCtrl=zk.$extends(zk.Widget,{widgetName:"CellBlock",range:null,_lastDir:null,$o:zk.$void,$init:function(h,k,b,f,g,e,j){this.$supers(zss.CellBlockCtrl,"$init",[]);this.sheet=h;this.type=j;this.rows=[];this.range=new zss.Range(b,k,g,f);this._tmpMerges={};this._toReset={};this._toSet={};var m=e.rows,d=this;for(var a=k;a<=f;a++){var l=new zss.Row(h,d,a,e);for(var i=b;i<=g;i++){l.appendCell(new zss.Cell(h,d,a,i,e))}this.appendRow(l)}},setVisible:function(a){if(this._visible!=a){this._visible=a;var b=this.$n();if(b){b.style.visibility=a?"visible":"hidden"}}},redraw:function(a){var e=this.rows,d=this.isVisible()?"visible":"hidden",c=e.length;a.push('<div id="',this.uuid,'" class="',this.getZclass(),'" style="visibility:'+d+';">');for(var b=0;b<c;b++){e[b].redraw(a)}a.push("</div>")},getZclass:function(){var a=this.type;return a?"zs"+a+"block":"zsblock"},bind_:function(){this._newrange=this.range;this.$supers(zss.CellBlockCtrl,"bind_",arguments);var a=this.comp=this.$n();this._setTempMergeCells();delete this._newrange},unbind_:function(){this.$supers(zss.CellBlockCtrl,"unbind_",arguments);delete this.rows;this.sheet=this.comp=this.rows=this.range=null},doMouseDown_:function(a){this.sheet._doMousedown(a)},doMouseUp_:function(a){this.sheet._doMouseup(a)},getRow:function(b){var a=this.range;if(b<a.top||b>a.bottom){return null}return this.rows[b-a.top]},getCell:function(c,b){var a=this.range;if(!a||c<a.top||c>a.bottom||b<a.left||b>a.right){return null}return this.rows[c-a.top].getCellAt(b-a.left)},addMergeRange:function(c,e,h,j,b,d){var k=ctrl=this.getCell(h,e);if(!k){return}var g;for(var a=h;a<=b;++a){for(var f=e;f<=j;f++){if(f==e&&a==h){g=k.comp;jq(g).addClass("zsmerge"+c)}else{k=this.getCell(a,f);if(!k){break}g=k.comp;jq(g).addClass(a==h?"zsmergee":"zsmergeeu")}k.merid=c;k.merr=j;k.merl=e;k.mert=h;k.merb=b}}ctrl.redoRotate=true;this.update_(h,e,h,e)},removeMergeRange:function(d,g,l,n,b,e){var o=ctrl=this.getCell(l,g);if(!o){return}var f=o.merl,p=o.merr,m=o.mert,k=o.merb,c=o.merid;if(d!=c){return}var q,j;for(var a=m;a<=k;++a){for(var h=f;h<=p;h++){if(h==f&&a==m){j=o.comp;jq(j).removeClass("zsmerge"+d)}else{o=this.getCell(a,h);if(!o){break}j=o.comp;jq(j).removeClass(a==m?"zsmergee":"zsmergeeu")}o.merid=o.merr=o.merl=o.mert=o.merb=q}}ctrl.redoOverflow=true;ctrl.redoRotate=true;this.update_(l,g,l,g)},update_:function(h,d,f,g,b){for(var e=h;e<=f;e++){if(b){this._updateRowCacheSrc(e)}for(var i=d;i<=g;i++){var a=this.getCell(e,i);if(a){a.update_(b)}}}},_updateRowCacheSrc:function(d){var a=this.range;if(!a||d<a.top||d>a.bottom){return}var b=this.sheet._wgt._cacheCtrl,c=b?b.getSelectedSheet():null;if(c){this.rows[d-a.top]._updateCacheSrc(c)}},create_:function(v,C,w,e,q,D){var f=this.sheet,D=D||f._wgt._cacheCtrl.getSelectedSheet(),n=this,h=this.range,m=this.rows,u=false,A="north"==v,t="south"==v,k="jump"==v,o=A||t||k,g="west"==v,b="east"==v,a=new zss.Range(h.left,h.top,h.width,h.height,true),x=q-w+1;if(g){a.extendLeft(x)}else{if(b){a.extendRight(x)}}this._newrange=a;for(var s=C,y=0;s<=e;s++){var l=o?new zss.Row(f,n,s,D):this.getRow(s),p=o?l.getHtmlPrologHalf():"";for(var B=w,z=0;B<=q;B++){var d=new zss.Cell(f,n,s,B,D);if(g){l.insertCell(z++,d)}else{if(b){l.appendCell(d)}else{if(o){l.appendCell(d,true);p+=d.getHtml()}}}}if(o){p+=l.getHtmlEpilogHalf()}else{if(l._prepareAutoFilterBtns){l._prepareAutoFilterBtns()}}if(t){this.appendRow(l,p,true)}else{if(A){this.insertRow(y++,l,p,true)}}}delete f._wrapRange;this.range=this._newrange;this._resetTempMergeCells(a.left,a.top,a.right,a.bottom);this._setTempMergeCells();delete this._newrange;if(f._cah){f.fireProcessAutoHeight_();delete f._cah}},appendZSW:function(a,d){if(a>this.range.right||a<this.range.left){return}rows=this.rows;var c=rows.length;for(var b=0;b<c;b++){rows[b].appendZSW(a-this.range.left,d)}},appendZSH:function(b,a){if(b>this.range.bottom||b<this.range.top){return}this.rows[b-this.range.top].appendZSH(a)},insertNewColumn:function(b,d){if(b>(this.range.right+1)||b<this.range.left){return}var a=b-this.range.left;rows=this.rows;var e=rows.length;for(var c=0;c<e;c++){rows[c].insertNewCell(a,d)}this.range.extendRight(d)},insertNewRow:function(k,m,f){if(k>(this.range.bottom+1)||k<this.range.top){return}var h=k-this.range.top,b,l=this.rows,c=(h>=l.length)?l[l.length-1]:l[h],j=this.sheet,f=j._wgt._cacheCtrl.getSelectedSheet(),d=this;for(var e=0;e<m;e++){var a=k+e,g="";b=new zss.Row(j,d,a,f);b.zsh=null;g+=b.getHtmlPrologHalf();g+=zss.Row.copyCells(c,b);this.insertRow(h+e,b,g)}this.shiftRowInfo(h+m,k+m);this.range.extendBottom(m);if(this._newrange){this._newrange.extendBottom(m)}},shiftRowInfo:function(b,f){var e=this.rows,d=this.rows.length,a=0;for(var c=b;c<d;c++){e[c].resetRowIndex(f+(a++))}},removeColumn:function(b,d){if(b>(this.range.right+1)||b<this.range.left){return}var a=b-this.range.left;if((b+d)>this.range.right){d=this.range.right-b+1}var f=this.rows;var e=f.length;for(var c=0;c<e;c++){f[c].removeCell(a,d)}this.range.extendRight(-d)},removeRow:function(f,c){if(f>(this.range.bottom+1)||f<this.range.top){return}var b=f-this.range.top;if((f+c)>this.range.bottom){c=this.range.bottom-f+1}var e,d=this.rows,g=d.slice(b,b+c),a=d.slice(b+c,d.length);d.length=b;d.push.apply(d,a);var e=g.pop();for(;e;e=g.pop()){e.detach()}this.range.extendBottom(-c);if(this._newrange){this._newrange.extendBottom(-c)}this.shiftRowInfo(b,f)},insertRow:function(b,f,g,e){var a=g===undefined||!!g,d=this.rows,c=d[b];if(!c){this.appendRow(f,g,e)}else{this.insertBefore(f,c,a);d.splice(b,0,f);if(e){this.range.extendTop(1);if(this._newrange){this._newrange.extendTop(1)}}if(g){jq(g).insertBefore(c.$n());f.bind()}}},appendRow:function(c,d,b){var a=d===undefined||!!d;this.appendChild(c,a);this.rows.push(c);if(b){this.range.extendBottom(1);if(this._newrange){this._newrange.extendBottom(1)}}if(d){jq(this.comp).append(d);c.bind()}},pushRowI:function(e,b){var d=this.rows,c=d.length;if(b>c){throw ("index out of bound:"+b+" > "+c)}if(b==0){this.pushRowS(e)}else{if(b==c){this.pushRowE(e)}else{var a=d.slice(b,c);d.length=b;d.push(e);d.push.apply(d,a);this.comp.insertBefore(e.comp,a[0].comp)}}},hide:function(){jq(this.comp).css("display","none")},show:function(){jq(this.comp).css("display","block")},removeColumnsFromStart_:function(c){var d=this.rows,b=this.rows.length,a=0;for(;a<b;a++){this.rows[a].removeLeftCell(c)}this.range.extendLeft(-c)},removeColumnsFromEnd_:function(c){var d=this.rows,b=this.rows.length,a=0;for(;a<b;a++){d[a].removeRightCell(c)}this.range.extendRight(-c)},removeRowsFromStart_:function(b){var c=this.rows,a=b,d=0;while(a--){if(!c.length){break}c.shift().detach();d++}this.range.extendTop(-d);if(this._newrange){this._newrange.extendTop(-d)}return d},removeRowsFromEnd_:function(b){var c=this.rows,a=b,d=0;while(a--){if(!c.length){break}c.pop().detach();d++}this.range.extendBottom(-d);if(this._newrange){this._newrange.extendBottom(-d)}},_tmpMerges:null,_toReset:null,_toSet:null,_addTempMerge:function(i,c,e,o,g,p,a,n,d,j){var h=""+c+"_"+i,f=this._tmpMerges[h];if(f){this._toReset[h]=f;delete this._tmpMerges[h]}if(d||j){this._toSet[h]=[g,p,a,n,d,j,i,c,e,o]}else{delete this._toSet[h]}},_setTempMergeCells:function(){var f=this._toSet;for(var q in f){if(f.hasOwnProperty(q)){var g=f[q],h=g[0],s=g[1],c=g[2],k=g[3],d=g[4],j=g[5],i=g[6],a=g[7],e=g[8],n=g[9],o=this.getCell(s,h);if(o){o._setTempMergeCellStyle(h,s,c,k,d,j,i,a,e,n)}this._tmpMerges[q]=g}}this._toSet={}},_resetTempMergeCells:function(k,f,i,c){var v=this._toReset;for(var s in v){if(v.hasOwnProperty(s)){var e=v[s],g=e[0],u=e[1],q=this.getCell(u,g);if(q){q._resetTempMergeCellStyle()}}}var o=[];var d=this._tmpMerges;for(var s in d){if(d.hasOwnProperty(s)){var e=d[s],g=e[0],u=e[1],a=e[2],n=e[3];if(a<k||g>i||n<f||u>c){o.push(s)}}}for(var h=o.length;--h>=0;){var s=o[h];delete this._tmpMerges[s]}this._toReset={}}})})();
(function(){var a="zscelltxt-wrap";var e=0,h=1,d=2,f=3,b=4,c=5,g=zss.Cell=zk.$extends(zk.Widget,{widgetName:"Cell",ref:null,src:null,text:"",lock:true,overflow:false,cellType:3,halign:"l",valign:"b",wrap:false,fontSize:11,fontFormat:0,comment:null,$init:function(p,m,s,l,j){this.$supers(zss.Cell,"$init",[]);this.sheet=p;this.block=m;this.r=s;this.c=l;this.src=j;var n=j.getRow(s).getCell(l),k=j.columnHeaders[l],o=j.rowHeaders[s];this.text=n.text||"";this.indention=n.indention;if(k&&o){this.ref=k.t+o.t}this.edit=n.editText?n.editText:"";this.hastxt=!!this.text;this.zsw=j.getColumnWidthId(l);this.zsh=j.getRowHeightId(s);this.lock=n.lock;this.cellType=n.cellType;this.halign=n.halign;this.valign=n.valign;this.rborder=n.rightBorder;if(n.fontSize){this.fontSize=n.fontSize}var q=n.mergeId;if(q){var i=n.merge;this.merid=q;this.merl=i.left;this.merr=i.right;this.mert=i.top;this.merb=i.bottom;this.mergeCls=n.mergeCls}this.wrap=n.wrap;this.overflow=n.overflow;this.overflowOpt=n.overflowOpt;this.style=n.style;this.innerStyle=n.innerStyle;this.fontStyle=n.fontStyle;this.comment=n.comment;if(n.db_tlbr){this.db_tlbr=n.db_tlbr}else{delete this.db_tlbr}if(n.af_tlbr){this.af_tlbr=n.af_tlbr}else{delete this.af_tlbr}if(n.dbar){this.dbar=n.dbar}else{delete this.dbar}this.rotate=n.rotate;this._cah=n._cah;delete n._cah;this._txtwd=n._txtwd},_updateCacheSrc:function(i){this.src=i},getVerticalAlign:function(){switch(this.valign){case"b":return"verticalAlignBottom";case"c":return"verticalAlignMiddle";case"t":return"verticalAlignTop"}},getHorizontalAlign:function(){switch(this.halign){case"l":return"horizontalAlignLeft";case"c":return"horizontalAlignCenter";case"r":return"horizontalAlignRight"}},getFontName:function(){var i=jq(this.getTextNode()).css("font-family");if(i){i=i.replace(/'/g,"")}return i},getFontSize:function(){return this.fontSize},isFontBold:function(){return(this.fontFormat&1)!=0},isFontItalic:function(){return(this.fontFormat&2)!=0},isFontUnderline:function(){return(this.fontFormat&4)!=0},isFontStrikeout:function(){return(this.fontFormat&8)!=0},doClick_:function(i){},doRightClick_:function(i){this.sheet._doMouserightclick(i)},doMouseDown_:function(i){this.sheet._doMousedown(i)},doMouseUp_:function(i){this.sheet._doMouseup(i)},doDoubleClick_:function(i){this.sheet._doMousedblclick(i)},isSelectable:function(){var i=this.sheet._wgt;return !i.isProtect()||i.allowSelectLockedCells||(i.allowSelectUnlockedCells&&!this.isLocked())},isLocked:function(){return this.lock},update_:function(O){if(O){var s=this.sheet._wgt._cacheCtrl,k=s?s.getSelectedSheet():null;if(k){this._updateCacheSrc(k)}}var N=this.r,X=this.c,U=this.src.getRow(N).getCell(X),I=U.formatText,v=this.style=U.style,l=this.innerStyle=U.innerStyle,j=this.fontStyle!=U.fontStyle,E=this.fontStyle=U.fontStyle,Q=this.comp,P=U.overflow,i=U.cellType,t=U.text,S=t!=this.text,L=U.indention,G=L!=this.indention,R=this.$n("cave"),H=R.style.width,z=U.fontSize,D=U.fontFormat,y=this.$n("real");var T=this.rotate==90||this.rotate==-90,u=U.rotate==90||U.rotate==-90,W=!u&&U.wrap,w=this.wrap!=W,V=this.valign!=U.valign,p=this.halign!=U.halign,A=this.rotate!=U.rotate;var C=false;if(z!=undefined){C=this.fontSize!=U.fontSize;this.fontSize=z}if(D!=undefined){this.fontFormat=D}this.$n().style.cssText=v;R.style.cssText=l;var o=y&&y.style?y.style.width:null,x=y&&y.style?y.style.transformOrigin:null,J=y&&y.style?y.style[zk.ie&&zk.ie<10?"-ms-transform":"transform"]:null,m=y&&y.style?y.style.fontFamily:null;y.style.cssText=E;if(o&&!G&&!y.style.width){jq(y).css("width",o)}var K=S||C||m!=y.style.fontFamily||G;if(K){delete this._txtwd}if(u){if(x&&!y.style.transformOrigin){y.style["transform-origin"]=x}if(J&&!y.style[zk.ie&&zk.ie<10?"-ms-transform":"transform"]){y.style[zk.ie&&zk.ie<10?"-ms-transform":"transform"]=J;R.style["text-align"]=""}}this.lock=U.lock;this.wrap=U.wrap;this.halign=U.halign;this.valign=U.valign;this.rborder=U.rightBorder;this.edit=U.editText;this.indention=U.indention;this._updateListenOverflow(P);this.setText(t,false,w);var q=jq(y).children("a")[0];if(q&&j){q.style.cssText=E}if(w){if(W){jq(this.getTextNode()).addClass(a)}else{jq(this.getTextNode()).removeClass(a)}}if(this.db_tlbr!=U.db_tlbr){if(this.db_tlbr){jq(this.comp).removeClass(this.db_tlbr)}if(U.db_tlbr){jq(this.comp).addClass(this.db_tlbr=U.db_tlbr)}else{delete this.db_tlbr}}if(this.af_tlbr!=U.af_tlbr){if(this.af_tlbr){jq(this.comp).removeClass(this.af_tlbr)}if(U.af_tlbr){jq(this.comp).addClass(this.af_tlbr=U.af_tlbr)}else{delete this.af_tlbr}}if(this.overflow!=P||(this.overflow&&K)){var M=false;if(this.overflow&&!P){this._clearOverflow();M=true}this.overflow=P;if(!M){this._processOverflow()}}if(this.cellType!=i&&(this.cellType==h||this.cellType==f)){this.sheet.triggerOverflowColumn_(this.r,this.c)}this.cellType=i;var F=w||(W&&(S||C));if(this._justCopied===true){F=false;delete this._justCopied}this._updateListenRotate(u);if(A||V||p||C||this.redoRotate||(T&&S)){var B=false;if(T&&!u){this._clearRotate();B=true}this.rotate=U.rotate;if(!B){this._processRotate()}delete this.redoRotate}if(S||j||C||A||G||((this.cellType==h||this.cellType==f)&&!this.merid&&F)){this._updateCellAutoHeight(N,X)}},_updateCellAutoHeight:function(){if(this.sheet._wgt._ignoreAutoHeight){return}var i=this._getTextHeight0();this.parent.updateAutoHeightDirty(this._txtHgh||-1,i);this._txtHgh=i;this.parent.processCellAutoHeight(this);this.sheet._sendOnTextHeight(this.r,this.c,i)},_updateListenRotate:function(i){var j=!!this._listenProcessRotate;if(j!=i){this.sheet[j?"unlisten":"listen"]({onProcessRotate:this.proxy(this._onProcessRotate)});this._listenProcessRotate=i;return true}return false},_clearRotate:function(){var i=this.$n("real");$real=jq(i);$real.css(zk.ie&&zk.ie<10?"-ms-transform":"transform","");$real.css("transform-origin","")},_processRotate:function(){},_updateListenOverflow:function(i){var j=!!this._listenProcessOverflow;if(j!=i){this.sheet[j?"unlisten":"listen"]({onProcessOverflow:this.proxy(this._onProcessOverflow)});this._listenProcessOverflow=i;return true}return false},_updateHasTxt:function(i){this.hastxt=i;var j=this.getZIndex();jq(this.comp).css("z-index",i?"":j)},setText:function(i){if(!i){i=""}var k=this.getText(),j=i!=k;this._updateHasTxt(i!="");this._setText(i)},getTextHeight:function(){var i=this._txtHgh;return i!=undefined?i:this._txtHgh=this._getTextHeight0()},_getTextHeight0:function(){return jq(this.getTextNode()).height()},_updateVerticalAlign:zk.ie6_||zk.ie7_?function(){var q=this.valign,r=this.text,l=this.$n("cave");if(l.style.display=="none"||!r){return}var m=jq(l),k=jq(this.getTextNode());switch(q){case"t":k.css({top:"0px",bottom:""});break;case"c":var i=m.height(),o=k.height();if(!i||!o){return}var n=(i-o)/2,j=Math.ceil(n*100/i);if(j){k.css({top:j+"%",bottom:""})}break;case"b":k.css({bottom:"0px",top:""});break}}:zk.$void(),_onRowHeightChanged:function(i){if(i.data.row==this.r){this._updateVerticalAlign()}},_updateListenRowHeightChanged:function(i){var j=!!this._listenRowHeightChanged;if(j!=i){this.sheet[j?"unlisten":"listen"]({onRowHeightChanged:this.proxy(this._onRowHeightChanged)});this._listenRowHeightChanged=i}},getText:function(){return this.getTextNode().innerHTML},getPureText:function(){var i=this.getTextNode();return i.textContent||i.innerText},_setText:function(i){if(!i){i=""}this.text=this.getTextNode().innerHTML=i;if(zk.ie6_||zk.ie7_){if(i){this._updateVerticalAlign()}this._updateListenRowHeightChanged(!!i)}},redraw:function(i){i.push(this.getHtml())},getHtml:function(){var j=this.uuid,m=this.text,k=this.domStyle_(),i=this.innerStyle,l=this.fontStyle;return'<div id="'+j+'" class="'+this.getZclass()+'" zs.t="SCell" '+(k?'style="'+k+'"':"")+'><div id="'+j+'-cave" class="'+this._getInnerClass()+'" '+(i?'style="'+i+'"':"")+">"+this.getCommentHtml(this.comment)+'<div id="'+j+'-real" class="'+this._getRealClass()+'"'+(l?' style="'+l+'"':"")+">"+m+"</div></div></div>"},getCommentHtml:function(i){return""},getZIndex:function(){if(zk.ie6_||zk.ie7_){return this.cellType==f?-1:1}return this.text?null:1},domStyle_:function(){var i=this.style;if(i){return i}else{var j=this.getZIndex();if(j){return"z-index:"+j+";"}}},getTextNode:function(){return this.$n("real")},_clearOverflow:function(){jq(this.getTextNode()).css("width","");jq(this.$n()).removeClass("zscell-overflow").removeClass("zscell-overflow-b")},_processOverflow:function(){},_setTempMergeCellStyle:function(p,A,i,w,k,x,q,j,n,y){var u=this.comp,o=u?jq(u):null;if(o){if(k){var m=this.sheet.custColWidth.getDiffPixel(p,i);o.css("width",m);var v=p!=q||i!=n?this.sheet.custColWidth.getDiffPixel(q,n)-4:m;if(m!=v){var s=jq(this.getTextNode());s.css("width",v);s.attr("mergewidth",true)}}if(x){var z=this.sheet.custRowHeight.getDiffPixel(A,w);o.css("height",z)}if(o.hasClass("zsmergee")){o.removeClass("zsmergee");o.attr("zsmergeex",true)}else{if(o.hasClass("zsmergeeu")){o.css("visibility","visible")}}}},_resetTempMergeCellStyle:function(){var j=this.comp,k=j?jq(j):null;if(k){k.css("width","");k.css("height","");var i=jq(this.getTextNode()),l=i?i.attr("mergewidth"):null;if(l){i.css("width","");i.removeAttr("mergewidth")}if(k.attr("zsmergeex")){k.removeAttr("zsmergeex");k.addClass("zsmergee")}else{if(k.hasClass("zsmergeeu")){k.css("visibility","")}}}},bind_:function(E,v,j){this.$supers(zss.Cell,"bind_",arguments);var x=this.comp=this.$n(),k=this.sheet;x.ctrl=this;this.cave=x.firstChild;if(this.merid){var u=this.block._newrange,o=u.right,s=u.left,m=u.top,z=u.bottom,D=this.merl,y=this.merr,w=this.mert,i=this.merb,t=Math.max(s,D),p=Math.max(m,w),r=Math.min(o,y),B=Math.min(z,i),l=(t==this.c&&p==this.r)||(r==this.c&&B==this.r);if(l){var q=r<y||t>D,A=B<i||p>w;this.block._addTempMerge(D,w,y,i,t,p,r,B,q,A)}}if(this.cellType==f){return}this._updateListenOverflow(this.overflow);if(!!this.text&&(zk.ie6_||zk.ie7_)&&this.valign!="t"){this._updateListenRowHeightChanged(true);this._updateVerticalAlign()}var F=(this.overflowOpt&2)!=0;if(this.overflow&&!F){this._processOverflow()}var C=this.rotate==90||this.rotate==-90;this._updateListenRotate(C);if(C){this._processRotate();return}this._saveNoneDefaultHeightCell();if(this._cah){this._updateCellAutoHeight();delete this._cah;this.sheet._cah=true}},_saveNoneDefaultHeightCell:function(){},unbind_:function(){this._updateListenOverflow(false);this._updateListenRotate(false);this._updateListenRowHeightChanged(false);this.parent.removeAutoHeightCell(this);this.comp=this.comp.ctrl=this.cave=this.sheet=this.overlapBy=this._listenRowHeightChanged=this.block=this.lock=null;this.$supers(zss.Cell,"unbind_",arguments)},_onProcessRotate:function(i){data=i.data;if(data){var m=this.r,l=data.tRow,k=data.bRow;if(this.c==data.col&&((l==undefined&&k==undefined)||(l&&k&&m>=l&&m<=k))){var j=this.rotate==90||this.rotate==-90;if(j){this._processRotate()}}}},_onProcessOverflow:function(i){if(this.overflow){var n=this.r,j=i.data;if(j){var m=j.col,l=j.tRow,k=j.bRow;if(this.c<j.col){if((l==undefined&&k==undefined)||(l&&k&&n>=l&&n<=k)){this._processOverflow(true)}}}}},getZclass:function(){var k="zscell",m=this.zsh,n=this.zsw,i=this.mergeCls,l=this.db_tlbr,j=this.af_tlbr;if(m){k+=(" zshi"+m)}if(n){k+=(" zsw"+n)}if(i){k+=(" "+i)}if(l){k+=(" "+l)}if(j){k+=(" "+j)}return k},_getInnerClass:function(){var i="zscelltxt",j=this.zsh,k=this.zsw;if(j){i+=(" zshi"+j)}if(k){i+=(" zswi"+k)}return i},_getRealClass:function(){var k=this.rotate==90||this.rotate==-90,i="zscelltxt-real "+(this.wrap&&!k?a:""),j=this.zsh;if(j){i+=(" zshr"+j)}return i},appendZSW:function(i){if(i){this.zsw=i;jq(this.comp).addClass("zsw"+i);jq(this.cave).addClass("zswi"+i)}},appendZSH:function(i){if(i){this.zsh=i;jq(this.comp).addClass("zshi"+i);jq(this.cave).addClass("zshi"+i);jq(this.$n("real")).addClass("zshr"+i)}},resetColumnIndex:function(i){var j=this.src;this.ref=j.columnHeaders[i].t+j.rowHeaders[this.r].t;this.c=i},resetRowIndex:function(i){var j=this.src;this.ref=j.columnHeaders[this.c].t+j.rowHeaders[i].t;this.r=i},isInRange:function(j,i){return this.merid?this.mert<=j&&this.merb>=j&&this.merl<=i&&this.merr>=i:this.r==j&&this.c==i}})})();
zss.Configuration=zk.$extends(zk.Object,{textOverflow:true,prune:true,readonly:false,hideBorder:false});
(function(){zss.DataPanel=zk.$extends(zk.Object,{cacheMap:null,$init:function(c){this.$supers(zss.DataPanel,"$init",[]);var f=this._wgt=c._wgt,b=c.$n("dp"),a=this.focustag=c.inlineEditor.getInputNode();this.cacheMap={};this.id=b.id;this.sheet=c;this.comp=b;this.comp.ctrl=this;this.padcomp=c.$n("datapad");f.domListen_(a,"onBlur","_doDataPanelBlur");f.domListen_(a,"onFocus","_doDataPanelFocus");this.width=c.custColWidth.getStartPixel(f.getMaxColumns());this.height=c.custRowHeight.getStartPixel(f.getMaxRows());this.paddingl=this.paddingt=0;var d=this.paddingl+c.leftWidth,e=c.topHeight;jq(b).css({width:jq.px0(this.width),height:jq.px0(this.height)})},cleanup:function(){var a=this.focustag,b=this.sheet._wgt;b.domUnlisten_(a,"onBlur","_doDataPanelBlur");b.domUnlisten_(a,"onFocus","_doDataPanelFocus");this.invalid=true;this.cacheMap=this.focustag=null;if(this.comp){this.comp.ctrl=null}this._wgt=this.comp=this.padcomp=this.sheet=null},reset:function(d,a){var e=this._wgt,b=this.paddingl=e.getLeftPanelWidth(),c=this.paddingt=e.getTopPanelHeight()+1;this.width=d;this.height=a;jq(this.comp).css({"padding-left":jq.px0(b),"padding-top":jq.px0(c),width:jq.px0(d),height:jq.px0(a)})},updateHeight:function(a){this.height+=a;jq(this.comp).css("height",jq.px0(this.height))},updateWidth:function(a){this.width+=a;jq(this.comp).css("width",jq.px0(this.width))},_fixSize:function(b){var h=this,i=this._wgt,d=this.sheet,e=d.custColWidth,j=d.custRowHeight;h.width=d.custColWidth.getStartPixel(i.getMaxColumns());h.height=d.custRowHeight.getStartPixel(i.getMaxRows());h.paddingl=e.getStartPixel(b.range.left);h.paddingt=j.getStartPixel(b.range.top);var a=h.width-h.paddingl,g=h.height,f=h.paddingl+d.leftWidth,c=d.topHeight+1;jq(h.comp).css({"padding-left":jq.px0(f),"padding-top":jq.px0(c),width:jq.px0(a)});jq(h.comp).css({width:jq.px0(a)});jq(h.comp).css({height:jq.px0(g)});jq(h.padcomp).css("height",jq.px0(h.paddingt));d.tp._updateLeftPadding(f);d.lp._updateTopPadding(h.paddingt)},isFocusOnFrozen:function(){var b=this.sheet,c=b.frozenRow,a=b.frozenCol,d=b.getLastFocus();return a>-1&&d.column<=a||c>-1&&d.row<=c},startEditing:function(g,a,d,e,i){var c=this.sheet;if(c.config.readonly){return false}var h,b;if(e){h=e.row;b=e.col}else{h=c.getLastFocus().row,b=c.getLastFocus().column}var d=d||"inlineEditing",f=c.getCell(h,b);if(this._wgt.isProtect()&&f&&f.isLocked()){c.showInfo(msgzss.cannotEditProtected,true);return false}if(!a){a=null}c.state=zss.SSheetCtrl.START_EDIT;if("inlineEditing"==d){c.dp.moveFocus(h,b,true,true)}else{this._openEditbox(null,true)}if(!i){c.fire("onStartEditing",{row:h,col:b,value:a,type:d});c._wgt.fire("onStartEditing",{token:"",sheetId:c.serverSheetId,row:h,col:b,clienttxt:a,type:d},null,25)}return true},_isProtect:function(i,b,f,g){var d=this._wgt.isProtect(),e=this._wgt._cacheCtrl.getSelectedSheet();for(var a=i;a<=f;a++){for(var h=b;h<=g;h++){var j=e.getRow(a).getCell(h);if(d&&j&&j.lock){return true}}}return false},_speedCopy:function(p,a){var d=this.sheet,e=d.getLastFocus(),n=e.row,b=e.column,i=b,w=b,h=p.split("\n"),s=h.length,g=n+s-1,l=[],x=null,a=a||"inlineEditing";for(var o=0;o<s;++o){var f=h[o],j=f.split("\t"),k=j.length,q=b+k-1;if(w<q){w=q}l.push(j)}var u=l[s-1];if(u.length==1&&u[0].length==0){--s;if(s>0){--g}}if(this._isProtect(n,b,g,w)){d.showInfo(msgzss.cannotEditProtected,true);d._doCellSelection(b,n,w,g);return}var t=w-b+1;for(var o=0;o<s;++o){var j=l[o],k=j.length,m=n+o;for(var v=0;v<t;++v){i=b+v;x=v>=k?null:j[v];if(d.state!=zss.SSheetCtrl.START_EDIT){d.state=zss.SSheetCtrl.START_EDIT;d._wgt.fire("onStartEditing",{token:"",sheetId:d.serverSheetId,row:m,col:i,clienttxt:x,type:a},null,25)}d.state=zss.SSheetCtrl.FOCUSED;d._wgt.fire("onStopEditing",{token:"",sheetId:d.serverSheetId,row:m,col:i,value:x,type:a},{toServer:true},25)}}return{left:b,top:n,right:w,bottom:g}},_speedInput:function(n,g){var e=this.sheet,j=e.getLastFocus(),k=j.row,d=j.column,l=k,q=d,p=n.split(zkS._enterChar),b="",g=g||"inlineEditing";for(var a=0,m=p.length;a<m;++a){var o=p[a],i=o.split("\t");l=k+a;q=d;for(var f=0,h=i.length;f<h;++f){q=d+f;b=i[f];if(a==(m-1)&&f==(h-1)){break}if(e.state!=zss.SSheetCtrl.START_EDIT){e.state=zss.SSheetCtrl.START_EDIT;e._wgt.fire("onStartEditing",{token:"",sheetId:e.serverSheetId,row:l,col:q,clienttxt:b,type:g},null,25)}e.state=zss.SSheetCtrl.FOCUSED;e._wgt.fire("onStopEditing",{token:"",sheetId:e.serverSheetId,row:l,col:q,value:b,type:g},{toServer:true},25)}}if(d!=q||k!=l){this.moveFocus(l,q,true,true)}if(q!=d||(b&&b.length>0)){if(e.state!=zss.SSheetCtrl.START_EDIT){e.state=zss.SSheetCtrl.START_EDIT;e._wgt.fire("onStartEditing",{token:"",sheetId:e.serverSheetId,row:l,col:q,clienttxt:b!=null?b:"",type:g},null,25)}this._openEditbox(b)}},_startEditing:function(d,f){var b=this.sheet,a=b.getFocusedCell();if(a!=null){var c=b.inlineEditor;if(b.state==zss.SSheetCtrl.START_EDIT){if(!f){d=b._clienttxt}b._clienttxt="";this._speedInput(d);c._startEditing()}else{if(f&&b.state==zss.SSheetCtrl.EDITING&&c.comp.value!=d){var e=b.getLastFocus();c.edit(a.comp,e.row,e.column,d)}}}},retryEditing:function(c,b,a){this.startEditing(null,c,"inlineEditing",{row:b,col:a});this._openEditbox(c)},_openEditbox:function(d,g){var b=this.sheet,a=b.getFocusedCell();if(a!=null){if(b.state==zss.SSheetCtrl.START_EDIT){var c=b.inlineEditor,f=b.getLastFocus(),e=!d&&d!=""?b.isPercentCell(a.r,a.c)?a.text:a.edit:d;c.edit(a.comp,f.row,f.column,e?e:"",g);b.state=zss.SSheetCtrl.EDITING}}},getEditor:function(c){var a=this.sheet;if(c){return c=="formulabarEditing"?a.formulabarEditor:a.inlineEditor}else{var b=a.inlineEditor;if(b.isEditing()||!a.formulabarEditor){return b}return a.formulabarEditor}},cancelEditing:function(b){var a=this.sheet;if(a.state>=zss.SSheetCtrl.FOCUSED){this.getEditor(b).cancel();a.fire("onStopEditing");a.state=zss.SSheetCtrl.FOCUSED;this.reFocus(true)}},stopEditing:function(j){var i=this.sheet,n=i.inlineEditor.isEditing(),a=n?"inlineEditing":"formulabarEditing";if(i.state==zss.SSheetCtrl.EDITING){i.state=zss.SSheetCtrl.STOP_EDIT;var f=this._wgt._cacheCtrl.getSelectedSheet(),h=n?this.sheet.inlineEditor:this.sheet.formulabarEditor,l=h.getValue(),g=h.sheetId,o=h.row,c=h.col,m=i.getCell(o,c),k=m?m.edit:null;if(g&&g!=i.serverSheetId){var e=i._wgt._sheetBar,b=e?e.getSheetSelector():null;if(b){b.doSelectSheet(g)}}if(k!=l||(k&&k.charAt(0)=="="&&m&&m.cellType==1&&k.length>1)){var d="";if(j=="movedown"){d=zkS.addCallback(function(){if(i.invalid){return}i.state=zss.SSheetCtrl.FOCUSED;if(!i._skipMove){i.dp.moveDown(null,o,c)}})}else{if(j=="moveright"){d=zkS.addCallback(function(){if(i.invalid){return}i.state=zss.SSheetCtrl.FOCUSED;if(!i._skipMove){i.dp.moveRight(null,o,c)}})}else{if(j=="moveleft"){d=zkS.addCallback(function(){if(i.invalid){return}i.state=zss.SSheetCtrl.FOCUSED;if(!i._skipMove){i.dp.moveLeft(null,o,c)}})}else{if(j=="refocus"){d=zkS.addCallback(function(){if(i.invalid){return}i.state=zss.SSheetCtrl.FOCUSED;i.dp.reFocus(true)})}else{if(j=="lostfocus"){i.asyncCheckFormula=true;d=zkS.addCallback(function(){i.asyncCheckFormula=false;if(!i.invalid){var p=i.state;i.dp._doFocusLost();if(i.sheetTabFn&&p==zss.SSheetCtrl.STOP_EDIT){i.sheetTabFn()}}i.sheetTabFn=null})}}}}}i.fire("onStopEditing",{row:o,col:c,value:l});i._wgt.fire("onStopEditing",{token:d,sheetId:i.serverSheetId,row:o,col:c,value:l,type:a},{toServer:true},25)}else{i.fire("onStopEditing",{row:o,col:c,value:l});this._stopEditing();if(j=="movedown"){if(i.invalid){return}i.state=zss.SSheetCtrl.FOCUSED;this.moveDown()}else{if(j=="moveright"){if(i.invalid){return}i.state=zss.SSheetCtrl.FOCUSED;this.moveRight()}else{if(j=="moveleft"){if(i.invalid){return}i.state=zss.SSheetCtrl.FOCUSED;this.moveLeft()}else{if(j=="refocus"){if(i.invalid){return}i.state=zss.SSheetCtrl.FOCUSED;this.reFocus(true)}else{if(j=="lostfocus"){if(i.invalid){return}this._doFocusLost()}}}}}}}},_stopEditing:function(){var a=this.sheet;if(a.state==zss.SSheetCtrl.STOP_EDIT){a.inlineEditor.stop()}},moveFocus:function(e,d,a,s,q,l,p){var c=this.sheet,b=c.getLastFocus();if(c&&!c.editingFormulaInfo){if(b.row!=e||b.column!=d||p){this.stopEditing("refocus")}}else{var o=c.editingFormulaInfo;if(o){o.moveCell=true;c.shallIgnoreBlur=true}}var i=c.frozenRow,n=c.frozenCol,k=this,g=function(){if(!c.getCell(e,d)){c.sp.scrollToVisible(e,d);setTimeout(function(){k._moveFocus(e,d,a,s,q,l)},25)}else{k._moveFocus(e,d,a,s,q,l)}},h=c.activeBlock,f=(e<=i?h.range.top:e),m=(d<=n?h.range.left:d),j=h.loadCell(f,m,5,g);if(j){g()}},_moveFocus:function(l,b,h,i,d,c){var g=this.sheet,j=g.getCell(l,b);if(!j||!j.isSelectable()){return false}var k=j.comp,e=j.merl,a=j.mert;if(zkS.t(e)&&(e!=b||a!=l)){return this._moveFocus(a,e,h,i,d,c)}g.moveCellFocus(l,b);if(!d){g._sendOnCellFocus(l,b)}if(i){g.moveCellSelection(b,l,b,l);var f=g.getLastSelection();if(!c){g._sendOnCellSelection(zss.SEL.CELL,f.left,f.top,f.right,f.bottom)}}var g=this.sheet;this._gainFocus(true,d,g.state<zss.SSheetCtrl.FOCUSED?false:true);if(h){g.sp.scrollToVisible(null,null,j)}return true},reFocus:function(a){var b=this.sheet.getLastFocus();this.moveFocus(b.row,b.column,a,true)},gainFocus:function(a){if(!this.sheet.isSwitchingSheet){this.stopEditing("refocus")}this._gainFocus(a)},_gainFocus:function(b,d,j){var g=this.sheet,a=this.focustag,h=g.getLastFocus(),i=h.row,c=h.column;if(g.state==zss.SSheetCtrl.NOFOCUS&&!d){g._sendOnCellFocus(i,c)}if(g.state<zss.SSheetCtrl.FOCUSED){g.state=zss.SSheetCtrl.FOCUSED}if(!j){g.moveCellFocus(i,c);var e=g.selArea.lastRange;g.moveCellSelection(e.left,e.top,e.right,e.bottom,null,!b)}var f=g.hlArea.lastRange;g.moveHighlight(f.left,f.top,f.right,f.bottom);g.animateHighlight(true);if(b&&g.state==zss.SSheetCtrl.FOCUSED){this.deferSelectFocustag()}},deferSelectFocustag:function(){var a=this;if(this.selectFocustagId){return}this.selectFocustagId=setTimeout(function(){a.selectFocustag();delete a.selectFocustagId},0)},selectFocustag:function(){var a=this.sheet.inlineEditor;a.getInputNode().focus();a.select()},getInputNode:function(){return this.sheet.$n("fo")},selectInputNode:function(){var a=this.getInputNode();a.focus();a.select()},_doFocusLost:function(){var a=this.sheet;a.state=zss.SSheetCtrl.NOFOCUS;a.hideCellFocus();if(!a._wgt._keepCellSelection){a.hideCellSelection()}a.animateHighlight(false);a._wgt.fire("onBlur")},selectCell:function(d,a,c){var b=this.sheet;if(b.maxRows<=d||b.maxCols<=a){return}if((c||b.state>=zss.SSheetCtrl.FOCUSED)&&d>-1&&a>-1){this.moveFocus(d,a,true,true)}else{b.moveCellFocus(d,a);b.moveCellSelection(a,d,a,d);this._gainFocus(true,false,true)}},movePageup:function(i){var e=this.sheet;if(zkS.isEvtKey(i,"s")){e.shiftSelection("pgup");return}var g=e.getLastFocus(),m=g.row,b=g.column;if(m<0||b<0){return}if(m>=0){var c=zss.SSheetCtrl._getVisibleRange(e).top,h=e.activeBlock,k=e.frozenRow,d=m>k?m-c:0,a,f;e.sp.scrollToVisible(c,-1,null,zss.SCROLL_DIR.VERTICAL,zss.SCROLL_POS.BOTTOM);h.loadForVisible();f=zss.SSheetCtrl._getVisibleRange(e).top;a=f+d;e.sp.scrollToVisible(f,-1,null,zss.SCROLL_DIR.VERTICAL,zss.SCROLL_POS.TOP);if(e._wgt.isProtect()&&!e._wgt.allowSelectLockedCells){return}if(a<0){a=0}var l=e.custRowHeight,j=a>0?l.getDecUnhidden(a,0):l.getIncUnhidden(a,m);if(j<0&&a>0){j=l.getIncUnhidden(a,m)}m=j}this.moveFocus(m,b,true,true,null,null,true)},movePagedown:function(h){var c=this.sheet;if(zkS.isEvtKey(h,"s")){c.shiftSelection("pgdn");return}var e=c.getLastFocus(),k=e.row,a=e.column;if(k<0||a<0){return}if(k<c.maxRows-1){var d=zss.SSheetCtrl._getVisibleRange(c),f=c.activeBlock,b=k>c.frozenRow?k-d.top:0,g;c.sp.scrollToVisible(d.bottom,-1,null,zss.SCROLL_DIR.VERTICAL,zss.SCROLL_POS.TOP);f.loadForVisible();if(c._wgt.isProtect()&&!c._wgt.allowSelectLockedCells){return}g=zss.SSheetCtrl._getVisibleRange(c).top+b;if(g>c.maxRows-1){return}var j=c.custRowHeight,i=g<(c.maxRows-1)?j.getIncUnhidden(g,c.maxRows-1):j.getDecUnhidden(g,k);if(i<0&&g<(c.maxRows-1)){i=j.getDecUnhidden(g,k)}k=i}this.moveFocus(k,a,true,true,null,null,true)},moveEnd:function(a){var e=this.sheet;if(zkS.isEvtKey(a,"s")){e.shiftSelection("end");return}var h=e.getLastFocus(),g=h.row,c=h.column;if(g<0||c<0){return}if(!e._wgt.isProtect()||e._wgt.allowSelectLockedCells){var b=e.maxCols-1,d=e.custColWidth;c=d.getDecUnhidden(b,b>c?c:0)}else{var f=this._getShiftPos(g,c,"end");if(f==null){return}g=f.row;c=f.col}this.moveFocus(g,c,true,true,null,null,true)},moveHome:function(a){var d=this.sheet;if(zkS.isEvtKey(a,"s")){d.shiftSelection("home");return}var h=d.getLastFocus(),g=h.row,b=h.column;if(g<0||b<0){return}if(!d._wgt.isProtect()||d._wgt.allowSelectLockedCells){var f=0,c=d.custColWidth;b=c.getIncUnhidden(f,b<(d.maxCols-1)?b:(d.maxCols-1))}else{var e=this._getShiftPos(g,b,"home");if(e==null){return}g=e.row;b=e.col}this.moveFocus(g,b,true,true,null,null,true)},moveUp:function(g){var e=this.sheet,b=g&&!g.altKey&&g.ctrlKey;if(zkS.isEvtKey(g,"s")){e.shiftSelection("up");return}var f=e.getLastFocus(),i=f.row,c=f.column;if(i<0||c<0){return}if(b){this._fireCtrlArrow(e,i,c,"up");return}if(!e._wgt.isProtect()||e._wgt.allowSelectLockedCells){if(i>0){var a=i-1,j=e.custRowHeight,h=a>0?j.getDecUnhidden(a,0):j.getIncUnhidden(a,i);if(h>=0){i=h}}}else{var d=this._getShiftPos(i,c,"up");if(d==null){return}i=d.row;c=d.col}this.moveFocus(i,c,true,true,null,null,true)},moveDown:function(l,a,g){var f=this.sheet,b=l&&!l.altKey&&l.ctrlKey;if(zkS.isEvtKey(l,"s")){f.shiftSelection("down");return}var h=f.getLastFocus(),o=a?a:h.row,d=g?g:h.column;if(o<0||d<0){return}var k=f.getCell(o,d);if(k){var i=k.merb;if(zkS.t(i)){o=i}}if(b){this._fireCtrlArrow(f,o,d,"down");return}if(!f._wgt.isProtect()||f._wgt.allowSelectLockedCells){if(o<f.maxRows-1){var j=o+1,n=f.custRowHeight,m=j<(f.maxRows-1)?n.getIncUnhidden(j,f.maxRows-1):n.getDecUnhidden(j,o);if(m>=0){o=m}}}else{var e=this._getShiftPos(o,d,"down");if(e==null){return}o=e.row;d=e.col}this.moveFocus(o,d,true,true,null,null,true)},moveLeft:function(l,a,j){var i=this.sheet,b=l&&!l.altKey&&l.ctrlKey;if(zkS.isEvtKey(l,"s")){i.shiftSelection("left");return}var k=i.getLastFocus(),m=a?a:k.row,e=j?j:k.column;if(m<0||e<0){return}if(b){this._fireCtrlArrow(i,m,e,"left");return}if(!i._wgt.isProtect()||i._wgt.allowSelectLockedCells){if(e>0){var f=e-1,h=i.custColWidth,d=f>0?h.getDecUnhidden(f,0):h.getIncUnhidden(f,e);if(d>=0){e=d}}}else{var g=this._getShiftPos(m,e,"left");if(g==null){return}m=g.row;e=g.col}this.moveFocus(m,e,true,true,null,null,true)},moveRight:function(n,a,k){var j=this.sheet,d=n&&!n.altKey&&n.ctrlKey;if(zkS.isEvtKey(n,"s")){j.shiftSelection("right");return}var l=j.getLastFocus(),o=a?a:l.row,g=k?k:l.column;if(o<0||g<0){return}var m=j.getCell(o,g);if(m){var f=m.merr;if(zkS.t(f)){g=f}}if(d){this._fireCtrlArrow(j,o,g,"right");return}if(!j._wgt.isProtect()||j._wgt.allowSelectLockedCells){if(g<j.maxCols-1){var b=g+1,i=j.custColWidth,e=b<(j.maxCols-1)?i.getIncUnhidden(b,j.maxCols-1):i.getDecUnhidden(b,g);if(e>=0){g=e}}}else{var h=this._getShiftPos(o,g,"right");if(h==null){return}o=h.row;g=h.col}this.moveFocus(o,g,true,true,null,null,true)},_getShiftPos:function(g,a,d){var c=this.sheet,b={row:g,col:a},e=function(){return b};if(d=="up"){e=this._shiftUp}else{if(d=="down"){e=this._shiftDown}else{if(d=="left"){e=this._shiftLeft}else{if(d=="right"){e=this._shiftRight}else{if(d=="home"){b={row:0,col:-1};e=this._shiftRight}else{if(d=="end"){e=this._shiftLeft;b={row:c.maxRows-1,col:c.maxCols}}}}}}}var f=1000;do{if(--f==0){this._fireShiftPos(c,g,a,d);return null}b=e.call(this,b)}while(this.sheet.isCellLocked(b.row,b.col)||c.custRowHeight.isHidden(b.row)||c.custColWidth.isHidden(b.col));return b},_shiftUp:function(c){var b={row:c.row-1,col:c.col},a=this.sheet;if(b.row<0){b.row=a.maxRows-1;b.col=b.col>0?b.col-1:a.maxCols-1}return b},_shiftDown:function(c){var b={row:c.row+1,col:c.col},a=this.sheet;if(b.row>=a.maxRows){b.row=0;b.col=b.col<a.maxCols-1?b.col+1:0}return b},_shiftLeft:function(c){var b={row:c.row,col:c.col-1},a=this.sheet;if(b.col<0){b.col=a.maxCols-1;b.row=b.row>0?b.row-1:a.maxRows-1}return b},_shiftRight:function(c){var b={row:c.row,col:c.col+1},a=this.sheet;if(b.col>=a.maxCols){b.col=0;b.row=b.row<a.maxRows-1?b.row+1:0}return b},_fireCtrlArrow:function(c,d,b,a){c._wgt.fire("onZSSCtrlArrow",{sheetId:c.serverSheetId,row:d,col:b,dir:a},{toServer:true})},_fireShiftPos:function(c,d,b,a){c._wgt.fire("onZSSShiftPos",{sheetId:c.serverSheetId,row:d,col:b,dir:a},{toServer:true})}})})();
(function(){zss.DeferLoader=zk.$extends(zk.Object,{_deferTime:500,_extraSize:3000,_loadRow:60,_loadCol:40,$init:function(a){this.sheet=a;this._wgt=a._wgt},asyncRun:function(){if(this._timeoutId){clearTimeout(this._timeoutId);this._timeoutId=null}var g=this;if(this.shallLoad()){if(this.shallLoadNow()){this._timeoutId=null;var m=g._wgt,i=m.getMaxRows(),l=m.getMaxColumns(),d=m.getPreloadRowSize(),f=m.getPreloadColumnSize(),e=m._cacheCtrl.getSelectedSheet(),j=e.rect,c=this.sheet.sp.getDirection(),h=-1,b=-1,k=-1,a=-1;if(c=="south"){b=j.left;k=j.right;h=j.bottom+1;if(h>=i){return}a=h+(d>0?d:this._loadRow);if(a>=i){a=i-1}}else{if(c=="north"){b=j.left;k=j.right;a=j.top-1;if(a<0){return}h=a-(d>0?d:this._loadRow);if(h<0){h=0}}else{if(c=="east"){h=j.top;a=j.bottom;b=j.right+1;if(b>=l){return}k=b+(f>0?f:this._loadCol);if(k>=l){k=l-1}}else{if(c=="west"){h=j.top;a=j.bottom;k=j.left-1;if(k<0){return}b=k-(f>0?f:this._loadCol);if(b<0){b=0}}}}}if(h>=0&&b>=0&&k>=0&&a>=0){m.fetchActiveRange(h,b,k,a)}}else{this._timeoutId=setTimeout(function(){g.asyncRun()},this._deferTime)}}},shallLoad:function(d){var q=this._wgt,h=this.sheet,k=h.activeBlock;if(k.loadstate==zss.MainBlockCtrl.LOADING){return}d=d||this.sheet.sp.getDirection();var c=k.range,j=q.getMaxRows()-1,n=q.getMaxColumns()-1,e=q._cacheCtrl.getSelectedSheet();if(!e){return false}var i=e.rect,p=((i.right-i.left+1)*(i.bottom-c.bottom+1));switch(d){case"south":var g=i.bottom;if(g>=j){return false}var a=i.right-i.left+1,p=a*(g-c.bottom+1);return p<this._extraSize;case"east":var l=i.right;if(l>=n){return false}var m=i.bottom-i.top+1,p=(m*(i.right-c.right+1));return p<this._extraSize;case"north":var o=i.top;if(!o){return false}var a=i.right-i.left+1,p=a*(c.top-o+1);return p<this._extraSize;case"west":var f=i.left;if(!f){return false}var b=i.bottom-i.top+1,p=b*(c.left-f+1);return p<this._extraSize}},shallLoadNow:function(){return this.sheet.activeBlock.loadstate==zss.MainBlockCtrl.IDLE}})})();
zss.DragHandler=zk.$extends(zk.Object,{$init:function(a){this.$supers("$init",arguments);this.sheet=a;var b=a._wgt;b.domListen_(document,"onMouseUp","_doDragMouseUp");b.domListen_(document,"onMouseMove","_doDragMouseDown");zk(document.body).disableSelection()},_isMenupopupOpen:function(){var a=this.sheet,b=a.getStyleMenupopup();if(b&&b.isOpen()){return true}b=a.getCellMenupopup();if(b&&b.isOpen()){return true}b=a.getColumnHeaderMenupopup();if(b&&b.isOpen()){return true}b=a.getRowHeaderMenupopup();if(b&&b.isOpen()){return true}return false},cleanup:function(){if(this.invalid){return}var a=this.sheet._wgt;a.domUnlisten_(document,"onMouseUp","_doDragMouseUp");a.domUnlisten_(document,"onMouseMove","_doDragMouseDown");this.invalid=true;this.stopAutoScroll();zk(document.body).enableSelection();this.sheet.stopDragging()},stopAutoScroll:function(){if(this.scrollctrl){this.scrollctrl.cleanup();this.scrollctrl=null}},doMouseup:function(a){this.cleanup()},doMousemove:function(a){}});zss.SelDrag=zk.$extends(zss.DragHandler,{$init:function(c,d,f,a,b,e){this.$supers("$init",arguments);this.selType=d;this.row=f;this.col=a;this.lastrow=f;this.lastcol=a;this.key=b;this.merr=e},doMouseup:function(b){var c=this.sheet,a=c.getLastSelection();c._sendOnCellSelection(this.selType,a.left,a.top,a.right,a.bottom);this.cleanup()},doMousemove:function(k){if(this.key!="l"){return}var f=this.sheet,e=k.domTarget,m=-1,a=-1,j=k.pageX,i=k.pageY,h,g;if((h=zkS.parentByZSType(e,["SCell","SRow"],1))!=null){var l=zss.SSheetCtrl._calCellPos(f,j,i,false);m=l[0];a=l[1]}else{if(this.selType==zss.SEL.ROW&&(h=zkS.parentByZSType(e,"SLheader",1))!=null){m=h.ctrl.index}else{if(this.selType==zss.SEL.COL&&(h=zkS.parentByZSType(e,"STheader",1))!=null){a=h.ctrl.index}else{if((h=zkS.parentByZSType(e,["SSelect","SHighlight"],1))!=null){var l=zss.SSheetCtrl._calCellPos(f,j,i,false);m=l[0];a=l[1]}else{if((h=zkS.parentByZSType(e,["SScrollpanel","SCorner","SLheader","STheader"],2))!=null||zkS.parentByZSType(e,"SSheet",5)==null){var b="";switch(jq(h).attr("zs.t")){case"SCorner":b="lt";break;case"SLheader":b="l";break;case"STheader":b="t";break;default:var c=zk(f.comp).revisedOffset();if(j<c[0]){b="l"}else{if(j>=c[0]+f.comp.offsetWidth-zss.Spreadsheet.scrollWidth){b="r"}}if(i<c[1]){b+="t"}else{if(i>=c[1]+f.comp.offsetHeight){b+="b"}}}if(b!=""&&(!this.scrollctrl||this.scrollctrl.getDir()=="")){var d=(this.selType==zss.SEL.ROW?zss.AutoScrollCtrl.ROWONLY:this.selType==zss.SEL.COL?zss.AutoScrollCtrl.COLONLY:"");this.scrollctrl=new zss.AutoScrollCtrl(f,b,d)}else{if(this.scrollctrl){this.scrollctrl.setDir(b)}}return}else{this.stopAutoScroll();return}}}}}this.stopAutoScroll();this.moveSelection(m,a)},moveSelection:function(g,b){var d=this.sheet;if(g>=d.maxRows){g=d.maxRows-1}if(b>=d.maxCols){b=d.maxCols-1}if(g<0){g=0}if(b<0){b=0}if(this.selType==zss.SEL.ROW){if(this.lastrow!=g&&g>-1){this.lastrow=g;d.moveRowSelection(this.row,g)}}else{if(this.selType==zss.SEL.COL){if(this.lastcol!=b&&b>-1){this.lastcol=b;d.moveColumnSelection(this.col,b)}}else{if(this.selType==zss.SEL.CELL){var h=false;if(this.lastrow!=g&&g>-1){this.lastrow=g;h=true}if(this.lastcol!=b&&b>-1){this.lastcol=b;h=true}if(h){var f=(this.row>g)?g:this.row,a=(this.row<g)?g:this.row,e=(this.col>b)?b:this.col,c=(this.col<b)?b:this.col;d.moveCellSelection(e,f,c,a,true)}}}}}});zss.SelChgDrag=zk.$extends(zss.DragHandler,{$init:function(b,d,e,f,a){this.$supers("$init",arguments);this.selType=d;this.action=e;var c=b.selArea.lastRange;this.top=c.top;this.left=c.left;this.right=c.right;this.bottom=c.bottom;var g=b.getLastFocus();this.frow=g.row;this.fcol=g.column;if(e==zss.SELDRAG.MOVE){this.row=f;this.col=a}b.moveSelectionChange(this.left,this.top,this.right,this.bottom)},doMouseup:function(a){var c=this.sheet,e=c.selArea.lastRange;range=c.selChgArea.lastRange;if(!range){return}var g=this.frow,b=this.fcol;if(this.action==zss.SELDRAG.MOVE){var f=range.top-this.top,d=range.left-this.left;g+=f;b+=d}if(b>range.right){b=range.right}else{if(b<range.left){b=range.left}}if(g>range.bottom){g=range.bottom}else{if(g<range.top){g=range.top}}if(g!=this.frow||b!=this.fcol){c.dp.moveFocus(g,b,false,false)}if(range.left!=e.left||range.top!=e.top||range.right!=e.right||range.bottom!=e.bottom){c._sendOnCellSelectionUpdate(this.selType,this.action,range.left,range.top,range.right,range.bottom,e.left,e.top,e.right,e.bottom)}c.hideSelectionChange();c.moveCellSelection(range.left,range.top,range.right,range.bottom);this.cleanup()},doMousemove:function(j){var e=this.sheet,d=j.domTarget,k=-1,a=-1,i=j.pageX,h=j.pageY,g,f;if((g=zkS.parentByZSType(d,["SCell","SSelect","SSelChg","SHighlight"],1))!=null){cellpos=zss.SSheetCtrl._calCellPos(e,i,h,false);k=cellpos[0];a=cellpos[1]}else{if((g=zkS.parentByZSType(d,["SScrollpanel","SCorner","SLheader","STheader"],2))!=null||zkS.parentByZSType(d,"SSheet",5)==null){var b="";switch(jq(g).attr("zs.t")){case"SCorner":b="lt";break;case"SLheader":b="l";break;case"STheader":b="t";break;default:var c=zk(e.comp).revisedOffset();if(i<c[0]){b="l"}else{if(i>=c[0]+e.comp.offsetWidth-zss.Spreadsheet.scrollWidth){b="r"}}if(h<c[1]){b+="t"}else{if(h>=c[1]+e.comp.offsetHeight){b+="b"}}}if(b!=""&&(!this.scrollctrl||this.scrollctrl.getDir()=="")){this.scrollctrl=new zss.AutoScrollCtrl(e,b,false)}else{if(this.scrollctrl){this.scrollctrl.setDir(b)}}return}else{this.stopAutoScroll();return}}this.stopAutoScroll();if(this.action==zss.SELDRAG.MOVE){this._move(k,a)}else{if(this.action==zss.SELDRAG.RESIZE){this._modify(k,a)}}},_modify:function(i,b){var e=this.sheet;if(i>=e.maxRows){i=e.maxRows-1}if(b>=e.maxCols){b=e.maxCols-1}if(i<0){i=0}if(b<0){b=0}var f=this.top,a=this.bottom,c=this.left,h=this.right,d=false;if(this.lastrow!=i&&i>-1){this.lastrow=i;d=true}if(this.lastcol!=b&&b>-1){this.lastcol=b;d=true}if(d){if(f>i||a<i||c>b||h<b){var g=(Math.abs(f+(a-f)/2-i)/2>Math.abs(c+(h-c)/2-b))?true:false;if((g||(c<=b&&this.right>=b))&&f>i){f=i}else{if((g||(c<=b&&this.right>=b))&&a<i){a=i}else{if((!g||(f<=i&&this.bottom>=i))&&c>b){c=b}else{if((!g||(f<=i&&this.bottom>=i))&&h<b){h=b}}}}}else{var g=((a-i)/2>(h-b))?true:false;if(g){a=i}else{h=b}}e.moveSelectionChange(c,f,h,a)}},_move:function(j,c){var g=this.sheet;if(j>=g.maxRows){j=g.maxRows-1}else{if(j<0){j=0}}if(c>=g.maxCols){c=g.maxCols-1}else{if(c<0){c=0}}var e=false;if(this.lastrow!=j&&j>-1){this.lastrow=j;e=true}if(this.lastcol!=c&&c>-1){this.lastcol=c;e=true}if(e){var f=j-this.row,b=c-this.col;if(f+this.top<0){f=-this.top}else{if(f+this.bottom>=g.maxRows){f=g.maxRows-this.bottom-1}}if(b+this.left<0){b=-this.left}else{if(b+this.right>=g.maxCols){b=g.maxCols-this.right-1}}var h=this.top+f,a=this.bottom+f,d=this.left+b,i=this.right+b;g.moveSelectionChange(d,h,i,a)}}});
(function(){var e=typeof window.getSelection=="function",a=document.selection&&document.selection.type!="Control",s=function(){if(e){return function(z){var y=window.getSelection(),w=y.getRangeAt(0),x=t();w.deleteContents();w.insertNode(x);w.setStartAfter(x);w.setEndAfter(x);y.removeAllRanges();y.addRange(w)}}else{if(a){return function(y){var w=document.selection.createRange(),x=document.body.createTextRange();x.setEndPoint("StartToStart",w);x.setEndPoint("EndToEnd",w);x.pasteHTML('<br><span class="caret-positioner"></span>');x.moveStart("character",1)}}else{return zk.$void}}}(),v=function(){if(e){return function(w,x){return w.toString().length+(x?w.cloneContents().querySelectorAll("br").length:0)}}else{if(a){return function(w,z){var y=0;if(z){var x=w.htmlText.match(/<br\s*\/?>/gi);if(x){y=x.length}}return w.text.length+y}}else{return function(){return 0}}}}(),c=function(){if(e){return function(z,C){try{var w=window.getSelection().getRangeAt(0),B=w.cloneRange(),y=w.cloneRange();B.selectNodeContents(z);y.selectNodeContents(z);B.setStart(z,0);B.setEnd(w.startContainer,w.startOffset);y.setStart(z,0);y.setEnd(w.endContainer,w.endOffset);if(w.toString()===""&&w.startOffset==0&&w.endOffset==0){var x=z.innerText.length;B.setEnd(w.startContainer,x);y.setEnd(w.endContainer,x)}return[v(B,C),v(y,C)]}catch(A){return[0,0]}}}else{if(a){return function(y,B){try{var w=document.selection.createRange(),A=document.body.createTextRange(),x=document.body.createTextRange();A.moveToElementText(y);A.setEndPoint("EndToStart",w);x.moveToElementText(y);x.setEndPoint("EndToEnd",w);return[v(A,B),v(x,B)]}catch(z){return[0,0]}}}else{return function(){return[0,0]}}}}(),u=function(){if(e){return function(y){var x=window.getSelection(),w;if(x.rangeCount>0){x.removeAllRanges()}w=document.createRange();w.selectNodeContents(y);x.addRange(w)}}else{if(a){return function(x){var w=document.body.createTextRange();w.moveToElementText(x);w.select()}}else{return zk.$void}}}(),k=function(){if(e){return function(y){var x=window.getSelection(),w;if(x.rangeCount>0){x.removeAllRanges()}w=document.createRange();w.selectNodeContents(y);w.setStart(w.endContainer,w.endOffset);x.addRange(w)}}else{if(a){return function(x){var w=document.body.createTextRange();w.moveToElementText(x);w.moveStart("Character",v(w,true));w.select()}}else{return zk.$void}}}(),f=function(){if(e){return function(A){var z=window.getSelection(),y;if(z.rangeCount>0){z.removeAllRanges()}y=document.createRange();var w=$(A).contents().filter(function(){return this.nodeType==3});var x=w[w.length-1];var B=x.textContent.length-1;y.selectNodeContents(x);y.collapse(true);y.setStart(x,B);z.addRange(y)}}else{if(a){return function(x){var w=document.body.createTextRange();w.moveToElementText(x);var y=v(w,true)-1;w.moveEnd("Character",y);w.moveStart("Character",y);w.select()}}else{return zk.$void}}}(),m=function(){if(zk.webkit){return function(w){w.appendChild(t())}}else{if(zk.gecko){return function(y){var x=y.lastChild;if(x&&x.nodeName.toLowerCase()=="br"&&jq(x).attr("type")!="_moz"){var w=t();jq(w).attr("type","_moz");y.appendChild(w)}}}else{return zk.$void}}}(),p=function(){if(zk.webkit){return function(x){var w=x.lastChild;if(!w||w.nodeName.toLowerCase()!="br"){x.appendChild(t())}}}else{return zk.$void}}(),o=function(){if(zk.webkit){return function(x){var w=x.lastChild;if(w&&w.nodeName.toLowerCase()=="br"){x.removeChild(w)}}}else{if(zk.gecko){return function(x){var w=x.lastChild;if(w&&w.nodeName.toLowerCase()=="br"&&jq(w).attr("type")=="_moz"){x.removeChild(w)}}}else{return zk.$void}}}();function g(y){var x=y.cloneNode(true),w=jq(x);o(x);w.find("br").after("\n").remove();return w.text()}function l(w){return jq.parseHTML(w.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"))}function t(){return document.createElement("br")}function q(A){var z=A.clientHeight,y=A.scrollHeight,x=zkS._hasScrollBar(A),w=zkS._hasScrollBar(A,true);if(y>z+3){if(x&&!w){jq(A).css("height",jq.px0(y+zss.Spreadsheet.scrollWidth))}else{jq(A).css("height",jq.px0(y))}}}function r(x){var w=x.sheet;if(w){x.isFocused=false;if(w.shallIgnoreBlur){h(x);w.shallIgnoreBlur=false}else{if(w.isSwitchingFocus){w.isSwitchingFocus=false}else{if(w.isSwitchingSheet){h(x)}else{if(!w._wgt.hasFocus()&&x.isEditing()){w.dp.stopEditing(w.innerClicking>0?"refocus":"lostfocus")}else{if(zk.ie&&w._wgt.hasFocus()&&x.isEditing()){w.dp.stopEditing(w.innerClicking>0?"refocus":"lostfocus")}}}}}}}function h(w){if(!zk.gecko){w.focus()}else{setTimeout(function(){w.focus()})}}function n(w){return w.match("\\$?([A-Za-z]+)\\$?([0-9]+)")}function b(D,y,B){var x=B||c(y),E=D||"inlineEditing",w=x[0],z=x[1],G=jq(y).text(),F=G.charAt(0);if(F&&F=="="){if(w!=z){return{start:w,end:z,type:E}}else{if(!w){return{start:0,end:0,type:E}}else{var H=["=","+","-","*","/","!",":","^","&","(",",","."],A=w-1,C=G.charAt(A);if(H.$contains(C)){return{start:w,end:w,type:E}}}}}}function j(I,A,K,w,F,G){var B=I.editingFormulaInfo,x=B.start,C=B.end,J=jq(A),M=J.text(),E=I.getCell(K,w),D=E.isInRange(F,G)?null:I.getCell(F,G),z=E.ref,H=I.inlineEditor,y=H.sheetId,L=I.serverSheetId;if(D){z+=(":"+D.ref)}if(y&&y!=L){z=d(I,L)+"!"+z}if(!x){z="="+z}J.text(M.substring(0,x)+z+M.substring(C,M.length));H.setValue(J.text());C=x+z.length;B.end=C;if(zk.ie&&zk.ie<11){setTimeout(function(){k(A)})}else{k(A)}}function d(w,x){var z=w._wgt.getSheetLabels();for(var y in z){if(z[y].id==x){return i(z[y].name)}}}function i(w){if(/^[a-z_]+[a-z0-9_.]*$/i.test(w)){return w}else{return"'"+w+"'"}}zss.FormulabarEditor=zk.$extends(zul.inp.InputWidget,{widgetName:"FormulabarEditor",_editing:false,row:-1,col:-1,$init:function(w){this.$supers(zss.FormulabarEditor,"$init",[]);this._wgt=w},bind_:function(){this.$supers(zss.FormulabarEditor,"bind_",arguments);var w=this._wgt.sheetCtrl;if(w){this.sheet=w;w.formulabarEditor=this;w.listen({onStartEditing:this.proxy(this._onStartEditing)}).listen({onStopEditing:this.proxy(this.stop)}).listen({onCellSelection:this.proxy(this._onCellSelection)}).listen({onContentsChanged:this.proxy(this._onContentsChanged)})}},unbind_:function(){var w=this.sheet;if(w){w.unlisten({onStartEditing:this.proxy(this._onStartEditing)}).unlisten({onStopEditing:this.proxy(this.stop)}).unlisten({onCellSelection:this.proxy(this._onCellSelection)}).unlisten({onContentsChanged:this.proxy(this._onContentsChanged)});w.formulaEditor=null}this.sheet=this._wgt=null;this.$supers(zss.FormulabarEditor,"unbind_",arguments)},disable:zk.$void,cancel:function(){var w=this.sheet;if(w){w.inlineEditor.cancel()}this.clearStatus()},stop:function(){var w=this.sheet;if(w){w.inlineEditor.stop()}this.clearStatus()},clearStatus:function(){this.row=this.col=-1;this._editing=false},syncEditorPosition:function(y){var w=this.sheet;if(!w){return}var B=this.$n(),A=y!==undefined?y:c(this.getInputNode(),true)[1];if(A<=0){jq(B).scrollTop(0);return}var z=this.getTextHeight(this.getValue().substring(0,A)),x=z-this.getLineHeight();jq(B).scrollTop(x)},getLineHeight:function(){if(this._lineHeight===undefined){this._lineHeight=this.getTextHeight("a")}return this._lineHeight},getTextHeight:function(z){var y=this.$n("support"),x=jq(y),w;x.text(z);y.appendChild(t());w=y.scrollHeight;x.text("");return w},setValue:function(x,A){var z=this.$n(),w=this.getInputNode(),y=jq(w);y.html(l(x));m(w);if(this.isRealVisible()){y.css("height",jq.px0(z.clientHeight-3));q(w);this.syncEditorPosition(A!==undefined?A:x.length)}},getValue:function(){return g(this.getInputNode())},newLine:function(){s(this.getInputNode())},focus:function(){var w=this.getInputNode();if(zk(w).isRealVisible(true)){w.focus()}},doFocus_:function(){var x=this.sheet;this._editing=true;if(x){var z=x.editingFormulaInfo;if(z){if(!z.moveCell){x.editingFormulaInfo=b("formulabarEditing",this.getInputNode())}else{}}else{var y=this.sheet.getLastFocus(),w=x.selArea.lastRange;x.moveCellFocus(y.row,y.column);x.moveCellSelection(w.left,w.top,w.right,w.bottom,false,true)}this.isFocused=true}},doBlur_:function(){r(this)},_onContentsChanged:function(w){var x=this.sheet;if(x&&this.isRealVisible()&&!x.editingFormulaInfo){var y=x.getLastFocus(),z=x.getCell(y.row,y.column);if(z){this.setValue(z.edit||"",0)}}},isEditing:function(){return this._editing},_onStartEditing:function(w){var x=w.data;this.row=x.row;this.col=x.col},_onCellSelection:function(B){var z=this.sheet;if(z){if(z.state==zss.SSheetCtrl.FOCUSED){var y=B.data,E=y.top,x=y.left,C=z.getCell(E,x);if(C){var A=z.isPercentCell(E,x)?C.text:(C.edit||"");this.setValue(A,0)}else{}}else{if(z.state==zss.SSheetCtrl.EDITING){var w=z.editingFormulaInfo,y=B.data,D=y.skipInsertCellRef;if(w&&"formulabarEditing"==w.type&&!D){j(z,this.getInputNode(),y.top,y.left,y.bottom,y.right)}}}}},doMouseDown_:function(w){var y=this.sheet;if(y){if(y.state==zss.SSheetCtrl.FOCUSED){var A=y.getLastFocus(),C=y.getCell(A.row,A.column);if(C&&y.dp.startEditing(w,C.edit,"formulabarEditing")){this.row=A.row;this.col=A.column}else{y.dp.gainFocus(true)}}else{if(y.state==zss.SSheetCtrl.NOFOCUS){var A=y.getLastFocus(),B=A.row,x=A.column;y.dp.moveFocus(B==-1?0:B,x==-1?0:x);w.stop()}else{if(y.state==zss.SSheetCtrl.EDITING){if(!this.isFocused){y.isSwitchingFocus=true}var z=y.editingFormulaInfo;if(z&&z.moveCell){y.editingFormulaInfo=b("formulabarEditing",this.getInputNode())}}}}}},doKeyDown_:function(w){var x=this.sheet;if(x){x._doKeydown(w);p(this.getInputNode())}},afterKeyDown_:function(w,x){},doKeyUp_:function(y){var A=this.sheet,x=y.keyCode;if(A&&A.state==zss.SSheetCtrl.EDITING){var z=this.getInputNode(),w=c(z),C=this.getValue(),D=A.editingFormulaInfo;q(z);this.syncEditorPosition();A.inlineEditor.setValue(C);this._wgt.fire("onEditboxEditing",{token:"",sheetId:A.serverSheetId,row:this.row,col:this.col,clienttxt:C});if(!C){A.editingFormulaInfo=null;return}var B="formulabarEditing";if(D){D.type=B;if(D.moveCell){if(D.end!=end){A.editingFormulaInfo=b(B,z,w)}else{}}else{A.editingFormulaInfo=b(B,z,w)}}else{if(A.enableKeyNavigation){A.editingFormulaInfo=b(B,z,w)}}}},doKeyPress_:function(w){},setWidth:function(y){this.$supers(zss.FormulabarEditor,"setWidth",arguments);var x=this.$n().clientWidth-6;x=x-zss.Spreadsheet.scrollWidth;if(x<0){x=0}jq(this.getInputNode()).css("width",jq.px(x));jq(this.$n("support")).css("width",jq.px(x))},setHeight:function(x){this.$supers(zss.FormulabarEditor,"setHeight",arguments);var w=this.getInputNode(),y=this.$n();jq(w).css("height",jq.px0(y.clientHeight-3));q(w);this.syncEditorPosition()},redrawHTML_:function(){var w=this.uuid,x=this.getZclass();return'<div id="'+w+'" class="'+x+'"><div id="'+w+'-real" class="'+x+'-real" contentEditable="true">'+this._areaText()+'</div><div id="'+w+'-wrap-support" class="'+x+'-wrap-support"><div id="'+w+'-support" class="'+x+'-support" contentEditable="true"></div></div></div>'},getZclass:function(){return"zsformulabar-editor"}});zss.Editbox=zk.$extends(zul.inp.InputWidget,{widgetName:"InlineEditor",_editing:false,_type:"inlineEditing",$init:function(w){this.$supers(zss.Editbox,"$init",[]);this._wgt=w._wgt;this.sheet=w;this.row=-1;this.col=-1;this.disabled=true},bind_:function(){this.$supers(zss.Editbox,"bind_",arguments);this.comp=this.getInputNode();this.comp.ctrl=this;if(!zk.ie||zk.ie>9){this.domListen_(this.comp,"onCompositionStart");this.domListen_(this.comp,"onCompositionEnd")}this.sheet.listen({onStartEditing:this.proxy(this._onStartEditing)}).listen({onStopEditing:this.proxy(this.stop)}).listen({onCellSelection:this.proxy(this._onCellSelection)})},unbind_:function(){if(!zk.ie||zk.ie>9){this.domUnlisten_(this.comp,"onCompositionStart");this.domUnlisten_(this.comp,"onCompositionEnd")}this.sheet.unlisten({onStartEditing:this.proxy(this._onStartEditing)}).unlisten({onStopEditing:this.proxy(this.stop)}).unlisten({onCellSelection:this.proxy(this._onCellSelection)});this.sheet=this.comp.ctrl=this.comp=this._wgt=null;this.$supers(zss.Editbox,"unbind_",arguments)},focus:function(){var w=this.comp;if(zk(w).isRealVisible(true)){w.focus()}},isEditing:function(){return this._editing},_onStartEditing:function(w){var y=w.data,x=this.sheet;this.row=y.row;this.col=y.col;this.sheetId=x.serverSheetId;this.sheetName=d(x,this.sheetId);this.cellRef=x.getCell(this.row,this.col).ref;if(y.type=="inlineEditing"&&(!y.value||y.value.length<=1)){x.enableKeyNavigation=true}},_onCellSelection:function(w){var y=this.sheet;if(y){if(y.state==zss.SSheetCtrl.EDITING){var A=y.editingFormulaInfo,B=w.data,x=B.skipInsertCellRef;if(A&&"inlineEditing"==A.type&&!x){var z=y.formulabarEditor;j(y,this.getInputNode(),B.top,B.left,B.bottom,B.right);if(z){z.setValue(this.getValue())}}}}},doFocus_:function(){this._editing=true;if(this.sheet){this.isFocused=true}},doBlur_:function(){var w=this.sheet;if(w&&w.enableKeyNavigation){w.enableKeyNavigation=null}r(this)},doMouseDown_:function(w){var x=this.sheet;if(x){if(x.state==zss.SSheetCtrl.EDITING){if(!this.isFocused){x.isSwitchingFocus=true}if(x.enableKeyNavigation){x.enableKeyNavigation=null}var y=x.editingFormulaInfo;if(y&&y.moveCell){x.editingFormulaInfo=b(this._type,this.getInputNode())}}}},doKeyPress_:function(w){var x=this.sheet;if(x.state==zss.SSheetCtrl.EDITING){this.autoAdjust(true)}else{x._wgt.doKeyPress_(w)}},doKeyDown_:function(x){var y=this.sheet;if(y.state!=zss.SSheetCtrl.EDITING){y._wgt.doKeyDown_(x);return}if(this.disabled){x.stop()}else{this.sheet._doKeydown(x);p(this.comp);var w=x.keyCode;switch(w){case 35:if(x.altKey){if(this.col+this.sw<this.sheet.maxCols-1){this.sw++;this.adjust("w")}x.stop()}break;case 34:if(x.altKey){if(this.row+this.sh<this.sheet.maxRows-1){this.sh++;this.adjust("h")}x.stop()}break;case 36:if(x.altKey){if(this.sw>0){this.sw--;this.adjust("w")}x.stop()}break;case 33:if(x.altKey){if(this.sh>0){this.sh--;this.adjust("h")}x.stop()}break;case 37:case 38:case 39:case 40:if(y.enableKeyNavigation){x.stop()}break}}},afterKeyDown_:function(w,y){var x=this.sheet;if(x.state!=zss.SSheetCtrl.EDITING){x._wgt.afterKeyDown_(w)}},_doCompositionStart:function(w){var x=this.sheet;if(x.state==zss.SSheetCtrl.FOCUSED){if(zk.webkit){this.prepareComposition=true}x._enterIMEEditing(w)}},_doCompositionEnd:function(w){if(this.prepareComposition){this.prepareComposition=null}},doKeyUp_:function(E){var z=this.sheet;if(!z){return}if(z.state==zss.SSheetCtrl.EDITING){var D=z.formulabarEditor,C=z.inlineEditor.getValue(),y=E.keyCode,w=z.editingFormulaInfo,B=this.comp,x=c(B);end=x[1];if(D){D.setValue(C,c(B,true)[1])}z._wgt.fire("onEditboxEditing",{token:"",sheetId:z.serverSheetId,row:this.row,col:this.col,clienttxt:C});if(!C){z.editingFormulaInfo=null;return}var A=this._type;if(w){w.type=A;if(w.moveCell){if(w.end!=end){z.editingFormulaInfo=b(A,B,x)}else{}}else{z.editingFormulaInfo=b(A,B,x)}}else{if(z.enableKeyNavigation){z.editingFormulaInfo=b(A,B,x)}}}else{z._wgt.doKeyUp_(E)}},disable:function(w){this.comp.style.backgroundColor=w?"#DDDDDD":"#EFECFF";this.disabled=w},setValue:function(x){if(this.disabled){return}var w=this.comp;jq(w).html(l(x));m(w);this.autoAdjust(true)},_startEditing:function(B){var x=this.sheet;if(x){this._editing=!B;var A=x.formulabarEditor,w=this.comp,z=this.getValue();if(A){if(!B){A.setValue(z)}}if("="==z.charAt(0)){var y=z.length;x.editingFormulaInfo=b(this._type,w,[y,y])}}},edit:function(L,N,x,K,B){this.disable(false);this.row=N;this.col=x;this.sw=0;this.sh=0;var F=this.sheet,E=L.lastChild,y=E.lastChild,I=this.comp,G=jq(I);var D=F.isPercentCell(N,x)&&zkS.isSingleDigit(K);if(D){K=K+"%"}this.setValue(K);var J=L.ctrl.overflowed?(L.firstChild.offsetWidth+this.sheet.cellPad):(L.offsetWidth);var C=L.offsetHeight;var H=L.ctrl;var A=F.sp;var z=F.custColWidth.getStartPixel(H.c)+F.leftWidth-(F.frozenCol>=0&&x<=F.frozenCol?0:A.currentLeft);var M=F.custRowHeight.getStartPixel(H.r)+F.topHeight-(F.frozenRow>=0&&N<=F.frozenRow?0:A.currentTop);M-=1;J-=1;C-=1;z-=1;if(zk.safari||zk.opera){J-=2}this.editingWidth=J;this.editingHeight=C;this.editingTop=M;this.editingLeft=z;G.css({"min-width":jq.px0(J),"min-height":jq.px0(C),width:"auto",height:"auto","max-width":jq.px0(F.spcmp.clientWidth-z),"max-height":jq.px0(F.spcmp.clientHeight-M),left:jq.px(z),top:jq.px(M),"line-height":F.lineHeight});zcss.copyStyle(E,I,["text-align"],true);zcss.copyStyle(y,I,["font-family","font-size","font-weight","font-style","color","text-decoration"],true);zcss.copyStyle(L,I,["background-color"],true);this._startEditing(B);if(!B){if(this.prepareComposition){G.focus()}else{setTimeout(function(){G.focus();if(D){f(I)}else{k(I)}},25)}}this.autoAdjust(true)},cancel:function(){this.clearStatus()},stop:function(){var w=this.getValue();this.clearStatus();return w},clearStatus:function(){var w=this.sheet;if(w){w.editingFormulaInfo=null;if(w.enableKeyNavigation){w.enableKeyNavigation=null}}this._editing=false;this.disable(true);jq(this.comp).text("").css({left:"-10005px",top:"-10005px"});jq(this.$n("info")).text("").css("display","none");this.row=this.col=-1;this.sheetId=null;this.sheetName=null;this.cellRef=null;if(this.prepareComposition){this.prepareComposition=null}},select:function(){u(this.comp)},getValue:function(){return g(this.comp)},newLine:function(){s(this.comp);this.autoAdjust()},adjust:function(C){var x=this.comp;if(C=="w"){var A=this.sheet.custColWidth,y=A.getStartPixel(this.col+this.sw+1)-A.getStartPixel(this.col);if((zk.ie&&zk.ie<11)||zk.safari||zk.opera){y-=2}jq(x).css("width",jq.px0(y))}else{if(C=="h"){var z=this.sheet.custRowHeight,B=z.getStartPixel(this.row+this.sh+1)-z.getStartPixel(this.row);jq(x).css("height",jq.px0(B))}}},autoAdjust:function(x){var w=this;setTimeout(function(){var z=w.comp,D=z.clientHeight,y=z.scrollWidth,C=z.scrollHeight;if(C>D+3||x){var B=w.sheet.custColWidth,A=w.sheet.custRowHeight;w.sw=B.getCellIndex(B.getStartPixel(w.col)+y)[0]-w.col;w.sh=A.getCellIndex(A.getStartPixel(w.row)+C)[0]-w.row}},0)},updateInfo:function(){var y=this.sheet,A=this.$n("info"),x=jq(A),w="",z=this.sheetId;if(z&&z!=y.serverSheetId){w=this.sheetName+"!"+this.cellRef;x.css("display","block")}else{x.css("display","none")}x.text(w);x.css({left:this.editingLeft,top:jq.px(this.editingTop-A.offsetHeight)})},redrawHTML_:function(){return'<div id="'+this.uuid+'" class="zsedit"><div id="'+this.uuid+'-info" class="zsedit-info"></div><div id="'+this.uuid+'-real" class="zsedit-real" zs.t="SEditbox" contentEditable="true"></div></div>'}})})();
zss.FocusMarkCtrl=zk.$extends(zk.Object,{$init:function(b,c,d){this.$supers("$init",arguments);this.id=c.id;this.comp=c;var a=this;this.sheet=b;this.row=d.row;this.column=d.column;c.ctrl=this;jq(c).bind("mouseenter",this.proxy(this._doMouseEnter));jq(c).bind("mouseleave",this.proxy(this._doMouseLeave))},cleanup:function(){this.invalid=true;if(this.comp){jq(this.comp).unbind("mouseenter",this.proxy(this._doMouseEnter));jq(this.comp).unbind("mouseleave",this.proxy(this._doMouseLeave));this.comp.ctrl=null;this.comp=null}this.sheet=null},relocate:function(m,b){var e=this.sheet;this.row=m;this.column=b;var j=e.getCell(m,b),a=j&&j.merr?j.merr:b,i=j&&j.merb?j.merb:m,f=e.custColWidth,n=e.custRowHeight,c=f.getStartPixel(b),k=n.getStartPixel(m),g=f.getStartPixel(a+1)-c,d=n.getStartPixel(i+1)-k;this.relocate_(c,k,g,d)},relocate_:function(b,d,a,e){var c=this.sheet,f=c.dp;b+=c.leftWidth;d+=c.topHeight+1;jq(this.comp).css({width:jq.px0(a+3),height:jq.px0(e+3),left:jq.px(b-2),top:jq.px(d-2)})},showMark:function(b,e){this.comp.style.display="block";var f=0;var a=jq(this.comp);if(b){a.css({"border-color":b});var d=a.css("border-color");var c=d.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(!c||c.length!=4){c=d.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d+)\)$/)}if(c&&c.length>=4){f=1-(0.299*c[1]+0.587*c[2]+0.114*c[3])/255}}this.color=b;this.label=e;this.bright=f},hideMark:function(){this.comp.style.display="none"},_doMouseEnter:function(a){var b=this.color,c=this.label,d=this.sheet;if(!d||!d._wgt.hasFocus()){return}if(b&&c){var f=jq(this.comp),e=jq("<span class='zsfocmarkl'/>");this.lab=e;e.text(c).css({"background-color":b,left:f.width()+1}).appendTo(f);if(this.bright>0.5){e.addClass("zsfocmarkl-lite");e.removeClass("zsfocmarkl-dark")}else{e.addClass("zsfocmarkl-dark");e.removeClass("zsfocmarkl-lite")}}},_doMouseLeave:function(a){if(this.lab){this.lab.detach();this.lab=null}}});zss.FocusMarkCtrlCorner=zk.$extends(zss.FocusMarkCtrl,{});zss.FocusMarkCtrlLeft=zk.$extends(zss.FocusMarkCtrl,{relocate_:function(b,d,a,e){var c=this.sheet;b+=c.leftWidth-1;if(c.lp.toppad){d-=c.lp.toppad}jq(this.comp).css({width:jq.px0(a+3),height:jq.px0(e+3),left:jq.px(b-2),top:jq.px(d-2)})}});zss.FocusMarkCtrlTop=zk.$extends(zss.FocusMarkCtrl,{relocate_:function(b,d,a,e){var c=this.sheet;d+=c.topHeight;jq(this.comp).css({width:jq.px0(a+3),height:jq.px0(e+3),left:jq.px(b-2),top:jq.px(d-2)})}});
(function(){zss.Namebox=zk.$extends(zk.Widget,{_redrawNames:false,$init:function(a){this.$supers(zss.Namebox,"$init",[]);this._names=[];this._wgt=a},$define:{disabled:function(a){var b=this.$n();if(b){jq(b)[a?"addClass":"removeClass"](this.getZclass()+"-disd")}}},bind_:function(){this.$supers(zss.Namebox,"bind_",arguments);this.sheet=this._wgt.sheetCtrl},unbind_:function(){this._wgt=this.sheet=null;this.$supers(zss.Namebox,"unbind_",arguments)},setValue:function(a){var b=this.$n("inp");b.value=a},setNames:function(b){this._redrawNames=false;var c=this._names=[],a=b.length;while(a--){c[a]=b[a]}if(this._isOpenPopup()){this._appendNames()}},_appendNames:function(){var a=jq(this.$n("pp"));a.children().remove();a.append(this._redrawNamesHTML_());this._redrawNames=true},_fixPopupSize:function(){var b=this._names.length,a=this.$n("pp");if(!b){a.style.height="150px"}a.style.width=jq(this.$n()).width()+"px"},_isOpenPopup:function(){return zk(this.$n("pp")).isVisible()},_closePopup:function(){var a=this.$n("pp");zk(a).undoVParent();a.style.display="none"},_openPopup:function(){var c=this._redrawNames,a=this.$n("pp");if(!c){this._appendNames()}zk(a).makeVParent();zk(a).position(this.$n(),"after_start");a.style.display="block";this._fixPopupSize();var b=this.$n("inp");setTimeout(function(){b.focus();b.select()})},doMouseDown_:function(a){if(this.isDisabled()){this.$n("inp").blur();a.stop();return}var c=this.sheet;if(c){if(c.state==zss.SSheetCtrl.FOCUSED){var g=a.domTarget,e=this.$n("inp"),d=this.$n("icon");if(e==g){setTimeout(function(){jq(e).select()})}else{if(d==g){this._openPopup()}else{if(jq.isAncestor(this.$n("pp"),g)){this._closePopup()}}}}else{if(c.state==zss.SSheetCtrl.NOFOCUS){var f=c.getLastFocus(),h=f.row,b=f.column;c.dp.moveFocus(h==-1?0:h,b==-1?0:b)}}}},doMouseOver_:function(c){var d=c.domTarget,b=this.$n("pp"),a="zsnamebox-item-over";if(b!=d&&jq.isAncestor(b,d)){jq(b).children("."+a).removeClass(a);jq(d).addClass(a)}},setWidth:function(a){this.$supers(zss.Namebox,"setWidth",arguments);this._fixWidth(a)},_fixWidth:function(b){var e=this.$n(),a=zk.parseInt(b),d=e.firstChild,c=d.nextSibling;d.style.width=jq.px(a-c.clientWidth)},bind_:function(){this.$supers(zss.Namebox,"bind_",arguments);var a=this._wgt.sheetCtrl;if(a){this.sheet=a;a.listen({onCellSelection:this.proxy(this._onCellSelection)})}},unbind_:function(){var a=this.sheet;if(a){a.unlisten({onCellSelection:this.proxy(this._onCellSelection)})}this.sheet=this._wgt=null;this.$supers(zss.Namebox,"unbind_",arguments)},_onCellSelection:function(a){var e=a.data,b=this.$n("inp"),f=this.sheet.getCell(e.top,e.left);if(f){b.value=f.ref}if(this._isOpenPopup()){this._closePopup()}},_redrawNamesHTML_:function(){var d=this._names,e=this.getZclass(),c="";for(var b=0,a=d.length;b<a;b++){c+='<div class="'+e+'-item">'+d[b].v+"</div>"}return c},redrawHTML_:function(){var a=this.uuid,b=this.getZclass();html='<div id="'+a+'" class="'+b+'"><input id="'+a+'-inp" class="'+b+'-inp"></input><div id="'+a+'-icon" class="'+b+'-icon"></div><div id="'+a+'-pp" class="'+b+'-pp" style="display:none;"></div></div>';return html},getZclass:function(){return"zsnamebox"}});zss.FormulabarButton=zk.$extends(zul.wgt.Toolbarbutton,{setDomVisible_:function(c,b,a){this.$supers(zss.FormulabarButton,"setDomVisible_",[c,b,{visibility:1}])},domStyle_:function(a){if(!this.isVisible()){return"visibility:hidden;"}},doMouseOver_:function(b){this.$supers(zss.FormulabarButton,"doMouseOver_",arguments);var a=this.$n().firstChild;jq(a).addClass(this.getSclass()+"-body-over")},doMouseOut_:function(a){this.$supers(zss.FormulabarButton,"doMouseOut_",arguments);jq(this.$n().firstChild).removeClass(this.getSclass()+"-body-over")}});zss.FormulabarWestCave=zk.$extends(zk.Widget,{$o:zk.$void,$init:function(e){this.$supers(zss.FormulabarWestCave,"$init",[]);this._wgt=e;var a=this._namebox=new zss.Namebox(e);this.appendChild(a);var c=this._cancelBtn=new zss.FormulabarButton({label:"✗",sclass:"zsformulabar-cancelbtn",onClick:this.proxy(this._onClickCancelBtn),onMouseDown:this.proxy(this._onMouseDownBtn)}),b=this._okBtn=new zss.FormulabarButton({label:"✓",sclass:"zsformulabar-okbtn",onClick:this.proxy(this._onClickOKBtn),onMouseDown:this.proxy(this._onMouseDownBtn)}),d=this._formulaBtn=new zss.FormulabarButton({label:"f(x)",sclass:"zsformulabar-insertbtn",onClick:this.proxy(this._onClickInsertFormulabar)});c.setVisible(false);b.setVisible(false);this.appendChild(c);this.appendChild(b);this.appendChild(d)},bind_:function(){this.$supers(zss.FormulabarWestCave,"bind_",arguments);var a=this._wgt.sheetCtrl;if(a){this.sheet=a;a.listen({onStartEditing:this.proxy(this._onStartEditing)});a.listen({onStopEditing:this.proxy(this._onStopEditing)})}else{this._formulaBtn.setDisabled(true);this._namebox.setDisabled(true)}},unbind_:function(){var a=this.sheet;if(a){a.unlisten({onStartEditing:this.proxy(this._onStartEditing)});a.unlisten({onStopEditing:this.proxy(this._onStopEditing)})}this._cancelBtn.unlisten({onClick:this.proxy(this._onClickCancelBtn),onMouseDown:this.proxy(this._onMouseDownBtn)});this._okBtn.unlisten({onClick:this.proxy(this._onClickOKBtn),onMouseDown:this.proxy(this._onMouseDownBtn)});this._formulaBtn.unlisten({onClick:this.proxy(this._onClickInsertFormulabar)});this._wgt=this._cancelBtn=this._okBtn=this._formulaBtn=null;this.$supers(zss.FormulabarWestCave,"unbind_",arguments)},_onStartEditing:function(){this._cancelBtn.setVisible(true);this._okBtn.setVisible(true)},_onStopEditing:function(){this._cancelBtn.setVisible(false);this._okBtn.setVisible(false)},_onClickCancelBtn:function(){var a=this.sheet;if(a){a.dp.cancelEditing("formulabarEditing");this._onStopEditing()}},_onClickOKBtn:function(){var a=this.sheet;if(a){a.dp.stopEditing("refocus");this._onStopEditing()}},_onClickInsertFormulabar:function(){var c=this._wgt,a=c.sheetCtrl;if(a){var b=a.getLastSelection();c.fireToolbarAction("insertFunction",{tRow:b.top,lCol:b.left,bRow:b.bottom,rCol:b.right})}},_onMouseDownBtn:function(){var a=this.sheet;if(a){a.shallIgnoreBlur=true}},getNamebox:function(){return this._namebox},redraw:function(a){var c=this.uuid,b='<div id="'+c+'">';b+='<div style="background:#F7F7F7;">'+this._namebox.redrawHTML_()+'<div id="'+c+'-btns" class="zsformulabar-buttons">'+this._cancelBtn.redrawHTML_()+this._okBtn.redrawHTML_()+this._formulaBtn.redrawHTML_()+"</div></div>";b+='<div class="zsformulabar-blank"></div></div>';a.push(b)},setFlexSize_:function(c){var a=this.$supers(zss.FormulabarWestCave,"setFlexSize_",arguments),b=this.$n().clientWidth;this._namebox.setWidth(jq.px(b-this.$n("btns").clientWidth))}});zss.FormulabarWest=zk.$extends(zul.layout.West,{$o:zk.$void,$init:function(a){this.$supers(zss.FormulabarWest,"$init",[]);this.setFlex(true);this.setBorder(0);this.setSplittable(true);this.setCollapsible(false);this.setSclass("zsformulabar-west");this.setSize("265px");var b=this.cave=new zss.FormulabarWestCave(a);this.appendChild(b)},redrawHTML_:function(){return this.$supers(zss.FormulabarWest,"redrawHTML_",arguments)}});zss.ExpandFormulabarButton=zk.$extends(zss.FormulabarButton,{_expanded:false,bind_:function(){this.$supers(zss.ExpandFormulabarButton,"bind_",arguments);if(this._expanded){jq(this.$n()).addClass(this.getSclass()+"-expanded")}},isExpanded:function(){return this._expanded},setExpanded:function(a){if(this._expanded!=a){this._expanded=a;jq(this.$n())[a?"addClass":"removeClass"](this.getSclass()+"-expanded")}},getSclass:function(){return"zsformulabar-expandbtn"}});zss.FormulabarCenterCave=zk.$extends(zk.Widget,{$o:zk.$void,$init:function(a){this.$supers(zss.FormulabarCenterCave,"$init",[]);this._wgt=a;this.appendChild(this.editor=new zss.FormulabarEditor(a));this.appendChild(this.expandBtn=new zss.ExpandFormulabarButton())},bind_:function(){this.$supers(zss.FormulabarCenterCave,"bind_",arguments);if(!this._wgt.sheetCtrl){this.editor.setDisabled(true)}},redraw:function(a){var c=this.uuid,d=this.getZclass(),b='<div id="'+c+'">';b+=(this.editor.redrawHTML_()+'<div id="'+c+'-expandbtn" class="'+d+'-colbtn">'+this.expandBtn.redrawHTML_()+"</div></div>");a.push(b)},getZclass:function(){return"zsformulabar-center-cave"},setFlexSize_:function(e){var c=this.$supers(zss.FormulabarCenterCave,"setFlexSize_",arguments),b=this.$n(),d=this.editor,a=this.$n("expandbtn");d.setWidth(jq.px(b.clientWidth-a.clientWidth));d.setHeight(jq.px(b.clientHeight-zk(d.$n()).sumStyles("tb",jq.borders)))}});zss.FormulabarCenter=zk.$extends(zul.layout.Center,{$o:zk.$void,$init:function(a){this.$supers(zss.FormulabarCenter,"$init",[]);this.setFlex(true);this.setBorder(0);this.appendChild(this.cave=new zss.FormulabarCenterCave(a))},getEditor:function(){return this.cave.editor},getExpandFormulabarBtn:function(){return this.cave.expandBtn},redrawHTML_:function(){return this.$supers(zss.FormulabarCenter,"redrawHTML_",arguments)}});zss.Formulabar=zk.$extends(zul.layout.North,{$o:zk.$void,_prevExpandedSize:47,$init:function(a){this.$supers(zss.Formulabar,"$init",[]);this._wgt=a;this.setFlex(true);this.setBorder(0);this.setSize("27px");this.setMinsize(27);this.setSplittable(true);this.setCollapsible(false)},afterParentChanged_:function(){var d=this._wgt,e=new zul.layout.Borderlayout(),b=new zss.FormulabarWest(d),a=new zss.FormulabarCenter(d),c=this.expandFormulabarBtn=a.getExpandFormulabarBtn();this.editor=a.getEditor();e.appendChild(b);e.appendChild(a);this.appendChild(e);c.listen({onClick:this.proxy(this._onClickExpandFormulabarBtn)})},bind_:function(){this.$supers(zss.Formulabar,"bind_",arguments);this.listen({onSize:this})},unbind_:function(){this.unlisten({onSize:this});this.expandFormulabarBtn.listen({onClick:this.proxy(this._onClickExpandFormulabarBtn)});this.$supers(zss.Formulabar,"unbind_",arguments)},setHeight:function(a){this.$supers(zss.Formulabar,"setHeight",arguments);this._prevExpandedSize=zk.parseInt(a)},onSize:function(l){var k=l.data,i=zk.parseInt(k.height),c=i,j=this.editor,a=this.getMinsize(),e=this.expandFormulabarBtn;var g=zk.parseInt(jq(j.getInputNode()).css("line-height")),f=j.$n().clientHeight-a;if(f>0){var b=f%g;c=a+(b>0?f+(g-b):f);this.setHeight(jq.px(c));j.setHeight(jq.px(c));e.setExpanded(c>a)}else{e.setExpanded(false)}},_onClickExpandFormulabarBtn:function(a){var c=zk.parseInt(this.getSize()),e=this.getMinsize(),d=this.expandFormulabarBtn,b=d.isExpanded();if(b){this.setSize(e+"px")}else{this.setSize(this._prevExpandedSize+"px")}d.setExpanded(!b)},redrawHTML_:function(){return this.$supers(zss.Formulabar,"redrawHTML_",arguments)},getSclass:function(){return"zsformulabar"}})})();
(function(){function a(j,i,g){var h=j.control;h.draging=true;h.sheet.dp.stopEditing("refocus");var l=i[0]-(j._unhide&&h.type==zss.Header.HOR?6:0),k=i[1]-(j._unhide&&h.type!=zss.Header.HOR?6:0);j.start=[l,k];return j._fixstart=false}function b(h,g){h.control.sheet.headerdrag=true}function d(x,u){var s=x.control,l=s.sheet,p=l.cp,q=l.getLastSelection(),g=s.cousin,v=s.index,i=l.selType;s.draging=l.headerdrag=false;if(s.type==zss.Header.HOR){var m=x.last[0]-x.start[0],j=s.orgsize+m,k=q.left,y=q.right;if(j<s.minHWidth){j=s.minHWidth}if(i==zss.SEL.COL&&k<=v&&v<=y){l._setColumnsWidth(k,y,j,true,true,x._unhide?false:undefined)}else{l._setColumnWidth(v,j,true,true,x._unhide?false:undefined)}}else{var m=x.last[1]-x.start[1],t=s.orgsize+m,w=q.top,r=q.bottom;if(t<s.minVHeight){t=s.minVHeight}var h=true;if(i==zss.SEL.ROW&&w<=v&&v<=r){l._setRowsHeight(w,r,t,true,true,x._unhide?false:undefined,null,h)}else{l._setRowHeight(v,t,true,true,x._unhide?false:undefined,null,h)}}s.comp.removeAttribute("style");s.icomp.removeAttribute("style");if(g){g.comp.removeAttribute("style");g.icomp.removeAttribute("style")}p.comp.removeAttribute("style");l.dp._gainFocus(true);var n=l.getLastFocus(),o=l.getLastSelection();l.moveCellFocus(n.row,n.column);l.moveCellSelection(o.left,o.top,o.right,o.bottom);s.orgsize=null}function e(y,v){var r=y.control,q=[v[0],v[1]],t=r.comp,k=r.icomp,l=r.sheet,p=l.cp,g=r.cousin;if(!y._fixstart){y.start[0]-=y.offset[0];y.start[1]-=y.offset[1];y._fixstart=true;r._processDrag(false,y._unhide)}if(r.type==zss.Header.HOR){if(r.orgsize==null){r.orgsize=zk(t).offsetWidth()}var z=y.start[0]-v[0],i=r.orgsize-r.minHWidth;if(i<0){i=0}q=z>=i?[y.start[0]-i,0]:[v[0],0];y.last=[q[0],q[1]];if(zk.opera){var j=r.bcomp;q[0]+=(j.offsetLeft+j.offsetWidth)}if(!zk.opera){var s,o,m,n=q[0]-y.start[0];m=o=s=r.orgsize+n;if(s<r.minHWidth){s=r.minHWidth}t.removeAttribute("style");if(m<5){jq(t).css("padding",0);if(m<=0){jq(t).css("border-right","none")}}if(zk.gecko){o=zk(t).revisedWidth(s)}else{s=o=zk(t).revisedWidth(s)}jq(t).css("width",jq.px0(s));jq(k).css("width",jq.px0(o));if(g){g.comp.removeAttribute("style");if(m<5){jq(g.comp).css("padding",0);if(m<=0){jq(g.comp).css("border-right","none")}}jq(g.comp).css("width",jq.px0(s));jq(g.icomp).css("width",jq.px0(o))}}}else{if(r.orgsize==null){r.orgsize=zk(t).offsetHeight()}var z=y.start[1]-v[1],i=r.orgsize-r.minVHeight;if(i<0){i=0}q=z>=i?[0,y.start[1]-i]:q=[0,v[1]];y.last=[q[0],q[1]];if(!zk.opera){var x,u,n=q[1]-y.start[1];u=x=r.orgsize+n;if(x<r.minVHeight){x=r.minVHeight}t.removeAttribute("style");if(u<5){jq(t).css("padding",0);if(u<=0){jq(t).css("border-bottom","none")}}jq(t).css({height:jq.px0(x-1),"line-height":jq.px0(x-1)});jq(k).css({height:jq.px0(x-1),"line-height":jq.px0(x-1)});if(g){g.comp.removeAttribute("style");if(u<5){jq(g.comp).css("padding",0);if(u<=0){jq(g.comp).css("border-bottom","none")}}jq(g.comp).css({height:jq.px0(x-1),"line-height":jq.px0(x-1)});jq(g.icomp).css({height:jq.px0(x-1),"line-height":jq.px0(x-1)})}}}return q}function f(y,u,q){var z,m=y.control,g=m.ibcomp,i=g.offsetWidth,l=g.offsetHeight,s=(zk.ie&&zk.ie<11)?2:3,t=(zk.ie&&zk.ie<11)?2:3,r=u[1]+l,k=u[0]+i,j=m.sheet.sp.comp;if(m.type==zss.Header.HOR){var o=zk(j).offsetWidth(),v=(j.scrollWidth-o<=0)?0:zss.Spreadsheet.scrollWidth,s=zk(j).offsetHeight()-v-l;z="border-right:thin dotted #000;"}else{var x=zk(j).offsetHeight(),p=(j.scrollHeight-x<=0)?0:zss.Spreadsheet.scrollWidth;t=zk(j).offsetWidth()-p-i;z="border-bottom:thin dotted #000;"}if(jq("#zk_sghost")){jq("#zk_sghost").remove()}var n=['<div id="zk_sghost" style="font-size:0;line-height:0px;',z,"position:absolute;top:",r,"px;left:",k,"px;width:",t,"px;height:",s,'px;z-index:20"></div>'].join("");jq(document.body).append(n);return m.element=jq("#zk_sghost")[0]}var c="H";zss.Header=zk.$extends(zk.Widget,{widgetName:"Header",draging:false,minHWidth:0,minVHeight:0,$init:function(h,i,j,g){this.$supers(zss.Header,"$init",[]);this.sheet=h;this.index=j.i;this._pId=j.p;this.title=j.t||"";this.type=i;if(g){this.cousin=g;g.cousin=this}},getZclass:function(){var g=this._pId;return this.type==c?"zstopcell"+(g?" zsw"+g:""):"zsleftcell zsrow"+(g?" zslh"+g:"")},_getInnerClass:function(){var g=this._pId;return this.type==c?"zstopcelltxt"+(g?" zsw"+g:""):"zsleftcelltxt"+(g?" zslh"+g:"")},redraw:function(g){g.push(this.getHtml())},getHtml:function(){return this.getHtmlPrologHalf()+this.getHtmlEpilogHalf()},getHtmlPrologHalf:function(){var h=this.uuid,g=this.type==c;return'<div id="'+h+'" zs.t="'+(g?"STheader":"SLheader")+'" class="'+this.getZclass()+'"><div class="'+this._getInnerClass()+'">'+this.title+"</div></div>"},getHtmlEpilogHalf:function(){var h=this.uuid,g=this.type==c;return'<div id="'+h+'-boun" class="'+(g?"zshboun":"zsvboun")+'"><div zs.t="SBoun" class="'+(g?"zshbouni":"zsvbouni")+'"></div></div>'},bind_:function(){this.$supers(zss.Header,"bind_",arguments);var h=this.$n(),g=this.$n("boun");this.comp=h;h.ctrl=this;this.bcomp=g;this.bcomp.ctrlref=this;this.ibcomp=g.firstChild;this.ibcomp2=g.lastChild;if(this.ibcomp2==this.ibcomp){delete this.ibcomp2}this.icomp=h.firstChild},unbind_:function(){if(this.drag){this.drag.destroy();this.drag=null}this.comp=this.comp.ctrl=this.bcomp=this.bcomp.ctrlref=this.ibcomp=this.ibcomp2=this.icomp=this.sheet=this.cousin=null;this.$supers(zss.Header,"unbind_",arguments)},detach:function(){var g=this.bcomp;if(g){g.parentNode.removeChild(g)}this.$supers(zss.Header,"detach",arguments)},doTooltipOver_:zk.$void,doTooltipOut_:zk.$void,doClick_:function(g){this.sheet._doMouseleftclick(g)},doMouseDown_:function(g){this.sheet._doMousedown(g)},doMouseUp_:function(g){this.sheet._doMouseup(g)},doRightClick_:function(g){this.sheet._doMouserightclick(g)},doDoubleClick_:function(g){this.sheet._doMousedblclick(g)},setColumnHeader:function(i){var g=this.sheet,h=this.comp,j=this.icomp;jq(h).css("width","");jq(j).css("width","");if(i){if(!this.ibcomp2){this.ibcomp2=jq(this.ibcomp).after('<div class="zshbounw" zs.t="SBoun2"></div>').next()[0]}jq(this.ibcomp).css("visibility","hidden")}else{if(this.ibcomp2){jq(this.ibcomp2).remove();jq(this.ibcomp).css("visibility","");delete this.ibcomp2}}},setRowHeader:function(i){var g=this.sheet,h=this.comp,j=this.icomp;jq(h).css({height:"","line-height":""});jq(j).css({height:"","line-height":""});if(i){if(!this.ibcomp2){this.ibcomp2=jq(this.ibcomp).after('<div class="zsvbounw" zs.t="SBoun2"></div>').next()[0]}jq(this.ibcomp).css("visibility","hidden")}else{if(this.ibcomp2){jq(this.ibcomp2).remove();jq(this.ibcomp).css("visibility","");delete this.ibcomp2}}},appendZSW:function(g){this._pId=g;jq(this.comp).addClass("zsw"+g);jq(this.icomp).addClass("zswi"+g)},appendZSH:function(g){this._pId=g;jq(this.comp).addClass("zslh"+g);jq(this.icomp).addClass("zslh"+g)},resetInfo:function(h,g){this.index=h;if(this.type==zss.Header.HOR){this.c=h;jq(this.icomp).text(g)}else{this.r=h;jq(this.icomp).text(g)}},_processDrag:function(h,k){if(this.sheet.isDragging()){return}if(h&&this.drag&&this.drag._unhide!=k){if(this.draging){return}delete this.drag}if(this.sheet._wgt.isProtect()&&!(this.type==zss.Header.HOR&&this.sheet._wgt.allowFormatColumns)&&!(this.type==zss.Header.VER&&this.sheet._wgt.allowFormatRows)){return}var g=k?this.ibcomp2:this.ibcomp,j=this.type==zss.Header.HOR?(k?"zshbounw-over":"zshbouni-over"):(k?"zsvbounw-over":"zsvbouni-over");jq(g)[h&&!zss.Header.draging?"addClass":"removeClass"](j);if(!this.drag){var i=this;this.drag=new zk.Draggable(this,g,{constraint:(i.type==zss.Header.HOR)?"horizontal":"vertical",ghosting:f,snap:e,ignoredrag:a,starteffect:b,endeffect:d});this.drag._unhide=k}}},{HOR:"H",VER:"V"})})();
(function(){this.animations=[];this.timeout=600;this.disabled=false;this.running=false;this.animate=e;function e(){if(this.disabled){return}this.running=false;var h=this.animations,g=h.length;for(var f=0;f<g;f++){h[f].animate()}if(g>0){this.running=true;setTimeout(e,600)}}function b(h){var j=this.animations,g=j.length;for(var f=0;f<g;f++){if(j[f]==h){return}}j.push(h);if(!this.running){this.running=true;setTimeout(e,600)}}function d(j){var k=this.animations,h=k.length;for(var g=0;g<h;g++){if(k[g]==j){var f=k.slice(g+1);k.length=g;k.push.apply(k,f)}}}function c(f){if(!f.invalid&&f.animated){if(!f.flash){jq(f.comp).addClass("zshighlight2");f.flash=true}else{jq(f.comp).removeClass("zshighlight2");f.flash=false}}}function a(f,g){if(g&&!f.animated){b(f);f.animated=true}else{if(!g&&f.animated){jq(f.comp).removeClass("zshighlight2");d(f);f.animated=false}}}zss.Highlight=zk.$extends(zss.AreaCtrl,{animate:function(){c(this)},doAnimation:function(f){a(this,f)}});zss.HighlightTop=zk.$extends(zss.AreaCtrlTop,{animate:function(){c(this)},doAnimation:function(f){a(this,f)}});zss.HighlightLeft=zk.$extends(zss.AreaCtrlLeft,{animate:function(){c(this)},doAnimation:function(f){a(this,f)}});zss.HighlightCorner=zk.$extends(zss.AreaCtrlCorner,{animate:function(){c(this)},doAnimation:function(f){a(this,f)}})})();
zss.Id=zk.$extends(zk.Object,{last:0,increase:1,$init:function(a,b){this.$supers("$init",arguments);this.last=a;this.increase=b},next:function(){this.last+=this.increase;return this.last}});
zss.Info=zk.$extends(zk.Object,{$init:function(a,b){this.$supers("$init",arguments);this.sheet=a;this.comp=b;this.txtcomp=jq(b).children("SPAN:first")[0];this.visible=false;this.displaytime=2000;this.showcount=0;this.enabled=true;b.ctrl=this;this.lastautohide},cleanup:function(){this.invalid=true;this.visible=this.enabled=false;if(this.comp){this.comp.ctrl=null}this.sheet=this.comp=this.txtcmop=null},setEnabled:function(a){if(this.enabled==a){return}this.enabled=a;if(!a){this.hideInfo()}},showInfo:function(a){if(!this.enabled){return}this.lastautohide=a;this.visible=true;jq(this.comp).css("display","inline");if(a){var b=this;this.showcount++;setTimeout(function(){b.showcount--;if(b.showcount<=0){setTimeout(function(){if(b.showcount>0){return}if(!b.lastautohide){return}b.hideInfo()},b.displaytime)}},300)}},setInfoText:function(b){var a=this.txtcomp;b=b.trim();jq(a).text(b)},hideInfo:function(){if(!this.visible){return}this.visible=false;jq(this.comp).css("display","none")}});
(function(){})();
(function(){var b=0,a=1;zss.MainBlockCtrl=zk.$extends(zss.CellBlockCtrl,{loadstate:b,_loadVisibleOnResponse:false,replaceWidget:function(d){this.$supers(zss.MainBlockCtrl,"replaceWidget",[d]);var c=d.range;d.create_("jump",c.top,c.left,c.bottom,c.right,true)},create_:function(d,i,f,g,h,c){var e=this.sheet;switch(d){case"east":case"west":e.tp.create_(d,f,h,0,e._wgt.getRowFreeze());break;case"north":case"south":e.lp.create_(d,i,g,0,e._wgt.getColumnFreeze());break;case"jump":e.tp.create_(d,f,h,0,e._wgt.getRowFreeze());e.lp.create_(d,i,g,0,e._wgt.getColumnFreeze());break}if(!c){this.$supers(zss.MainBlockCtrl,"create_",[d,i,f,g,h])}e.dp._fixSize(this)},_recheckVisible:function(){var c=this,d=this.sheet;clearTimeout(c._timeoutId);c._timeoutId=setTimeout(function(){c.loadForVisible()},50)},_createCellsIfCached:function(f,q,r,n){var l=this.sheet,p=l._wgt,k=this.range,e=p.getMaxRenderedCellSize(),h=p._cacheCtrl.getSelectedSheet(),o=n||zss.SSheetCtrl._getVisibleRange(l);switch(f){case"south":var m=k.bottom+1,d=k.left,j=k.right,i=m+q-1,c=false;i=Math.min(i,l.maxRows-1);if(h.containsRange(m,d,i,j)){this.create_(f,m,d,i,j);var q=this.range.size(),g=q>e;if(g&&k.top+o.height<o.top){this.pruneCell("north",o,r?null:o.top-(k.top+o.height))}c=true}break;case"north":var i=k.top-1,d=k.left,j=k.right,m=i-q+1,c=false;i=i>=0?i:0;m=m>=0?m:0;if(h.containsRange(m,d,i,j)){this.create_(f,m,d,i,j);var q=this.range.size(),g=q>e;if(g&&(k.bottom-o.height>o.bottom)){this.pruneCell("south",o,r?null:k.bottom-o.height-o.bottom)}c=true}break;case"west":var m=k.top,i=k.bottom,j=k.left-1,d=j-q+1,c=false;j=j>=0?j:0;d=d>=0?d:0;if(h.containsRange(m,d,i,j)){this.create_(f,m,d,i,j);var q=this.range.size(),g=q>e;if(g&&(k.right-o.width>o.right)){this.pruneCell("east",o,r?null:k.right-o.width-o.right)}c=true}break;case"east":var m=k.top,i=k.bottom,d=k.right+1,j=d+q-1,c=false;j=Math.min(j,l.maxCols-1);if(h.containsRange(m,d,i,j)){this.create_(f,m,d,i,j);var q=this.range.size(),g=q>e;if(g&&(k.left+o.width<o.left)){this.pruneCell("west",o,r?null:(o.left-(k.left+o.width)))}c=true}break}if(c){this.sheet.dp._fixSize(this);this._recheckVisible();return true}return false},doScroll:function(f){var i=this.sheet,g=zss.SSheetCtrl._getVisibleRange(i),l=false;i._wgt._sheetScrolled=true;if(f){var k=this.range.top,j=this.range.bottom;if(g.top>=k&&g.top<=j){if(g.bottom<j){return}var e=g.bottom-j+1;if(e>0&&!this._createCellsIfCached("south",e)){i.activeBlock.loadCell(g.bottom,g.left,(l?-1:20),null,l)}}else{if(k>=g.top&&k<=g.bottom){var e=k-g.top+1;if(!this._createCellsIfCached("north",e)){i.activeBlock.loadCell(g.top,g.left,(l?-1:20),null,l)}}else{if(g.top>j){if(!this._createCellsIfCached("south",g.height,true)){i.activeBlock.loadCell(g.bottom,g.left,-1,null,l)}}else{if(k>g.bottom){if(!this._createCellsIfCached("north",g.height,true)){i.activeBlock.loadCell(g.top,g.left,-1,null,l)}}else{return}}}}}else{var h=this.range.left,d=this.range.right;if(g.left>=h&&g.left<=d){if(g.bottom<j){return}var c=g.right-d+1;if(c>0&&!this._createCellsIfCached("east",c)){i.activeBlock.loadCell(g.top,g.right,(l?-1:5),null,l)}}else{if(h>=g.left&&h<=g.right){var c=h-g.left+1;if(!this._createCellsIfCached("west",c)){i.activeBlock.loadCell(g.top,g.left,(l?-1:5),null,l)}}else{if(g.left>d){if(!this._createCellsIfCached("east",g.width,true)){i.activeBlock.loadCell(g.top,g.right,-1,null,l)}}else{if(h>g.right){if(!this._createCellsIfCached("west",g.width,true)){i.activeBlock.loadCell(g.top,g.left,-1,null,l)}}else{return}}}}}},_sendOnCellFetch:function(j,g,u,h,s,m,w,d){var i=this.sheet;this.loadstate=zss.MainBlockCtrl.LOADING;if(!d){d=zss.SSheetCtrl._getVisibleRange(i)}var k=i._wgt,p=this.range,f=this.sheet.sp.comp,t=this.sheet.dp,n=k._cacheCtrl.getSelectedSheet().rect,r=-1,o=-1;arLeftWidth=-1,arRightWidth=-1;if("east"==u||"west"==u){var e=p.top-n.top+1,l=n.bottom-p.bottom+1;if(e>1){r=e}if(l>1){o=l}}else{if("north"==u||"south"==u){var q=i._wgt._cacheCtrl.getSelectedSheet(),v=p.left-n.left,c=n.right-p.right;if(v>0){q.pruneLeft(v)}if(c>0){q.pruneRight(c)}}}k.fire("onZSSCellFetch",{token:j,sheetId:i.serverSheetId,type:g,direction:u,dpWidth:t.width,dpHeight:t.height,viewWidth:f.clientWidth,viewHeight:f.clientHeight,blockLeft:p.left,blockTop:p.top,blockRight:p.right,blockBottom:p.bottom,fetchLeft:h,fetchTop:s,fetchWidth:m,fetchHeight:w,rangeLeft:d.left,rangeTop:d.top,rangeRight:d.right,rangeBottom:d.bottom,arLeft:n.left,arTop:n.top,arRight:n.right,arBottom:n.bottom,arFetchTopHeight:r,arFetchBtmHeight:o},{toServer:true},25)},_getLastDirection:function(){return this.sheet.activeBlock._lastDir},loadCell:function(l,i,C,j,B){var k=this.range.left,m=this.range.top,f=this.range.width,t=this.range.height,E=this.range.right,s=this.range.bottom;var g=this.sheet,e=g.getLastFocus();if(e.row==l&&e.column==i){return true}if(l>=m&&l<=s&&i>=k&&i<=E){return true}if(this.loadstate!=zss.MainBlockCtrl.IDLE){return false}var n="",u=zss.SSheetCtrl._getVisibleRange(g),v=this,z=u.width,c=u.height,d=g._wgt._cacheCtrl.getSelectedSheet().rect;if((l>=m&&l<=s)){if(i<k){var p=m,A=t,q=d.left-1,r=q-i+1;if(B||(r>0&&r>z)){n=zkS.addCallback(function(){if(g.invalid){return}var h=g.activeBlock;h._lastDir=null;h.loadstate=zss.MainBlockCtrl.IDLE;if(j){j()}h.loadForVisible()});this._sendOnCellFetch(n,"jump","west",i,l,-1,-1,u)}else{if(q-r<0){r=q+1}var o=function(){if(g.invalid){return}var G=g.activeBlock,h=G._lastDir,F=g._wgt,y=F.getMaxRenderedCellSize(),x=G.range.size(),w=x>y;G._lastDir="H";if(w){if(h&&h=="V"){G.pruneCell("south",u,1);G.pruneCell("north",u,1)}else{if(C>=0){G.pruneCell("east",u,C)}}}G.loadstate=zss.MainBlockCtrl.IDLE;if(j){j()}G.loadForVisible()};if(r>0){n=zkS.addCallback(o);this._sendOnCellFetch(n,"neighbor","west",q,p,r,A,u)}else{o()}}}else{var p=m,q=d.right+1,r=i-q+1;if(B||(r>0&&r>z)){n=zkS.addCallback(function(){if(g.invalid){return}var h=g.activeBlock;h._lastDir=null;h.loadstate=zss.MainBlockCtrl.IDLE;if(j){j()}h.loadForVisible()});this._sendOnCellFetch(n,"jump","east",i,l,-1,-1,u)}else{var A=t;if(q+r>this.sheet.maxCols){r=this.sheet.maxCols-q}var o=function(){if(g.invalid){return}var G=g.activeBlock,h=G._lastDir,F=g._wgt,y=F.getMaxRenderedCellSize(),x=G.range.size(),w=x>y;G._lastDir="H";if(w){if(h&&h=="V"){G.pruneCell("south",u,1);G.pruneCell("north",u,1)}else{if(C>=0){G.pruneCell("west",u,C)}}}G.loadstate=zss.MainBlockCtrl.IDLE;if(j){j()}G.loadForVisible()};if(r>0){n=zkS.addCallback(o);this._sendOnCellFetch(n,"neighbor","east",q,p,r,A,u)}else{o()}}}}else{if((i>=k&&i<=E)){if(l<m){var q=k,r=f,p=d.top-1,A=p-l+1;if(B||(A>0&&A>c)){n=zkS.addCallback(function(){if(g.invalid){return}var h=g.activeBlock;h._lastDir=null;h.loadstate=zss.MainBlockCtrl.IDLE;if(j){j()}h.loadForVisible()});this._sendOnCellFetch(n,"jump","north",i,l,-1,-1,u)}else{if(p-A<0){A=p+1}var o=function(){if(g.invalid){return}var G=g.activeBlock,h=G._lastDir,F=g._wgt,y=F.getMaxRenderedCellSize(),x=G.range.size(),w=x>y;v._lastDir="V";if(w){if(h&&h=="H"){G.pruneCell("east",u,1);G.pruneCell("west",u,1)}else{if(C>=0){G.pruneCell("south",u,C)}}}g.activeBlock.loadstate=zss.MainBlockCtrl.IDLE;if(j){j()}g.activeBlock.loadForVisible()};if(A>0){n=zkS.addCallback(o);this._sendOnCellFetch(n,"neighbor","north",q,p,r,A,u)}else{o()}}}else{var p=d.bottom+1,q=k,r=f,A=l-p+1;if(B||(A>0&&A>c)){n=zkS.addCallback(function(){if(g.invalid){return}var h=g.activeBlock;h._lastDir=null;h.loadstate=zss.MainBlockCtrl.IDLE;if(j){j()}h.loadForVisible()});this._sendOnCellFetch(n,"jump","south",i,l,-1,-1,u)}else{if(p+A>this.sheet.maxRows){A=this.sheet.maxRows-p}var o=function(){if(g.invalid){return}var G=g.activeBlock,h=G._lastDir,F=g._wgt,y=F.getMaxRenderedCellSize(),x=G.range.size(),w=x>y;G._lastDir="V";if(w){if(h&&h=="H"){G.pruneCell("east",u,1);G.pruneCell("west",u,1)}else{if(C>=0){G.pruneCell("north",u,C)}}}G.loadstate=zss.MainBlockCtrl.IDLE;if(j){j()}G.loadForVisible()};if(A>0){n=zkS.addCallback(o);this._sendOnCellFetch(n,"neighbor","south",q,p,r,A,u)}else{o()}}}}else{n=zkS.addCallback(function(){if(g.invalid){return}var h=g.activeBlock;h.loadstate=zss.MainBlockCtrl.IDLE;if(j){j()}h.loadForVisible()});var D="";if(l<m&&i<k){D="westnorth"}else{if(l<m&&i>E){D="eastnorth"}else{if(l>s&&i<k){D="westsouth"}else{if(l>s&&i>E){D="eastsouth"}else{D="eastnorth"}}}}this._sendOnCellFetch(n,"jump",D,i,l,-1,-1,u)}}return false},pruneCell:function(h,f,o){var g=this.sheet;if(!g.config.prune){return}if(!f){f=zss.SSheetCtrl._getVisibleRange(g)}if(!o||o<0){o=0}var m=false,v=g._wgt,n=v.isClientCacheDisabled(),e=v._cacheCtrl.getSelectedSheet(),k=e.rect;if(h=="west"){var d=f.left-o;d=g.mergeMatrix.getLeftConnectedColumn(d,this.range.top,this.range.bottom);if(d<=0||d<this.range.left){return}var u=d-this.range.left;if(u>0){if(u>this.range.width){u=this.range.width}this.removeColumnsFromStart_(u);g.tp.removeChildFromStart_(u);if(n){var j=v.getPreloadColumnSize();if(j<=0){e.pruneLeft(u)}else{var q=(d-e.rect.left+1)-j;if(q>0){e.pruneLeft(q)}}m=true}}}else{if(h=="east"){var c=f.right+o;c=g.mergeMatrix.getRightConnectedColumn(c,this.range.top,this.range.bottom);if(c>this.range.right){return}var u=this.range.right-c;if(u>0){if(u>this.range.width){u=this.range.width}this.removeColumnsFromEnd_(u);g.tp.removeChildFromEnd_(u);if(n){var j=v.getPreloadColumnSize();if(j<=0){e.pruneRight(u)}else{var q=(e.rect.right-c+1)-j;if(q>0){e.pruneRight(q)}}m=true}}}else{if(h=="north"){var s=f.top-o;s=g.mergeMatrix.getTopConnectedRow(s,this.range.left,this.range.right);if(s<=0||s<this.range.top){return}var u=s-this.range.top;if(u>0){if(u>this.range.height){u=this.range.height}this.removeRowsFromStart_(u);g.lp.removeChildFromStart_(u);if(n){var p=v._preloadRowSize;if(p<=0){e.pruneTop(u)}else{var q=(s-e.rect.top+1)-p;if(q>0){e.pruneTop(q)}}m=true}}}else{if(h=="south"){var i=f.bottom+o;i=g.mergeMatrix.getBottomConnectedRow(i,this.range.left,this.range.right);if(i>this.range.bottom){return}var u=this.range.bottom-i;if(u>0){if(u>this.range.height){u=this.range.height}this.removeRowsFromEnd_(u);g.lp.removeChildFromEnd_(u);if(n){var p=v._preloadRowSize;if(p<=0){e.pruneBottom(u)}else{var q=(e.rect.bottom-i+1)-p;if(q>0){e.pruneBottom(q)}}m=true}}}}}}if(m){setTimeout(function(){g.sendSyncblock()},0)}g.dp._fixSize(this)},_getEastFetchWidth:function(e,d){var c=this.sheet;return Math.min(c._wgt.getMaxColumns(),e+c._wgt.getPreloadColumnSize())-d},_getSouthFetchHeight:function(d,e){var c=this.sheet;return Math.min(c._wgt.getMaxRows(),d+c._wgt.getPreloadRowSize())-e},_getWestFetchWidth:function(e,c){var d=this.sheet;return c-Math.max(0,e-d._wgt.getPreloadColumnSize())},_getNorthFetchHeight:function(e,c){var d=this.sheet;return c-Math.max(0,e-d._wgt.getPreloadRowSize())},_getSouthRow:function(d){var c=this.sheet;return Math.min(c._wgt.getMaxRows(),d+Math.round(c._wgt.getPreloadRowSize()/2))},_getEastCol:function(d){var c=this.sheet;return Math.min(c._wgt.getMaxColumns(),d+Math.round(c._wgt.getPreloadColumnSize()/2))},_getNorthRow:function(d){var c=this.sheet;return Math.max(0,d-Math.round(c._wgt.getPreloadRowSize()/2))},_getWestCol:function(d){var c=this.sheet;return Math.max(0,d-Math.round(c._wgt.getPreloadColumnSize()/2))},loadForVisible:function(g){if(!this._loadForVisible(g)){var h=this.sheet;if(h){var m=h._wgt,i=m._autoFilter;if(i!=null&&m.setAutoFilter){var d=i.range,f=d.left,k=d.top,c=d.right;if(!g){g=zss.SSheetCtrl._getVisibleRange(h)}if((k<=g.bottom&&k>=g.top)||(f<=g.right&&c>=g.left)){m.setAutoFilter(i)}}var j=m._tableFilters;if(j&&m.setTableFilters){for(var e in j){if(!j.hasOwnProperty(e)){continue}var i=j[e];if(i){var d=i.range,f=d.left,k=d.top,c=d.right;if(!g){g=zss.SSheetCtrl._getVisibleRange(h)}if((k<=g.bottom&&k>=g.top)||(f<=g.right&&c>=g.left)){m._prepareAutoFilter(h,m._tableFilters?m._tableFilters[e]:null,i)}}}}}}},_loadForVisible:function(j){var x=this,g=this.sheet;if(!g){return false}if(this.loadstate!=zss.MainBlockCtrl.IDLE){if(!this._loadVisibleOnResponse){this._loadVisibleOnResponse=true;g._wgt._onResponseCallback.push(function(){x.loadForVisible.apply(x);x._loadVisibleOnResponse=false})}return true}var c=j||zss.SSheetCtrl._getVisibleRange(g);var G=c.top,w=c.left,p=c.right,d=c.bottom,q=this.range,s=q.top,e=q.left,F=q.right,i=q.bottom,t=g._wgt._cacheCtrl.getSelectedSheet();if(F+1<=p){var B=false,D=g._wgt.getRowFreeze(),m=this._getEastCol(p);if(t.containsRange(s,F+1,i,m)){this._createCellsIfCached("east",m-F,null,c);B=true}else{if(t.rect.right>=F+1&&t.rect.right<m&&t.containsRange(s,F+1,i,t.rect.right)){this._createCellsIfCached("east",t.rect.right-F,null,c);B=true}}if(B){q=this.range;s=q.top;e=q.left;F=q.right;i=q.bottom}}if(e-1>=w){var B=false,D=g._wgt.getRowFreeze(),C=this._getWestCol(w);if(t.containsRange(s,C,i,e-1)){this._createCellsIfCached("west",e-C,null,c);B=true}else{if(t.rect.left>C&&t.rect.left<=e-1&&t.containsRange(s,t.rect.left,i,e-1)){this._createCellsIfCached("west",e-t.rect.left,null,c);B=true}}if(B){q=this.range;s=q.top;e=q.left;F=q.right;i=q.bottom}}if(i+1<=d){var B=false,A=g._wgt.getColumnFreeze(),r=this._getSouthRow(d);if(t.containsRange(i+1,e,r,F)){this._createCellsIfCached("south",r-i,null,c);B=true}else{if(t.rect.bottom>=i+1&&t.rect.bottom<r&&t.containsRange(i+1,e,t.rect.bottom,F)){this._createCellsIfCached("south",t.rect.bottom-i,null,c);B=true}}if(B){q=this.range;s=q.top;e=q.left;F=q.right;i=q.bottom}}if(G<s){var B=false,A=g._wgt.getColumnFreeze(),y=this._getNorthRow(G);if(t.containsRange(y,e,s-1,F)){this._createCellsIfCached("north",s-y,null,c);B=true}else{if(t.rect.top>y&&t.rect.top<=s-1&&t.containsRange(t.rect.top,e,s-1,F)){this._createCellsIfCached("north",s-t.rect.top,null,c);B=true}}if(B){q=this.range;s=q.top;e=q.left;F=q.right;i=q.bottom}}if(G>i||d<s||w>F||p<e){this.loadCell(c.top,c.left,0,null,true);return true}else{if(!(G>=s&&w>=e&&d<=i&&p<=F)){var o=-1,f=-1,l=-1,H=-1,E=t.rect.right,n=t.rect.bottom,v=t.rect.left,z=t.rect.top;if(E<p){f=this._getEastFetchWidth(p,E)}else{if(v>w){H=this._getWestFetchWidth(w,v)}}if(n<d){o=this._getSouthFetchHeight(d,n)}else{if(z>G){l=this._getNorthFetchHeight(G,z)}}var h=zkS.addCallback(function(){if(x.invalid||!x.range){return}var J=g.activeBlock;J.loadstate=zss.MainBlockCtrl.IDLE;J.loadForVisible();g.dp._fixSize(x)});var k=f>0?f:H,I=o>0?o:l;if(I>0||k>0){this.loadstate=zss.MainBlockCtrl.LOADING;this._sendOnCellFetch(h,"visible","",-1,-1,k,I,c)}return true}}g.dp._fixSize(this);var u=g.deferLoader;if(!u){u=g.deferLoader=new zss.DeferLoader(g)}u.asyncRun();g.sendSyncblock(true);return false},reloadBlock:function(f){var k=this,i=this.sheet,h=zss.SSheetCtrl._getVisibleRange(i),j=this.range.top,e=this.range.left,l=this.range.right,c=this.range.bottom;var g=zkS.addCallback(function(){if(i.invald){return}var o=i.activeBlock,n=o.range;o.loadstate=zss.MainBlockCtrl.IDLE;if(f=="east"||f=="west"){i.sp.scrollToVisible(null,f=="east"?n.right:n.left)}else{if(f=="south"||f=="north"){i.sp.scrollToVisible(f=="south"?n.bottom:n.top?n.right:n.left,null)}}o.loadForVisible()});var d=f=="east"?l:e,m=f=="south"?c:j;this._sendOnCellFetch(g,"jump",(f?f:"west"),d,m,-1,-1,h)}},{IDLE:0,LOADING:1})})();
zss.MergeMatrix=zk.$extends(zk.Object,{mergeMatrix:[],$init:function(a,b){this.$supers("$init",arguments);this.mergeMatrix=a;this.sheet=b},getRangesByRow:function(e){var d=this.mergeMatrix.length,a=[],b;for(var c=0;c<d;c++){b=this.mergeMatrix[c];if(b.top<=e&&b.bottom>=e){a.push(b)}}return a},getTopConnectedRow:function(g,a,f){var h=this.mergeMatrix.length,j=[],e,d=this.sheet.frozenCol;for(var c=0;c<h;c++){e=this.mergeMatrix[c];if(e.left>d&&(e.left<a||e.right>f)){continue}j.push(e)}var b=true;while(b){b=false;h=j.length;for(var c=0;c<h;c++){e=j[c];if(e.top<g&&e.bottom>=g){g=e.top;b=true;break}}}return g},getBottomConnectedRow:function(g,a,f){var h=this.mergeMatrix.length,j=[],e,d=this.sheet.frozenCol;for(var c=0;c<h;c++){e=this.mergeMatrix[c];if(e.left>d&&(e.left<a||e.right>f)){continue}j.push(e)}var b=true;while(b){b=false;h=j.length;for(var c=0;c<h;c++){e=j[c];if(e.bottom>g&&e.top<=g){g=e.bottom;b=true;break}}}return g},getRangesByColumn:function(c){var e=this.mergeMatrix.length,a=[],b;for(var d=0;d<e;d++){b=this.mergeMatrix[d];if(b.left<=c&&b.right>=c){a.push(b)}}return a},getLeftConnectedColumn:function(b,f,a){var h=this.mergeMatrix.length,j=[],e,g=this.sheet.frozenRow;for(var d=0;d<h;d++){e=this.mergeMatrix[d];if(e.top>g&&(e.top<f||e.bottom>a)){continue}j.push(e)}var c=true;while(c){c=false;h=j.length;for(var d=0;d<h;d++){e=j[d];if(e.left<b&&e.right>=b){b=e.left;c=true;break}}}return b},getRightConnectedColumn:function(b,f,a){var h=this.mergeMatrix.length,j=[],e,g=this.sheet.frozenRow;for(var d=0;d<h;d++){e=this.mergeMatrix[d];if(e.top>g&&(e.top<f||e.bottom>a)){continue}j.push(e)}var c=true;while(c){c=false;h=j.length;for(var d=0;d<h;d++){e=j[d];if(e.right>b&&e.left<=b){b=e.right;c=true;break}}}return b},addMergeRange:function(f,e,d,c,b){var a=new zss.Range(e,d,c,b);a.id=f;this.mergeMatrix.push(a)},removeMergeRange:function(e){var d=this.mergeMatrix,c=d.length;for(var b=0;b<c;b++){range=d[b];if(range.id==e){var a=d.slice(b+1,c);d.length=b;d.push.apply(d,a);break}}},getTopRow:function(e){var c=this.mergeMatrix.length,d=e,a;for(var b=0;b<c;b++){a=this.mergeMatrix[b];if(a.top<=e&&a.bottom>=e&&a.top<d){d=a.top}}return d},getLeftCol:function(b){var d=this.mergeMatrix.length,e=b,a;for(var c=0;c<d;c++){a=this.mergeMatrix[c];if(a.left<=b&&a.right>=b&&a.left<e){e=a.left}}return e},removeAllMergeRange:function(a,e){if(e){var f=this.mergeMatrix,d=f.length;for(var c=0;c<d;c++){var b=f[c];e.call(a,b)}}this.mergeMatrix=[]}});
zss.CornerPanel=zk.$extends(zk.Widget,{widgetName:"CornerPanel",$o:zk.$void,$init:function(i,d,f,b,k,h,g,e){this.$supers(zss.CornerPanel,"$init",[]);this.sheet=i;var l=i._wgt;var a=l.getRowFreeze();var j=l.getColumnFreeze();if(j>-1&&a>-1){if(e.cornerFrozen){e=e.cornerFrozen}this.appendChild(tp=this.tp=new zss.TopPanel(i,f,0,j,e,true),true);this.appendChild(lp=this.lp=new zss.LeftPanel(i,d,0,a,e,true),true);h=j;g=a;this.appendChild(this.block=new zss.CellBlockCtrl(i,0,0,g,h,e,"corner"),true)}else{if(j>-1){this.appendChild(tp=this.tp=new zss.TopPanel(i,f,0,j,(e.leftFrozen?e.leftFrozen:e),true),true)}else{if(a>-1){this.appendChild(lp=this.lp=new zss.LeftPanel(i,d,0,a,(e.topFrozen?e.topFrozen:e),true),true)}}}},redraw:function(b){var d=this.uuid,c=this.sheet,e=c.frozenRow,a=c.frozenCol;b.push('<div id="'+d+'" class="zscorner zsfzcorner" zs.t="SCorner">');if(this.tp){this.tp.redraw(b)}if(this.lp){this.lp.redraw(b)}if(this.block){this.block.redraw(b);b.push('<div id="',d,'-select" class="zsselect" zs.t="SSelect">','<div class="zsselecti" zs.t="SSelInner"></div><div class="zsseldot" zs.t="SSelDot"></div></div>','<div id="',d,'-selchg" class="zsselchg" zs.t="SSelChg"><div class="zsselchgi"></div></div>','<div id="',d,'-focmark" class="zsfocmark" zs.t="SFocus"><div class="zsfocmarki"></div></div>','<div id="',d,'-highlight" class="zshighlight" zs.t="SHighlight"><div class="zshighlighti"></div></div>','<div id="',d,'-cornerwp" class="zswidgetpanel" zs.t="SWidgetpanel"></div>')}b.push('<div class="zscorneri" ></div></div>')},bind_:function(){this.$supers(zss.CornerPanel,"bind_",arguments);this.comp=this.$n();if(this.block){var c=this.sheet,d=this.$n("select"),e=d.nextSibling,b=e.nextSibling,g=b.nextSibling;this.selArea=new zss.SelAreaCtrlCorner(c,d,c.initparm.selrange.clone());this.selChgArea=new zss.SelChgCtrlCorner(c,e);this.focusMark=new zss.FocusMarkCtrlCorner(c,b,c.initparm.focus.clone());this.hlArea=new zss.HighlightCorner(c,g,c.initparm.hlrange.clone(),"inner");var c=this.sheet;if(c.editorFocusMark){var f="";for(var h in c.editorFocusMark){var a=c.editorFocusMark[h];this.addEditorFocus(h,f)}}}},unbind_:function(){if(this.editorFocusMark){for(var b in this.editorFocusMark){var a=this.editorFocusMark[b];this._removeEditorFocusMark(a)}this.editorFocusMark=null}if(this.selArea){this.selArea.cleanup();this.selArea=null}if(this.selChgArea){this.selChgArea.cleanup();this.selChgArea=null}if(this.focusMark){this.focusMark.cleanup();this.focusMark=null}if(this.hlArea){this.hlArea.cleanup();this.hlArea=null}this.sheet=this.tp=this.lp=this.block=this.comp=null;this.$supers(zss.CornerPanel,"unbind_",arguments)},_cornerHeight:function(){var a=this.sheet,b=a.topHeight,c=a.frozenRow;return(c>-1)?(b+a.custRowHeight.getStartPixel(c+1)):b+1},_cornerWidth:function(){var b=this.sheet,c=b.leftWidth,a=b.frozenCol;return(a>-1)?(c-1+b.custColWidth.getStartPixel(a+1)):c},_fixSize:function(){var a=this.sheet._wgt;zcss.setRule(a.getSelectorPrefix()+" .zscorner",["width","height"],[this._cornerWidth()+"px",this._cornerHeight()+"px"],true,a.getSheetCSSId())},appendZSW:function(a,b){if(this.block){this.block.appendZSW(a,b)}if(this.tp){this.tp.appendZSW(a,b)}if(this.lp){this.lp.appendZSW(a,b)}},appendZSH:function(b,a){if(this.block){this.block.appendZSH(b,a)}if(this.tp){this.tp.appendZSH(b,a)}if(this.lp){this.lp.appendZSH(b,a)}},insertNewColumn:function(b,c,a){if(this.block){this.block.insertNewColumn(b,c)}if(this.tp){this.tp.insertNewColumn(b,c,a)}if(this.lp){this.lp.insertNewColumn(b,c)}},insertNewRow:function(c,b,a){if(this.block){this.block.insertNewRow(c,b)}if(this.tp){this.tp.insertNewRow(c,b)}if(this.lp){this.lp.insertNewRow(c,b,a)}},removeColumn:function(b,c,a){if(this.block){this.block.removeColumn(b,c)}if(this.tp){this.tp.removeColumn(b,c,a)}if(this.lp){this.lp.removeColumn(b,c)}},removeRow:function(c,b,a){if(this.block){this.block.removeRow(c,b)}if(this.tp){this.tp.removeRow(c,b)}if(this.lp){this.lp.removeRow(c,b,a)}},addEditorFocus:function(f,b){if(this.editorFocusMark&&this.editorFocusMark[f]){return}if(this.block){var c=this.sheet,d=this.$n("focmark"),a=d,e=a.cloneNode(true);e.id=e.id+"_"+f;e.style.borderWidth="3px";a.parentNode.appendChild(e);this.addEditorFocus_(f,b,e)}},addEditorFocus_:function(c,a,b){if(!this.editorFocusMark){this.editorFocusMark=new Object()}this.editorFocusMark[c]=new zss.FocusMarkCtrlCorner(this.sheet,b,new zss.Pos(0,0))},removeEditorFocus:function(b){if(this.block){if(!this.editorFocusMark){return}var a=this.editorFocusMark[b];this._removeEditorFocusMark(a);this.editorFocusMark[b]=null}},_removeEditorFocusMark:function(a){if(a){a.comp.parentNode.removeChild(a.comp);a.cleanup()}},moveEditorFocus:function(e,c,a,d,b){if(this.block){if(!this.editorFocusMark||!this.editorFocusMark[e]){this.addEditorFocus(e,c)}this.editorFocusMark[e].relocate(d,b);this.editorFocusMark[e].showMark(a,c)}}});
(function(){zss.Panel=zk.$extends(zk.Widget,{widgetName:"Panel",$o:zk.$void,$init:function(d,c,f,a,e,b){this.$supers(zss.Panel,"$init",[]);this.sheet=d;this.hidehead=c;this.isCorner=b;this.headers=this.initHeaders_(d,f,a,e,b);this.block=this.initFrozenBlock_(d,f,a,e)},getHeader:function(c){var d=this.headers;for(var b=0,a=d.length;b<a;++b){if(d[b].index==c){return d[b]}}return null},initHeaders_:function(c,e,a,d,b){return null},isEmptyHeader:function(){return !(this.headers&&this.headers.length>0)},initFrozenBlock_:function(b,d,a,c){return null},createHeaders_:function(c,a,d){var m=this.sheet,b=this.getHeaderData_(),l=this.isInsert_(c),n=this.getHeaderType_(),k="",o=[];if("jump"==c){this._clearAllHeader()}for(var f=a,e=0;f<=d;f++){var g=new zss.Header(m,n,b[f]);l?this.insertHeader_(e++,g):this.appendHeader_(g)}this.updateSelectionCSS_()},updateSelectionCSS_:function(){},_clearAllHeader:function(){var b=this.headers,a=b?b.length:0;this.removeChildFromStart_(a)},getHeaderData_:function(){},getFrozenData_:function(){},getFrozenHeaderData_:function(){},getHeaderType_:function(){},isInsert_:function(a){},appendHeader_:function(a){this.appendChild(a,true);jq(this.hcomp).append(a.getHtml());a.bind_();this.headers.push(a)},insertHeader_:function(a,e){var d=this.headers,b=d[a];if(!b){this.appendHeader_(e)}else{this.insertBefore(e,b,true);d.splice(a,0,e);var c=jq(e.getHtmlEpilogHalf());c.insertBefore(b.$n());jq(e.getHtmlPrologHalf()).insertBefore(c);e.bind_()}},create_:function(c,e,d,f,b,a){},removeChildFromStart_:function(a){if(this.hidehead){return}var b=this.headers;while(a--){if(!b.length){return}b.shift().detach()}},removeChildFromEnd_:function(a){if(this.hidehead){return}var b=this.headers;while(a--){if(!b.length){return}b.pop().detach()}},removeHeader_:function(b,c){var d,e=this.headers;if(b>e.length){return}var g=e.slice(b,b+c);var a=e.slice(b+c,e.length);e.length=b;e.push.apply(e,a);var f=g.pop();for(;f;f=g.pop()){f.detach()}},bind_:function(){this.$supers(zss.Panel,"bind_",arguments);var e=this.comp=this.$n();e.ctrl=this;zk(e).disableSelection();this.padcomp=this.$n("pad"),this.icomp=this.$n("real"),this.hcomp=this.icomp.firstChild,this.wpcomp=this.$n(this.type+"wp");if(this.block){this.bindFrozenCtrl_();var b=this.sheet;if(b.editorFocusMark){var c="";for(var d in b.editorFocusMark){var a=b.editorFocusMark[d];this.addEditorFocus(d,c)}}}},bindFrozenCtrl_:function(){},unbindFrozenCtrl_:function(){if(this.selArea){this.selArea.cleanup();this.selArea=null}if(this.selChgArea){this.selChgArea.cleanup();this.selChgArea=null}if(this.focusMark){this.focusMark.cleanup();this.focusMark=null}if(this.hlArea){this.hlArea.cleanup();this.hlArea=null}},unbind_:function(){if(this.headers){this.headers.splice(0,this.headers.length)}if(this.editorFocusMark){for(var b in this.editorFocusMark){var a=this.editorFocusMark[b];this._removeEditorFocusMark(a)}this.editorFocusMark=null}this.unbindFrozenCtrl_();this.comp=this.comp.ctrl=this.padcomp=this.wpcomp=this.icomp=this.hcomp=this.headers=this.block=this.sheet=null;this.$supers(zss.Panel,"unbind_",arguments)},getTypeAttr_:function(){},hasPad_:function(){return false},doTooltipOver_:zk.$void,doTooltipOut_:zk.$void,doClick_:zk.$void,doMouseDown_:function(a){this.sheet._doMousedown(a)},doMouseUp_:function(a){this.sheet._doMouseup(a)},doRightClick_:function(a){this.sheet._doMouserightclick(a)},doDoubleClick_:function(a){this.sheet._doMousedblclick(a)},doMouseOver_:function(a){var b=a.domTarget;if(b.getAttribute("zs.t")=="SBoun"){b.parentNode.ctrlref._processDrag(true,false)}if(b.getAttribute("zs.t")=="SBoun2"){b.parentNode.ctrlref._processDrag(true,true)}},doMouseOut_:function(a){var b=a.domTarget;if(b.getAttribute("zs.t")=="SBoun"){b.parentNode.ctrlref._processDrag(false,false)}if(b.getAttribute("zs.t")=="SBoun2"){b.parentNode.ctrlref._processDrag(false,true)}},redraw:function(a){var f=this.type,f=this.isCorner?"corner"+f:f,e=this.uuid;a.push('<div id="',e,'" class="zs',f," zsfz",f,'" zs.t="',this.getTypeAttr_(),'">',(this.hasPad_()?'<div id="'+e+'-pad" class="zs'+f+'pad"></div>':""),'<div id="',e,'-real" class="zs',f,'i"><div id="',e,'-head" class="zs',f,'head">');var d=this.headers,c=d.length;for(var b=0;b<c;b++){a.push(d[b].getHtml())}a.push("</div>");if(this.block){this.block.redraw(a);a.push('<div id="',e,'-select" class="zsselect" zs.t="SSelect">','<div class="zsselecti" zs.t="SSelInner"></div><div class="zsseldot" zs.t="SSelDot"></div></div>','<div id="',e,'-selchg" class="zsselchg" zs.t="SSelChg"><div class="zsselchgi"></div></div>','<div id="',e,'-focmark" class="zsfocmark" zs.t="SFocus"><div class="zsfocmarki"></div></div>','<div id="',e,'-highlight" class="zshighlight" zs.t="SHighlight"><div class="zshighlighti"></div></div>')}a.push("</div>");a.push('<div id="',e,"-",f,'wp" class="zswidgetpanel" zs.t="SWidgetpanel"></div>');a.push("</div>")},addEditorFocus:function(f,b){if(this.editorFocusMark&&this.editorFocusMark[f]){return}if(this.block){var c=this.sheet,d=this.$n("focmark"),a=d,e=a.cloneNode(true);e.id=e.id+"_"+f;e.style.borderWidth="3px";a.parentNode.appendChild(e);this.addEditorFocus_(f,b,e)}},addEditorFocus_:function(c,a,b){},removeEditorFocus:function(b){if(this.block){if(!this.editorFocusMark){return}var a=this.editorFocusMark[b];this._removeEditorFocusMark(a);this.editorFocusMark[b]=null}},_removeEditorFocusMark:function(a){if(a){a.comp.parentNode.removeChild(a.comp);a.cleanup()}},moveEditorFocus:function(e,c,a,d,b){if(this.block){if(!this.editorFocusMark||!this.editorFocusMark[e]){this.addEditorFocus(e,c)}this.editorFocusMark[e].relocate(d,b);this.editorFocusMark[e].showMark(a,c)}}});zss.LeftPanel=zk.$extends(zss.Panel,{widgetName:"LeftPanel",type:"left",initHeaders_:function(n,a,e,k,l){var b=[],c=k.rowHeaders,o=zss.Header.VER,d=l?n.lp.headers:null,f=0;for(var g=a;g<=e;g++){var m=new zss.Header(n,o,c[g],d?d[f++]:null);this.appendChild(m,true);b.push(m)}return b},create_:function(c,g,h,e,b,a){if(!a){this.createHeaders_(c,g,h)}var f=e>=0&&b>=0;if("jump"==c&&f){var d=this.block;this.block=new zss.CellBlockCtrl(this.sheet,g,e,h,b,this.getFrozenData_(),"left");d?d.replaceWidget(this.block):this.appendChild(this.block)}else{if(this.block&&f){this.block.create_(c,g,e,h,b,this.getFrozenData_())}}},initFrozenBlock_:function(d,g,f,e){var h=d.frozenCol;if(h>-1){var a=new zss.CellBlockCtrl(d,g,0,f,h,e,"left");this.appendChild(a,true);return a}return null},getHeaderData_:function(){if(this.isCorner){return this.sheet._wgt._cacheCtrl.getSelectedSheet().topFrozen.rowHeaders}else{return this.sheet._wgt._cacheCtrl.getSelectedSheet().rowHeaders}},getFrozenData_:function(){var b=this.sheet._wgt._cacheCtrl.getSelectedSheet(),c=b.leftFrozen;return c?c:b},getFrozenHeaderData_:function(){var a=this.getFrozenData_();return a?a.columnHeaders:null},getHeaderType_:function(){return zss.Header.VER},isInsert_:function(a){return"north"==a},bindFrozenCtrl_:function(){var c=this.sheet,e=this.$n("select"),d=e.nextSibling,a=d.nextSibling,b=a.nextSibling;this.selArea=new zss.SelAreaCtrlLeft(c,e,c.initparm.selrange.clone());this.selChgArea=new zss.SelChgCtrlLeft(c,d);this.focusMark=new zss.FocusMarkCtrlLeft(c,a,c.initparm.focus.clone());this.hlArea=new zss.HighlightLeft(c,b,c.initparm.hlrange.clone(),"inner")},addEditorFocus_:function(c,a,b){if(!this.editorFocusMark){this.editorFocusMark=new Object()}this.editorFocusMark[c]=new zss.FocusMarkCtrlLeft(this.sheet,b,new zss.Pos(0,0))},getTypeAttr_:function(){return"SLeftPanel"},hasPad_:function(){return true},removeChildFromStart_:function(a){if(this.block){this.block.removeRowsFromStart_(a)}this.$supers(zss.LeftPanel,"removeChildFromStart_",arguments)},removeChildFromEnd_:function(a){if(this.block){this.block.removeRowsFromEnd_(a)}this.$supers(zss.LeftPanel,"removeChildFromEnd_",arguments)},_updateHeight:function(a){jq(this.comp).css("height",jq.px0(a));this.height=a;this._updateBlockHeight()},_updateTopPos:function(a){jq(this.icomp).css("top",jq.px(a));jq(this.wpcomp).css("top",jq.px(a-this.sheet.topHeight));this.toppos=a;this._updateBlockHeight()},_updateTopPadding:function(a){if(this.toppad==a){return}jq(this.padcomp).css("height",jq.px0(a));this.toppad=a;if(this.selArea){this.selArea.relocate()}if(this.selChgArea){this.selChgArea.relocate()}if(this.focusMark){var b=this.sheet.getLastFocus();this.focusMark.relocate(b.row,b.column)}this._updateBlockHeight()},_updateBlockHeight:function(){if(!this.block){return}var a=this.height,e=this.toppos,d=this.toppad,c=this.block.range,f=c.top,b=c.bottom;a=this.sheet.custRowHeight.getDiffPixel(f,b);if(a<0){a=0}jq(this.block.comp).css("height",jq.px0(a))},updateSelectionCSS:function(e,d,a){var b=this.headers.length,c;while(b--){c=this.headers[b];if(c.index>=e&&c.index<=d){jq(c.comp)[a?"removeClass":"addClass"]("zsleft-sel")}}},updateSelectionCSS_:function(){var c=this.sheet,e=c._wgt,a=c.selArea.lastRange;if(!e.isSheetCSSReady()){return}if(a){var d=a.top,b=a.bottom;this.updateSelectionCSS(d,b,false||c.state==zss.SSheetCtrl.NOFOCUS)}},appendZSW:function(a,b){if(this.block){this.block.appendZSW(a,b)}},appendZSH:function(e,a){if(this.block){this.block.appendZSH(e,a)}if(this.isEmptyHeader()){return}var d=this.headers[0].index,b=d+this.headers.length-1;if(d>e||b<e){return}var c=e-d,f=this.headers[c];f.appendZSH(a)},insertNewColumn:function(a,b){if(this.block){this.block.insertNewColumn(a,b)}},insertNewRow:function(m,n,d){if(this.block){this.block.insertNewRow(m,n)}if(this.isEmptyHeader()){return}var l=this.headers[0].index,c=l+this.headers.length-1;if(m>(c+1)||m<l){return}var h=m-l,b,e=this.getHeaderData_(),k=zss.Header.VER;var j=this.sheet,g=j.selArea.lastRange;if(j.state!=zss.SSheetCtrl.NOFOCUS&&g){var l=g.top,c=g.bottom;if(m<=c&&(m+n-1)>=l){this.updateSelectionCSS(l,c,true)}}for(var f=0;f<n;f++){var a=m+f;b=new zss.Header(j,k,e[a]);this.insertHeader_(h+f,b)}d=d.slice(n,d.length);this.shiftHeaderInfo(h+n,m+n,d)},shiftHeaderInfo:function(c,f,a){var e=this.headers.length,b=0;for(var d=c;d<e;d++){if(!a[b]){zk.log("undefined header to assing>>"+(f+b),"always")}this.headers[d].resetInfo(f+b,a[b]);b++}},removeColumn:function(a,b){if(this.block){this.block.removeColumn(a,b)}},removeRow:function(f,d,b){if(this.block){this.block.removeRow(f,d)}if(this.isEmptyHeader()){return}var e=this.headers[0].index,a=e+this.headers.length-1;if(f>(a+1)||f<e){return}var c=f-e;if((f+d)>a){d=a-f+1}this.removeHeader_(c,d);this.shiftHeaderInfo(c,f,b)},_fixSize:function(){var d=this.sheet,g=d._wgt,f=d.leftWidth,e=f-1,a=d.frozenCol,c=g.getSelectorPrefix(),b=g.getSheetCSSId();if(a>-1){e=e+d.custColWidth.getStartPixel(a+1)}zcss.setRule(c+" .zsleft",["width"],[(a>-1?e-1:e)+"px"],true,b);zcss.setRule(c+" .zslefti",["width"],[e+"px"],true,b)}})})();
(function(){zss.ResizeableToolbar=zk.$extends(zul.wgt.Toolbar,{$init:function(a){this.$supers(zss.ResizeableToolbar,"$init",[]);this._wgt=a},bind_:function(){this.$supers(zss.ResizeableToolbar,"bind_",arguments);zWatch.listen({onSize:this})},unbind_:function(){zWatch.unlisten({onSize:this});this.$supers(zss.ResizeableToolbar,"unbind_",arguments)},onSize:function(){var f=this._hgh,g=jq(this.$n("cave")).height();if(!f||f!=g){var c=this.parent,b=c.getTabbox(),a=jq(this.$n()).zk,d=this._wgt.cave,e=g+a.sumStyles("tb",jq.paddings)+a.sumStyles("tb",jq.borders);c.setHeight(e+"px");b.clearCachedSize_();b.parent.clearCachedSize_();zWatch.fire("onFitSize",this._wgt,{reverse:true});this._wgt.clearCachedSize_();zFlex.onSize.apply(d);d.resize()}this._hgh=g}});zss.ToolbarTabpanel=zk.$extends(zul.tab.Tabpanel,{$init:function(b,a){this.$supers(zss.ToolbarTabpanel,"$init",[]);this._wgt=a;this._actions=b},createButtonsIfNotExist:function(){var d=this.toolbar;if(!d){d=this.toolbar=new zss.ResizeableToolbar(this._wgt);var f=new zss.ButtonBuilder(this._wgt,d).addAll(this._actions).build();for(var e=0,c=f.length;e<c;e++){var a=f[e];if(a){d.appendChild(a)}}this.appendChild(d);this.setDisabled(this._wgt.getActionDisabled())}},onShow:function(){this.createButtonsIfNotExist()},setDisabled:function(c){var a=this.toolbar;if(a&&c){var b=a.firstChild;for(;b;b=b.nextSibling){if(!b.setDisabled){continue}b.setDisabled(c)}}},getSclass:function(){return"zstbtabpanel"}});zss.ToolbarTabbox=zk.$extends(zul.tab.Tabbox,{$o:zk.$void,$init:function(h){this.$supers(zss.ToolbarTabbox,"$init",[]);this._wgt=h;this.setVflex("min");var b=new zul.tab.Tabs(),g=new zul.tab.Tab({label:msgzss.action.homePanel,sclass:"zstab-homePanel"}),f=new zul.tab.Tab({label:msgzss.action.insertPanel,onClick:this.proxy(this.onClickInsertTab),sclass:"zstab-insertPanel"}),d=new zul.tab.Tabpanels(),c=this.homePanel=new zss.ToolbarTabpanel(zss.Buttons.HOME_DEFAULT,h),e=this.insertPanel=new zss.ToolbarTabpanel(zss.Buttons.INSERT_DEFAULT,h);this.appendChild(b);this.appendChild(d);b.appendChild(g);b.appendChild(f);c.createButtonsIfNotExist();d.appendChild(c);d.appendChild(e);this.setSelectedTab(g);var a=new zul.wgt.Toolbar({ignoreFlexSize_:function(){return true}});a.appendChild(new zss.Toolbarbutton({$action:"closeBook",tooltiptext:msgzss.action.closeBook,image:zk.ajaxURI("/web/zss/img/gray-cross.png",{au:true}),onClick:function(){h.fireToolbarAction("closeBook")}}));this.appendChild(a)},onClickInsertTab:function(){this.insertPanel.createButtonsIfNotExist()},onClickFormulaTab:function(){this.formulaPanel.createButtonsIfNotExist()}});zss.Toolbar=zk.$extends(zul.layout.North,{$o:zk.$void,$init:function(a){this.$supers(zss.Toolbar,"$init",[]);this.setBorder(0);this._wgt=a;this.setVflex("min");this.appendChild(this.toolbarTabbox=new zss.ToolbarTabbox(a))},setDisabled:function(d){var b=this.toolbarTabbox,c=b.getTabpanels(),a=c.firstChild;for(;a;a=a.nextSibling){a.setDisabled(d)}},setFlexSize_:function(e,b){var e=this.$supers(zss.Toolbar,"setFlexSize_",arguments),d=this.$n("real").style,c=d.height,a=jq(this.$n("cave"));if(c&&a.height()!=parseInt(c)){a.height(c+"px")}return e}})})();
zss.TopPanel=zk.$extends(zss.Panel,{widgetName:"TopPanel",type:"top",$o:zk.$void,initHeaders_:function(n,a,d,g,k){var b=[],c=g.columnHeaders,o=zss.Header.HOR,m=k?n.tp.headers:null,e=0;for(var f=a;f<=d;f++){var l=new zss.Header(n,o,c[f],m?m[e++]:null);this.appendChild(l,true);b.push(l)}return b},create_:function(d,h,a,c,g,b){if(!b){this.createHeaders_(d,h,a)}var f=c>=0&&g>=0;if("jump"==d&&f){var e=this.block;this.block=new zss.CellBlockCtrl(this.sheet,c,h,g,a,this.getFrozenData_(),"top");e?e.replaceWidget(this.block):this.appendChild(this.block)}else{if(this.block&&f){this.block.create_(d,c,h,g,a,this.getFrozenData_())}}},initFrozenBlock_:function(c,d,g,f){var e=c.frozenRow;if(e>-1){var a=new zss.CellBlockCtrl(c,0,d,e,g,f,"top");this.appendChild(a);return a}return null},getHeaderData_:function(){if(this.isCorner){return this.sheet._wgt._cacheCtrl.getSelectedSheet().leftFrozen.columnHeaders}else{return this.sheet._wgt._cacheCtrl.getSelectedSheet().columnHeaders}},getFrozenData_:function(){var b=this.sheet._wgt._cacheCtrl.getSelectedSheet(),c=b.topFrozen;return c?c:b},getFrozenHeaderData_:function(){var a=this.getFrozenData_();return a?a.rowHeaders:null},getHeaderType_:function(){return zss.Header.HOR},isInsert_:function(a){return"west"==a},bindFrozenCtrl_:function(){var c=this.sheet,e=this.$n("select"),d=e.nextSibling,a=d.nextSibling,b=a.nextSibling;this.selArea=new zss.SelAreaCtrlTop(c,e,c.initparm.selrange.clone());this.selChgArea=new zss.SelChgCtrlTop(c,d);this.focusMark=new zss.FocusMarkCtrlTop(c,a,c.initparm.focus.clone());this.hlArea=new zss.HighlightTop(c,b,c.initparm.hlrange.clone(),"inner")},addEditorFocus_:function(c,a,b){if(!this.editorFocusMark){this.editorFocusMark=new Object()}this.editorFocusMark[c]=new zss.FocusMarkCtrlTop(this.sheet,b,new zss.Pos(0,0))},_getTopHeaderFontSize:function(){var b=this.$n("head"),a=b!=null?b.firstChild:null;if(a&&a.getAttribute("zs.t")=="STheader"){return jq(a).css("font-size")}return null},bind_:function(){this.$supers(zss.TopPanel,"bind_",arguments);var a=this.isCorner&&(zk.ie&&zk.ie<11)?this._getTopHeaderFontSize():null;if(a){this.fontSize=a}},unbind_:function(){this.$supers(zss.TopPanel,"unbind_",arguments);this.fontSize=null},getTypeAttr_:function(){return"STopPanel"},removeChildFromStart_:function(a){if(this.block){this.block.removeColumnsFromStart_(a)}this.$supers(zss.TopPanel,"removeChildFromStart_",arguments)},removeChildFromEnd_:function(a){if(this.block){this.block.removeColumnsFromEnd_(a)}this.$supers(zss.TopPanel,"removeChildFromEnd_",arguments)},_getCornerHeaderFontSize:function(){return this.fontSize},_updateWidth:function(a){jq(this.comp).css("width",jq.px0(a));this.width=a;this._updateBlockWidth()},_updateLeftPos:function(a){jq(this.icomp).css("left",jq.px(a));jq(this.wpcomp).css("left",jq.px(a-this.sheet.leftWidth));this.leftpos=a;this._updateBlockWidth()},_updateLeftPadding:function(a){a=a-this.sheet.leftWidth;jq(this.icomp).css("padding-left",jq.px0(a));this.leftpad=a;this._updateBlockWidth()},_updateBlockWidth:function(){if(!this.block){return}var c=this.width,f=this.leftpos,d=this.leftpad,a=this.block.range,e=a.left,b=a.right;c=this.sheet.custColWidth.getDiffPixel(e,b);if(c<0){c=0}jq(this.block.comp).css("width",jq.px0(c))},updateSelectionCSS:function(e,d,a){var b=this.headers.length,c;while(b--){c=this.headers[b];if(c.index>=e&&c.index<=d){jq(c.comp)[a?"removeClass":"addClass"]("zstop-sel")}}},appendZSW:function(b,d){if(this.block){this.block.appendZSW(b,d)}if(this.isEmptyHeader()){return}var e=this.headers[0].index,c=e+this.headers.length-1;if(e>b||c<b){return}var a=b-e,f=this.headers[a];f.appendZSW(d)},appendZSH:function(b,a){if(this.block){this.block.appendZSH(b,a)}},insertNewColumn:function(e,p,b){if(this.block){this.block.insertNewColumn(e,p)}if(this.isEmptyHeader()){return}var f=this.headers[0].index,n=f+this.headers.length-1;if(e>(n+1)||e<f){return}var j=e-f,a,d=this.getHeaderData_(),m=zss.Header.HOR,o=(zk.ie&&zk.ie<11)?this._getCornerHeaderFontSize():null;var k=this.sheet,h=k.selArea.lastRange;if(k.state!=zss.SSheetCtrl.NOFOCUS&&h){var f=h.left,n=h.right;if(e<=n&&(e+p-1)>=f){this.updateSelectionCSS(f,n,true)}}for(var g=0;g<p;g++){var l=e+g;a=new zss.Header(k,m,d[l]);this.insertHeader_(j+g,a)}b=b.slice(p,b.length);this.shiftHeaderInfo(j+p,e+p,b)},insertNewRow:function(b,a){if(this.block){this.block.insertNewRow(b,a)}},shiftHeaderInfo:function(d,a,b){var f=this.headers.length,c=0;for(var e=d;e<f;e++){if(!b[c]){zk.log("undefined header to assing>>"+(newrow+c),"always")}this.headers[e].resetInfo(a+c,b[c]);c++}},removeColumn:function(c,e,a){if(this.block){this.block.removeColumn(c,e)}if(this.isEmptyHeader()){return}var f=this.headers[0].index,d=f+this.headers.length-1;if(c>(d+1)||c<f){return}var b=c-f;if((c+e)>d){e=d-c+1}this.removeHeader_(b,e);this.shiftHeaderInfo(b,c,a)},removeRow:function(b,a){if(this.block){this.block.removeRow(b,a)}},updateSelectionCSS_:function(){var c=this.sheet,e=c._wgt,a=c.selArea.lastRange;if(!e.isSheetCSSReady()){return}if(a){var d=a.left,b=a.right;this.updateSelectionCSS(d,b,false||c.state==zss.SSheetCtrl.NOFOCUS)}},_fixSize:function(){var c=this.sheet,g=c._wgt,d=c.topHeight,f=d,e=c.frozenRow,b=g.getSelectorPrefix(),a=g.getSheetCSSId();if(e>-1){f=f+c.custRowHeight.getStartPixel(e+1)}zcss.setRule(b+" .zstop",["height"],[(e>-1?f-1:f)+"px"],true,a);zcss.setRule(b+" .zstopi",["height"],[f+"px"],true,a)}});
zss.Pos=zk.$extends(zk.Object,{row:-1,column:-1,$init:function(b,a){this.$supers("$init",arguments);this.row=b;this.column=a},toString:function(){return"row:"+this.row+", column:"+this.column},clone:function(){return new zss.Pos(this.row,this.column)}});
(function(){function a(b,c,d){b[1]=c;b[4]=d}zss.PositionHelper=zk.$extends(zk.Object,{$init:function(c,b){this.$supers("$init",arguments);this.size=c;this.custom=b},cleanup:function(){this.size=this.custom=null},updateDefaultSize:function(b){this.size=b},getIncUnhidden:function(c,d){var f=this.custom,g=f.length,b,h;for(var e=0;e<g&&c<=d;++e){b=f[e][0];if(c==b){h=f[e][3];if(!h){break}else{++c}}else{if(c<b){break}}}return c>d?-1:c},getDecUnhidden:function(c,d){var f=this.custom,g=f.length,b,h;for(var e=g-1;e>=0&&c>=d;--e){b=f[e][0];if(c==b){h=f[e][3];if(!h){break}else{--c}}else{if(c>b){break}}}return c<d?-1:c},getCellIndex:function(l){if(l<0){l=0}var g=0,e=0,h=0,b=0,c=this.custom,k=this.size,o=c.length,f=0,n,j;for(;f<o;f++){n=c[f][0];j=c[f][3]?0:c[f][1];e=e+(n-h)*k;if(e>l){b=l-g;var m=Math.floor(b/k),d=b-m*k;h=h+m;return[h,d]}e=e+j;if(e>l){var d=l-e+j;return[n,d]}g=e;h=n+1}b=l-g;var m=Math.floor(b/k),d=b-m*k;h=h+m;return[h,d]},getStartPixel:function(b){if(b<0){return 0}return this._getStartPixel0(b)[0]},_getStartPixel0:function(g,j,k){var e=j||0,f=k||0,b=this.custom,h=this.size,l=b.length;for(var c=e;c<l;c++){if(g<=b[c][0]){break}e++;f+=b[c][3]?0:b[c][1]}var d=f+(e>0?(b[e-1][0]+1-e):0)*h;f=f+(g-e)*h;return[f,e,d]},getDiffPixel:function(c,b){var d=this._getStartPixel0(c),e=this._getStartPixel0(b+1,d[1],d[2]);return e[0]-d[0]},getMetaIndex:function(b,e,g){var c=this.custom,h=this.size,k=c.length,j=e||0,d=g||k-1;while(j<=d){var f=Math.floor((d+j)/2),i=c[f][0];if(i==b){return f}else{if(i<b){j=f+1}else{d=f-1}}}return -f-1},shiftMeta:function(d,f){var c=this.custom,b=c.length;for(var e=0;e<b;e++){if(d<=c[e][0]){c[e][0]+=f}}},unshiftMeta:function(g,j){var f=this.custom,c=f.length,b=[],d=g+j,e;for(var h=0;h<c;h++){e=f[h][0];if(e>=g&&e<d){b.push(h)}else{if(e>=d){f[h][0]-=j}}}d=b.length;for(var h=d-1;h>=0;h--){this._remove(b[h])}},isDefaultSize:function(b){var e=this.size,d=this._getCustomizedSize(b),c=Math.abs(d-e);if(Math.abs(d-e)>1){return false}return true},_getCustomizedSize:function(c){var b=this.custom,d=b.length;while(d--){if(c==b[d][0]){return b[d][1]}}return this.size},getSize:function(c){var b=this.custom,f=this.size,e=b.length;for(var d=0;d<e;d++){if(c==b[d][0]){return b[d][1]}if(c<b[d][0]){return f}}return f},getMeta:function(c){var b=this.custom,f=this.size,e=b.length;for(var d=0;d<e;d++){if(c==b[d][0]){return b[d]}if(c<b[d][0]){return null}}return null},setCustomizedSize:function(j,m,c,g,b){var d=this.custom,k=this.size,l=0,h=d.length;if(h==0){this._insert(0,j,m,c,g,b);return}var f;while(l<h){f=l+Math.floor((h-l)/2);if(d[f][0]==j){d[f][2]=c;d[f][3]=g;a(d[f],m,b);return}else{if(d[f][0]>j){h=f-1}else{l=f+1}}if(h==l){if(h>=d.length||d[h][0]>j){this._insert(h,j,m,c,g,b)}else{if(d[h][0]==j){d[h][2]=c;d[h][3]=g;a(d[h],m,b)}else{this._insert(h+1,j,m,c,g,b)}}break}else{if(h<l){this._insert(l,j,m,c,g,b)}}}},removeCustomizedSize:function(c){var b=this.custom,f=0,g=b.length;if(g==0){return}var d;while(f<g){d=f+Math.floor((g-f)/2);if(b[d][0]==c){this._remove(d);return}else{if(b[d][0]>c){g=d-1}else{f=d+1}}if(g==f){if(g<b.length&&b[g][0]==c){this._remove(g)}break}else{if(g<f){break}}}},_remove:function(d){var c=this.custom;if(c.length==1){c.pop();return}if(d==0){c.shift()}else{if(d>=c.length-1){c.pop()}else{var b=c.slice(d+1);c.length=d;c.push.apply(c,b)}}},_insert:function(g,i,j,c,f,b){var d=this.custom,e=[i,j,c,f,b];if(d.length==0){d.push.apply(d,[e]);return}if(g==0){d.unshift(e)}else{if(g>d.length){d.push.apply(d,[e])}else{var h=d.slice(g,d.length);d.length=g;d.push.apply(d,[e]);d.push.apply(d,h)}}},isCustomSize:function(c){var b=this.getMeta(c);if(b==null){return false}else{return b[4]}},getDefaultSize:function(){return this.size},isHidden:function(c){var b=this.getMeta(c);if(b==null){return false}else{return b[3]}}})})();
zss.Range=zk.$extends(zk.Object,{left:-1,top:-1,right:-1,bottom:-1,width:-1,height:-1,$init:function(e,d,c,b,a){this.$supers("$init",arguments);this.left=e;this.top=d;if(a){this.width=c;this.height=b;this.right=this.left+this.width-1;this.bottom=this.top+this.height-1}else{this.right=c;this.bottom=b;this.width=this.right-this.left+1;this.height=this.bottom-this.top+1}},size:function(){var a=this.width*this.height;return a>=0?a:0},clone:function(){return new zss.Range(this.left,this.top,this.right,this.bottom)},toString:function(){return"left:"+this.left+",top:"+this.top+",right:"+this.right+",bottom:"+this.bottom},extendRight:function(a){this.right+=a;this.width+=a},extendLeft:function(a){this.left-=a;this.width+=a},extendBottom:function(a){this.bottom+=a;this.height+=a},extendTop:function(a){this.top-=a;this.height+=a},shiftTop:function(a){this.top-=a;this.bottom-=a},shiftLeft:function(a){this.left-=a;this.right-=a},shiftRight:function(a){this.left+=a;this.right+=a},shiftBottom:function(a){this.top+=a;this.bottom+=a}});
zss.Row=zk.$extends(zk.Widget,{widgetName:"Row",$o:zk.$void,$init:function(a,d,c,b){this.$supers(zss.Row,"$init",[]);this.sheet=a;this.block=d;this.r=c;this.cells=[];this.wrapedCells=[];this._updateCacheSrc(b)},_updateCacheSrc:function(a){this.src=a;this.zsh=a.getRowHeightId(this.r)},bind_:function(c,b,a){this.$supers(zss.Row,"bind_",arguments)},unbind_:function(){delete this.cells;this.r=this.zsh=null;this.$supers(zss.Row,"unbind_",arguments)},updateAutoHeightDirty:function(a,b){},processCellAutoHeight:function(a){},addAutoHeightCell:function(a){},removeAutoHeightCell:function(a){},appendCell:function(a,b){this.appendChild(a,b);this.cells.push(a)},insertCell:function(c,a,e){var b=this.cells,d=b[c];this.insertBefore(a,d,e);b.splice(c,0,a)},redraw:function(c){c.push(this.getHtmlPrologHalf());var b=this.cells,e=b.length;for(var d=0;d<e;d++){var a=b[d];a.redraw(c)}c.push(this.getHtmlEpilogHalf())},getHtmlPrologHalf:function(){return'<div id="'+this.uuid+'" class="'+this.getZclass()+'" zs.t="SRow">'},getHtmlEpilogHalf:function(){return"</div>"},getZclass:function(){var a="zsrow",b=this.zsh;return b?a+" zsh"+b:"zsrow"},getCell:function(a){var c=this.cells.length,b=0;for(b=0;b<c;b++){if(this.cells[b].c==a){return this.cells[b]}}return null},getCellAt:function(a){return this.cells[a]},removeLeftCell:function(c){var b=this.cells;var a=b.length;while(c--){if(!b.length){return}b.shift().detach()}},removeRightCell:function(b){var a=this.cells;while(b--){if(!a.length){return}a.pop().detach()}},appendZSW:function(b,c){var a=this.cells[b];a.appendZSW(c)},appendZSH:function(a){if(a){this.zsh=a;jq(this.$n()).addClass("zsh"+a);var c=this.cells.length;for(var b=0;b<c;b++){this.cells[b].appendZSH(a)}}},insertNewCell:function(j,n){var k=this.sheet,d,m=this.cells,e;if(j>m.length){return}var h=j==0?null:m[j-1];e=j==0?m[0].c:(h.c+1);var f=this.block,b=this.src,a=this.r;for(var g=0;g<n;g++){var l=e+g;d=new zss.Cell(k,f,a,l,b);d._justCopied=true;if(h){if(h.overflowed){d.overlapBy=h}else{if(h.overlapBy){d.overlapBy=h.overlapBy}}}this.insertCell(j+g,d)}this.shiftCellInfo(j+n,e+n)},shiftCellInfo:function(d,a){var c=this.cells,f=c.length,b=0;for(var e=d;e<f;e++){c[e].resetColumnIndex(a+(b++))}},resetRowIndex:function(c){this.r=c;var a=this.cells,b=a.length;while(b--){a[b].resetRowIndex(c)}},removeCell:function(e,f){var g,d=this.cells,c;if(e>d.length){return}if(e==d.length){c=d[e-1].c+1}else{c=d[e].c}var h=d.slice(e,e+f),b=d.slice(e+f,d.length);d.length=e;d.push.apply(d,b);var a=h.pop();for(;a;a=h.pop()){a.detach()}this.shiftCellInfo(e,c)},getHeight:function(){return this.sheet.custRowHeight._getCustomizedSize(this.r)},doMouseMove_:function(g){var d=this.sheet,f=g.pageX,e=g.pageY,c=zss.SSheetCtrl._calCellPos(d,f,e),j=c[0],a=c[1],h=d.getCell(j,a);if(h!=null&&h.merr){h=d.getCell(h.mert,h.merl)}if(h){var i=jq(h.comp).find("a");if(i.length>0){var b=i[0];if(zkS.isOverlapByPoint(b,f,e)){this._cursor="pointer";jq(this.$n()).css("cursor","pointer");return}}}if(this._cursor){this._cursor=null;jq(this.$n()).css("cursor","")}}},{copyCells:function(g,l){var k=g.cells;size=k.length,r=l.r,html="";for(var f=0;f<size;f++){var b=k[f],h=b.c,a=b.src,d=b.block,j=b.sheet,e=new zss.Cell(j,d,r,h,a);e._justCopied=true;html+=e.getHtml();l.appendCell(e)}return html}});
zss.ScrollInfo=zk.$extends(zss.Info,{$init:function(a,b){this.$supers("$init",arguments);this.horizontal=true;this.x=this.y=-1},showInfoOnDir:function(a){if(!this.enabled){return}var h=this.sheet,b=h.sp,i=h.custColWidth,l=h.custRowHeight,g=b.comp,k=g.scrollLeft,e=g.scrollTop,f=g.clientWidth,d=g.clientHeight;if(a){var c=k;if(h.frozenCol>-1){c+=i.getStartPixel(h.frozenCol+1)}c=i.getCellIndex(c)[0]+1;this.setInfoText("Column : "+c);jq(this.comp).css("text-align","left")}else{var j=e;if(h.frozenRow>-1){j+=l.getStartPixel(h.frozenRow+1)}j=l.getCellIndex(j)[0]+1;this.setInfoText("Row : "+j);jq(this.comp).css("text-align","right")}this.showInfo(true)},pinXY:function(a,c,b){this.x=a;this.y=c;this.horizontal=b;this.enabled=true;if(this.visible){this.pinLocation(b);this.showInfo(b)}},pinLocation:function(b){if(!this.enabled){return}var e=this.sheet,g=e.sp.comp;if(this.horizontal!=b){this.x=-1;this.y=-1}this.horizontal=b;var f=g.clientWidth,a=g.clientHeight;if(!this.visible){jq(this.comp).css({left:"-90000px",display:"inline"})}var d,c;if(b){d=(this.x==-1)?e.leftWidth+1:this.x;c=a-zk(this.comp).offsetHeight()}else{d=f-zk(this.comp).offsetWidth();c=(this.y==-1)?e.topHeight+1:this.y}jq(this.comp).css({left:jq.px(d),top:jq.px(c)})}});
zss.ScrollPanel=zk.$extends(zk.Object,{dir:"south",$init:function(b){this.$supers("$init",[]);var d=b._wgt,e=b.$n("sp");this.id=e.id;this.sheet=b;this.comp=e;this.currentTop=this.currentLeft=this.timerCount=0;this.leftWidth=28;this.topHeight=20;this.timerRunning=false;this.lastMove="";e.ctrl=this;var c=this.sheet.dp.comp,a=this.comp;this.minLeft=this._getMaxScrollLeft(c,a);this.minTop=this._getMaxScrollTop(c,a);this.minHeight=c.offsetHeight;this.minWidth=c.offsetWidth;d.domListen_(e,"onScroll",this.proxy(this._doScrolling)).domListen_(e,"onMouseDown",this.proxy(this._doMousedown));jq(b.cp.$n()).on("mousewheel",this.proxy(this._doMouseWheel));jq(b.lp.$n()).on("mousewheel",this.proxy(this._doMouseWheel));jq(b.tp.$n()).on("mousewheel",this.proxy(this._doMouseWheel))},getDirection:function(){return this.dir},reset:function(b,a){var c=this.comp;c.scrollLeft=a;c.scrollTop=b;this.currentTop=b;this.currentLeft=a},_resetIE9ScrollPosition:function(){if(this._visFlg){return}var d=this.comp,a=d.scrollLeft,b=d.scrollTop,c=this.currentLeft,e=this.currentTop;if(a==0&&b==0&&(a!=c||b!=e)){this.reset(e,c)}},cleanup:function(){var a=this.sheet,b=a._wgt,c=a.$n("sp");jq(a.tp.$n()).off("mousewheel",this.proxy(this._doMouseWheel));jq(a.lp.$n()).off("mousewheel",this.proxy(this._doMouseWheel));jq(a.cp.$n()).off("mousewheel",this.proxy(this._doMouseWheel));b.domUnlisten_(c,"onScroll",this.proxy(this._doScrolling)).domUnlisten_(c,"onMouseDown",this.proxy(this._doMousedown));this.invalid=true;if(this.comp){this.comp.ctrl=null}this.comp=this.sheet=null},_doMouseWheel:function(c){var d=c.originalEvent,b=d.wheelDeltaX,a=d.wheelDeltaY?d.wheelDeltaY/120:d.wheelDelta?d.wheelDelta/120:-d.detail/3,e=jq(this.comp);if(a&&a!=0){e.scrollTop(e.scrollTop()-(a*100))}if(b&&b!=0){e.scrollLeft(e.scrollLeft()-(b/120*100))}},_doMousedown:function(a){var d=this.comp;if(a.domTarget!=d){return}var e=zkS._getMouseData(a,d);var b=(e[1]<zk(d).offsetHeight()&&e[1]>d.clientHeight);clickInVer=(e[0]<zk(d).offsetWidth()&&e[0]>d.clientWidth);if((b&&clickInVer)||(!b&&!clickInVer)){return}var c=this.sheet.sinfo;c.pinXY(e[0],e[1],b)},_doScrolling:function(h){if(!h&&zk.ie&&zk.ie==9){this._resetIE9ScrollPosition()}var e=this.sheet,g=e.dp.comp,k=this.comp,i=k.scrollLeft,j=k.scrollTop,f=(i!=this.currentLeft),c=(j!=this.currentTop),d=i<this.currentLeft,b=j<this.currentTop;if(f){this.dir=d?"west":"east"}else{this.dir=b?"north":"south"}this.currentLeft=i;this.currentTop=j;e.tp._updateLeftPos(-this.currentLeft);e.lp._updateTopPos(-this.currentTop);if(this._visFlg){this._visFlg=false}else{var a=e.sinfo;if(f){if(!a.visible||!a.horizontal){a.pinLocation(true)}a.showInfoOnDir(true)}if(c){if(!a.visible||a.horizontal){a.pinLocation(false)}a.showInfoOnDir(false)}if(c||f){this._trackScrolling(c)}}},_trackScrolling:function(a){if(a){this._fireOnVScroll()}else{this._fireOnHScroll()}},_vscrollTimeoutId:null,_hscrollTimeoutId:null,_fireOnVScroll:function(b){clearTimeout(this._vscrollTimeoutId);var a=this;this._vscrollTimeoutId=setTimeout(function(){a._doVScroll()},b>=0?b:60)},_fireOnHScroll:function(b){clearTimeout(this._hscrollTimeoutId);var a=this;this._vscrollTimeoutId=setTimeout(function(){a._doHScroll()},b>=0?b:60)},_doVScroll:function(){this._doScroll(true)},_doHScroll:function(){this._doScroll(false)},_doScroll:function(a){this.sheet.activeBlock.doScroll(a)},_getMaxScrollLeft:function(b,a){return(b.offsetWidth-a.offsetWidth)+zss.Spreadsheet.scrollWidth},_getMaxScrollTop:function(b,a){return(b.offsetHeight-a.offsetHeight)+zss.Spreadsheet.scrollWidth},scrollToVisible:function(m,f,a,D,j){if(D==undefined||D==null){D=zss.SCROLL_DIR.BOTH}if(!j){j=zss.SCROLL_POS.NONE}var e=this.sheet;if(a){m=a.r;f=a.c}var C=this._getCellLocation(e,m,f);var b=this.comp,n=e.activeBlock,p=C.width,z=C.height,y=C.left+e.leftWidth,s=C.top+e.topHeight,B=b.scrollLeft,x=b.scrollTop,v=b.clientWidth,E=b.clientHeight,g=e.topHeight,d=e.leftWidth,u=B,o=x,k=false,r=e.frozenRow,A=e.frozenCol,q=0,c=0;var i=moveonfc=false;if(zkS.t(f)&&A>-1){if(A<f){c=e.custColWidth.getStartPixel(A+1)}else{moveonfc=true}}if(zkS.t(m)&&r>-1){if(r<m){q=e.custRowHeight.getStartPixel(r+1)}else{i=true}}if(zkS.t(f)&&!moveonfc){if(((v-d)<(p-c))||(y-d)<(B+c)){u=y-d-c;k=true}else{if(B+v<y+p){u=y+p-v;k=true}}}if(zkS.t(m)&&!i){if(((E-g<z-q||s-g<x+q)&&j!=zss.SCROLL_POS.BOTTOM)||j==zss.SCROLL_POS.TOP){o=s-g-q;k=true}else{if(x+E<s+z||j==zss.SCROLL_POS.BOTTOM){o=s+z-E;k=true}}}if(k){this._visFlg=true;switch(D){case zss.SCROLL_DIR.HORIZONTAL:b.scrollLeft=u;break;case zss.SCROLL_DIR.VERTICAL:b.scrollTop=o;break;case zss.SCROLL_DIR.BOTH:b.scrollLeft=u;b.scrollTop=o;break}}},_getCellLocation:function(a,d,b){var c={};c.left=a.custColWidth.getStartPixel(b);c.width=a.custColWidth.getSize(b);c.top=a.custRowHeight.getStartPixel(d);c.height=a.custRowHeight.getSize(d);return c}});
(function(){zss.SheetMenupopup=zk.$extends(zul.menu.Menupopup,{$o:zk.$void,$init:function(f){this.$supers(zss.SheetMenupopup,"$init",[]);this._wgt=f;var e=this.sheet=f.sheetCtrl,b=this.deleteSheet=new zss.Menuitem({$action:"deleteSheet",label:msgzss.action.deleteSheet},f),c=this.renameSheet=new zss.Menuitem({$action:"renameSheet",label:msgzss.action.renameSheet},f),h=this.copySheet=new zss.Menuitem({$action:"copySheet",label:msgzss.action.copySheet},f),a=this.protectSheet=new zss.Menuitem({$action:"protectSheet",label:msgzss.action.protectSheet,checkmark:true},f),d=this.hide=new zss.Menuitem({$action:"hideSheet",label:msgzss.action.hideSheet},f),g=this.unhide=new zss.Menuitem({$action:"unhideSheet",label:msgzss.action.unhideSheet},f);moveLeft=this.moveLeft=new zss.Menuitem({$action:"moveSheetLeft",label:msgzss.action.moveSheetLeft},f),moveRight=this.moveRight=new zss.Menuitem({$action:"moveSheetRight",label:msgzss.action.moveSheetRight},f);this.appendChild(b);this.appendChild(c);this.appendChild(h);this.appendChild(a);this.appendChild(new zul.menu.Menuseparator());this.appendChild(d);this.appendChild(g);this.appendChild(moveLeft);this.appendChild(moveRight)},doMouseDown_:function(){},doMouseUp_:function(){},onClickDeleteSheet:function(){this._wgt.fireSheetAction("delete")},onClickRenameSheet:function(){var a=this._wgt._sheetBar;if(a){var b=a.getSheetSelector().getSelectedTab();if(b){b.startEditing()}}},onClickCopySheet:function(){this._wgt.fireSheetAction("copy")},onClickProtectSheet:function(){this._wgt.fireSheetAction("protect")},onClickHideSheet:function(){this._wgt.fireSheetAction("hide")},onClickUnhideSheet:function(){this._wgt.fireSheetAction("unhide")},onClickMoveSheetLeft:function(){this._wgt.fireSheetAction("moveLeft")},onClickMoveSheetRight:function(){this._wgt.fireSheetAction("moveRight")},setProtectSheetCheckmark:function(a){this.protectSheet.setChecked(a)},bind_:function(){this.$supers(zss.SheetMenupopup,"bind_",arguments);this.moveRight.listen({onClick:this.proxy(this.onClickMoveSheetRight)});this.moveLeft.listen({onClick:this.proxy(this.onClickMoveSheetLeft)});this.unhide.listen({onClick:this.proxy(this.onClickUnhideSheet)});this.hide.listen({onClick:this.proxy(this.onClickHideSheet)});this.protectSheet.listen({onClick:this.proxy(this.onClickProtectSheet)});this.copySheet.listen({onClick:this.proxy(this.onClickCopySheet)});this.renameSheet.listen({onClick:this.proxy(this.onClickRenameSheet)});this.deleteSheet.listen({onClick:this.proxy(this.onClickDeleteSheet)})},unbind_:function(){this.deleteSheet.unlisten({onClick:this.proxy(this.onClickDeleteSheet)});this.renameSheet.unlisten({onClick:this.proxy(this.onClickRenameSheet)});this.copySheet.unlisten({onClick:this.proxy(this.onClickCopySheet)});this.protectSheet.unlisten({onClick:this.proxy(this.onClickProtectSheet)});this.hide.unlisten({onClick:this.proxy(this.onClickHideSheet)});this.unhide.unlisten({onClick:this.proxy(this.onClickUnhideSheet)});this.moveLeft.unlisten({onClick:this.proxy(this.onClickMoveSheetLeft)});this.moveRight.unlisten({onClick:this.proxy(this.onClickMoveSheetRight)});this.$supers(zss.SheetMenupopup,"unbind_",arguments)},open:function(c,d,g,a){var k=this._wgt,b=c.getLabel(),j=k.getSheetLabels(),f=0,h=j.length;for(;f<h;f++){var e=j[f];if(e.name==b){break}}if(this.moveLeft.isDisabled){this.moveLeft.setDisabled(f==0||this._moveLeftDisabled)}this.moveRight.setDisabled(f==h-1||this._moveRightDisabled);this.protectSheet.setChecked(k.isProtect());g="before_start";this.$supers(zss.SheetMenupopup,"open",arguments)},setDisabled:function(b){var a=this.firstChild;for(;a;a=a.nextSibling){if(!a.setDisabled){continue}a.setDisabled(b)}this._moveLeftDisabled=this.moveLeft.isDisabled();this._moveRightDisabled=this.moveRight.isDisabled()}});zss.SheetTab=zk.$extends(zul.tab.Tab,{$o:zk.$void,$init:function(a,b){this.$supers(zss.SheetTab,"$init",[a]);this._wgt=b;this._selector=a.selector;this.appendChild(this.textbox=new zul.inp.Textbox({visible:false,onBlur:this.proxy(this.onStopEditing),onOK:this.proxy(this.onStopEditing),onCancel:this.proxy(this.onCancelEditing),afterKeyDown_:this.proxy(function(c){if(!this.editing||c.keyCode===27||c.keyCode===13){this.$supers(zul.inp.InputWidget,"afterKeyDown_",arguments)}}),sclass:"zssheettab-rename-textbox"}))},$define:{sheetUuid:null},domContent_:function(){var b=this.uuid,c=this.getSclass(),a='<div id="'+b+'-text" class="'+c+'-text">'+this.getLabel()+"</div>"+this.textbox.redrawHTML_();return a},onStopEditing:function(){if(!this.editing){return}var a=this.getLabel(),c=this.textbox.getText();if(a!=c){var b=this._wgt;this._wgt.fireSheetAction("rename",{name:c})}this.stopEditing()},onCancelEditing:function(){this.textbox.setText(this.getLabel());this.stopEditing()},stopEditing:function(){this.textbox.setVisible(false);this.editing=false;jq(this.getTextNode()).css("display","block")},startEditing:function(){var a=this.textbox,b=this.getLabel();jq(this.getTextNode()).css({display:"none"});a.setValue(b);a.setVisible(true);a.focus_();a.select(0,b.length);this.editing=true},isEditing:function(){return !!this.editing},doDoubleClick_:function(){if(this._selector.renameDisabled){return}var b=this.isEditing();if(b){var a=this.textbox;a.select(0,a.getText().length)}else{this.startEditing()}},doClick_:function(d){var b=this._wgt.sheetCtrl;if(b.asyncCheckFormula){b.asyncCheckFormula=false;var a=this,c=d;b.sheetTabFn=function(){a.$supers(zss.SheetTab,"doClick_",[c])};return}this.$supers(zss.SheetTab,"doClick_",arguments)},doMouseDown_:function(b){var a=this._wgt.sheetCtrl;if(a.editingFormulaInfo){a.isSwitchingSheet=true}},doMouseUp_:function(){},doKeyDown_:function(){},afterKeyDown_:function(){},doKeyUp_:function(){},doKeyPress_:function(){},getTextNode:function(){return this.$n("text")},getSclass:function(){return"zssheettab"}});zss.Tabs=zk.$extends(zul.tab.Tabs,{_scrollcheck:function(g,i){this._shallCheck=false;var e=this.getTabbox();if(!this.desktop||(e&&(!e.isRealVisible()||!e.isTabscroll()))){return}var s=this.$n(),x=e.$n();if(!s||!x){return}if(e.isVertical()){var f=s.offsetHeight,k=s.scrollTop,c=0;jq(this.$n("cave")).children().each(function(){c+=this.offsetHeight});if(e._scrolling){var v=this._getArrowSize();if(s.offsetHeight<=v){return}var q=e.getSelectedTab(),p=i?i.$n():(q?q.$n():null),o=p?p.offsetTop:0,b=p?p.offsetHeight:0;if(c<=f+v){e._scrolling=false;this._showbutton(false);s.style.height=jq.px0(x.offsetHeight-2);s.scrollTop=0}switch(g){case"end":var u=c-f-k;this._doScroll(u>=0?"down":"up",u>=0?u:Math.abs(u));break;case"init":case"vsel":if(o<k){this._doScroll("up",k-o)}else{if(o+b>k+f){this._doScroll("down",o+b-k-f)}}break}}else{if(c-f>0){e._scrolling=true;this._showbutton(true);var v=this._getArrowSize(),t=x.offsetHeight-v;s.style.height=t>0?t+"px":"";if(g=="end"){var u=c-f-k+2;if(u>=0){this._doScroll(this.uuid,"down",u)}}}else{this._showbutton(false)}}}else{if(!e.inAccordionMold()){var j=this.$n("cave"),q=e.getSelectedTab(),p=i?i.$n():(q?q.$n():null),r=p?p.offsetLeft:0,m=p?p.offsetWidth:0,h=s.offsetWidth,w=s.scrollLeft,a=0,l=e.toolbar,n=0;jq(j).children().each(function(){a+=this.offsetWidth});if(l&&l.desktop){n=l.$n().offsetWidth}if(e._scrolling){var v=this._getArrowSize();e.$n("right").style.right=n+"px";if(s.offsetWidth<=v){return}if(a<=h+v){e._scrolling=false;this._showbutton(false);s.style.width=jq.px0(x.offsetWidth-n);s.scrollLeft=0}switch(g){case"end":var u=a-h-w;this._doScroll(u>=0?"right":"left",u>=0?u:Math.abs(u));break;case"init":case"sel":if(r==w){break}if(r<w){this._doScroll("left",w-r)}else{if(r+m>w+h){this._doScroll("right",r+m-w-h)}}break}}else{if(a-h>0){e._scrolling=true;this._showbutton(true);var j=this.$n("cave"),v=this._getArrowSize(),t=x.offsetWidth-n-v;j.style.width="33554430px";s.style.width=t>0?t+"px":"";e.$n("right").style.right=n+"px";if(g=="sel"){if(r<w){this._doScroll("left",w-r)}else{if(r+m>w+h){this._doScroll("right",r+m-w-h)}}}}else{this._showbutton(false)}}}}}});zss.SheetSelector=zk.$extends(zul.tab.Tabbox,{$o:zk.$void,$init:function(b,a){this.$supers(zss.SheetSelector,"$init",[]);this._wgt=b;this._menu=a;this.setSheetLabels(b.getSheetLabels());this._orient="bottom"},setSheetLabels:function(f){var k=this._wgt,j=this.tabs,a=this._menu,g=null,c=this.proxy(this._onSelectSheet);if(j){j.detach()}j=new zss.Tabs();for(var e=0,h=f.length;e<h;e++){var d=f[e],b=new zss.SheetTab({label:d.name,sheetUuid:d.id,onClick:c,onRightClick:c,selector:this},k);b.setContext(a);j.appendChild(b);if(d.sel){g=b}}this.appendChild(j);if(g){this.setSelectedTab(g)}},_detachSheetWidget:function(){var a=this._wgt,b=a.sheetCtrl.$n("wp");jq(b).children().each(function(d,e){var c=zk.Widget.$(e.id);if(c){c.detach()}})},_onSelectSheet:function(a){var b=a.target;if(!b.$instanceof(zss.SheetTab)){return}this.doSelectSheet(b.getSheetUuid(),this._wgt.sheetCtrl.isSwitchingSheet)},doSelectSheet:function(d,k){var r=this._wgt,i=r.sheetCtrl,n=r.getSheetId();if(d!=n){var y=false,m=-1,j=-1,h=-1,v=-1,C=-1,o=-1,q=-1,c=-1,x=-1,f=-1,t=-1,s=-1;this._detachSheetWidget();r._invalidatedSheetId=true;this.setDisabled(true);var p=r._cacheCtrl;if(p){p.snap(n);if(p.isCached(d)){var l=p.getSnapshot(d),b=l.getVisibleRange(),w=l.getFocus(),z=l.getSelection(),g=l.getHighlight(),u=l.getDataValidations(),B=l.getAutoFilter(),e=l.getTableFilters(),t=l.getRowFreeze(),s=l.getColumnFreeze(),a=l.getMaxRows(),A=l.getMaxColumns();r.setMaxRows(a);r.setMaxColumns(A);if(w&&!k){m=w.row;j=w.column}if(z&&!k){h=z.left;v=z.top;C=z.right;o=z.bottom}if(g&&!k){q=g.left;c=g.top;x=g.right;f=g.bottom}if(u&&!k){r.setDataValidations(u)}else{if(r.setDataValidations){r.setDataValidations(null)}}if(B&&!k){r.setAutoFilter(B)}else{if(r.setAutoFilter){r.setAutoFilter(null)}}if(e&&!k){r.setTableFilters(e)}else{if(r.setTableFilters){r.setTableFilters(null)}}r.setSheetId(d,false,b);if(m>=0&&j>=0&&!k){i.moveCellFocus(m,j);i.moveCellSelection(h,v,C,o)}y=true}}i.hideCellFocus();i.hideCellSelection();if(i.isHighlightVisible()){i.hideHighlight(true)}r.fire("onSheetSelect",{sheetId:d,cache:y,row:m,col:j,left:h,top:v,right:C,bottom:o,hleft:q,htop:c,hright:x,hbottom:f,frow:t,fcol:s},{toServer:true})}},setSelectedSheet:function(c){this.setProtectSheetCheckmark(this._wgt.isProtect());var b=this.tabs.firstChild;for(;b;b=b.nextSibling){if(c==b.getSheetUuid()){var a=this._wgt.sheetCtrl;if(a&&!a.isSwitchingSheet){a.dp._doFocusLost()}this.setSelectedTab(b);break}}if(!!this._disd){this.setDisabled(false)}},setProtectSheetCheckmark:function(a){this._menu.setProtectSheetCheckmark(a)},setDisabled:function(a){var e=false;if(jq.isArray(a)){for(var c=0,d=a.length;c<d;c++){if(a[c]==="renameSheet"){e=true;break}}this.renameDisabled=e}},redrawHTML_:function(){return this.$supers(zss.SheetSelector,"redrawHTML_",arguments)},getSclass:function(){return"zssheetselector"}});zss.TabPopup=zk.$extends(zul.wgt.Popup,{$init:function(){this.$supers(zss.TabPopup,"$init",arguments);this.setSclass("zstab-popup")},doMouseDown_:function(){},doMouseUp_:function(){},bind_:function(){this.$supers(zss.TabPopup,"bind_",arguments);this.domListen_(this.$n("cave"),"onClick","_doClick")},unbind_:function(){this.domUnlisten_(this.$n("cave"),"onClick","_doClick");this.$supers(zss.TabPopup,"unbind_",arguments)},_doClick:function(b){var c=b.target;if(c.widgetName=="TabOption"){var a=this.parent.parent;a.sheetSelector.doSelectSheet(c.getSheetId(),a._wgt.sheetCtrl.isSwitchingSheet);this.close()}},afterOpenAnima_:function(c,d,a,b){this.$supers(zss.TabPopup,"afterOpenAnima_",arguments);if(b&&b.tabOption){b.tabOption.scrollIntoView()}}});zss.TabOption=zk.$extends(zul.wgt.Button,{$init:function(){this.$supers(zss.TabOption,"$init",arguments);this.setZclass("zstab-option")},widgetName:"TabOption",$define:{sheetId:function(){}}});zss.SheetpanelCave=zk.$extends(zk.Widget,{$o:zk.$void,$init:function(i){this.$supers(zss.SheetpanelCave,"$init",[]);this.setHflex(true);this.setHeight("100%");this._wgt=i;var c=this.menu=new zss.SheetMenupopup(i),e=this.addSheetButton=new zss.Toolbarbutton({$action:"addSheet",tooltiptext:msgzss.action.addSheet,image:zk.ajaxURI("/web/zss/img/plus.png",{au:true}),onClick:this.proxy(this.onClickAddSheet)}),f=this.sheetMenuButton=new zss.Toolbarbutton({$action:"showSheets",tooltiptext:msgzss.action.showSheets,image:zk.ajaxURI("/web/zss/img/ui-menu.png",{au:true}),onClick:function(){var q=i.getSheetLabels(),j=[],n=i.getSheetId(),m;b.clear();for(var l=0,k;k=q[l++];){var o=k.id,p=new zss.TabOption({label:k.name,sheetId:k.id,sclass:k.id===n?"zstab-option-select":""});b.appendChild(p);if(k.id===n){m=p}}b.open(this,null,"before_start",{tabOption:m})}}),h=this.hlayout=new zul.box.Hlayout({spacing:0}),d=this.sheetSelector=new zss.SheetSelector(i,c),b=new zss.TabPopup(),a=this.addColButton=new zss.Toolbarbutton({$action:"addCol",tooltiptext:msgzss.action.addCol,image:zk.ajaxURI("/web/zss/img/control-stop-000-small.png",{au:true}),onClick:this.proxy(this.onClickAddCol)}),g=this.addRowButton=new zss.Toolbarbutton({$action:"addRow",tooltiptext:msgzss.action.addRow,image:zk.ajaxURI("/web/zss/img/control-stop-270-small.png",{au:true}),onClick:this.proxy(this.onClickAddRow)});h.appendChild(e);h.appendChild(f);h.appendChild(d);h.appendChild(a);h.appendChild(g);h.appendChild(b);this.appendChild(h);this.appendChild(c)},setFlexSize_:function(e,a){var d=this.$supers(zss.SheetpanelCave,"setFlexSize_",arguments),b=e.width,c=26*2+18*2;if(b>c){this.sheetSelector.setWidth((b-c)+"px")}},onClickAddSheet:function(){this._wgt.fireSheetAction("add")},onClickAddRow:function(){this._wgt.fireRowAction("add")},onClickAddCol:function(){this._wgt.fireColAction("add")},bind_:function(){this.addColButton.setVisible(this._wgt._addColumn);this.addRowButton.setVisible(this._wgt._addRow);this.$supers(zss.SheetpanelCave,"bind_",arguments)},redraw:function(a){var b=this.uuid;a.push("<div",this.domAttrs_(),">");var c=this.firstChild;for(;c;c=c.nextSibling){c.redraw(a)}a.push("</div>")},setDisabled:function(a){this.addSheetButton.setDisabled(a);this.sheetSelector.setDisabled(a);this.menu.setDisabled(a)}});zss.Sheetbar=zk.$extends(zul.layout.South,{$o:zk.$void,$init:function(a){this.$supers(zss.Sheetbar,"$init",[]);this._wgt=a;this.setBorder(0);this.setSize("28px");this.appendChild(this.cave=new zss.SheetpanelCave(a));this.setDisabled(a.getActionDisabled())},getSheetSelector:function(){return this.cave.sheetSelector},redrawHTML_:function(){return this.$supers(zss.Sheetbar,"redrawHTML_",arguments)},getSclass:function(){return"zssheetbar"},setDisabled:function(a){this.cave.setDisabled(a)}})})();
(function(){_skey=[32,106,107,109,110,111,186,187,188,189,190,191,192,220,221,222,219];_opearKey=[42,43,45,47,61];function i(n){if((n!=13&&n!=9&&n<32)||n>127){return null}return String.fromCharCode(n)}function f(n){var p=((n>=48&&n<=57)||(n>=65&&n<=90)||(n>=96&&n<=105)),o=_skey.length;if(p){return true}while(o--){if(n==_skey[o]){return true}}if(zk.opera&&_opearKey.$contains(n)){return true}if(zk.gecko&&(n==61||n==59||n==173)){return true}return false}function l(o,n){var p=false;if(n.indexOf("l")!=-1){p|=((o.which)&&(o.which==1))}if(!p&&n.indexOf("r")!=-1){p|=((o.which)&&(o.which==3))}if(!p&&n.indexOf("m")!=-1){p|=((o.which)&&(o.which==2))}return p}function h(n){return(n.which)&&(n.which==1)}function m(n){return(n.which)&&(n.which==2)}function k(n){return(n.which)&&(n.which==3)}function e(r,q,n){for(var o in n){var p=n[o];r[p]=q[p]}}function d(n){var o=n._wgt;if(o.isSheetCSSReady()){n.activeBlock.setVisible(true);n._doSSInitLater();if(!n.isSwitchingSheet){o.focus()}else{n.inlineEditor.updateInfo();n.isSwitchingSheet=null}}else{setTimeout(function(){d(n)},1)}}function j(p){var q=[];if(p){p=p.split(",");var o=p.length;for(var n=0;n<o;n=n+5){q.push([zk.parseInt(p[n]),zk.parseInt(p[n+1]),zk.parseInt(p[n+2]),"true"==p[n+3],"true"==p[n+4]])}}return q}function g(s){var t=[];if(s&&s!=""){s=s.split(";");var p=s.length,q;for(var o=0;o<p;o++){q=s[o].split(",");var n=new zss.Range(zk.parseInt(q[0]),zk.parseInt(q[1]),zk.parseInt(q[2]),zk.parseInt(q[3]));n.id=zk.parseInt(q[4]);t.push(n)}}return t}function c(q){var p=[];for(var o=0,n=q.length;o<n;o++){p[o]=q[o].t}return p}function a(o,n){if(!o||o.length==0){return false}return b(o,n,0,o.length-1)}function b(r,q,p,n){if(n<p){return false}var o=Math.floor((p+n)/2);if(r[o].start>q){return b(r,q,p,o-1)}else{if(r[o].end<q){return b(r,q,o+1,n)}else{return true}}}zss.SSheetCtrl=zk.$extends(zk.Widget,{$o:zk.$void,editingFormulaInfo:null,lineHeight:"normal",$init:function(n){this.$supers(zss.SSheetCtrl,"$init",[]);this._wgt=n;this.setHflex(true);this.setVflex(true);this.pageKeySize=100;this._initiated=false;this._clienttxt="";this._initLaterQ=[];this._initLaterQ.urgent=0;this.state=zss.SSheetCtrl.NOFOCUS;this.topHeightDt=this.leftWidthDt=this.rowHeightDt=this.colWidthDt=this.lineHeightDt=this.cellPadDt=false;this.config=new zss.Configuration()},doSheetSelected:function(n){if(this.bindLevel<0){return}var A=this._wgt,t=this,y=A._cacheCtrl,G=this.dp,K=this.sp,q=this.tp,z=this.lp,u=y.getSnapshot(A.getSheetId());if(u){e(A,u,["_displayGridlines","_rowFreeze","_columnFreeze","_rowHeight","_columnWidth","_protect"]);var P=u.getDataPanelSize(),D=u.getScrollPanelPos();G.reset(P.width,P.height);K.reset(D.scrollTop,D.scrollLeft);z._updateTopPos(u.getLeftPanelPos());q._updateLeftPos(u.getTopPanelPos())}else{K.reset(0,0);z._updateTopPos(0);q._updateLeftPos(0)}this.serverSheetId=A.getSheetId();this.topHeight=A.getTopPanelHeight();this.leftWidth=A.getLeftPanelWidth();this.rowHeight=A.getRowHeight();this.colWidth=A.getColumnWidth();this.frozenRow=A.getRowFreeze();this.frozenCol=A.getColumnFreeze();this.custColWidth=new zss.PositionHelper(this.colWidth,u?u.getCustColWidth():j(A.getCsc()));this.custColWidth.ids=new zss.Id(u?u.getCustColLastId():0,2);this.custRowHeight=new zss.PositionHelper(this.rowHeight,u?u.getCustRowHeight():j(A.getCsr()));this.custRowHeight.ids=new zss.Id(u?u.getCustRowLastId():0,2);this.mergeMatrix=new zss.MergeMatrix(u?u.getMergeMatrix():g(A.getMergeRange()),this);var R=A._cacheCtrl.getSelectedSheet(),M=A.isSheetCSSReady();n=n||zss.SSheetCtrl._getVisibleRange(this);if(R){var x=this.activeBlock,O=this.tp,E=this.lp,I=this.cp,B=R.rows,p=R.rect,Q=n.top,r=n.bottom,F=n.left,C=n.right,w=A._rowHeadHidden,o=A._columnHeadHidden,H=Q>0?this.mergeMatrix.getTopRow(Q):0,J=F>0?this.mergeMatrix.getLeftCol(F):0;if(r>p.bottom){r=p.bottom}if(C>p.right){C=p.right}var N=new zss.MainBlockCtrl(t,H,J,r,C,R);var v=new zss.TopPanel(t,w,J,C,(R.topFrozen?R.topFrozen:R));var L=new zss.LeftPanel(t,o,H,r,(R.leftFrozen?R.leftFrozen:R));if(!M){N.setVisible(false)}if(O){O.replaceWidget(this.tp=v)}else{this.appendChild(this.tp=v,true)}if(E){E.replaceWidget(this.lp=L)}else{this.appendChild(this.lp=L,true)}var S=new zss.CornerPanel(t,w,o,F,Q,C,r,R);if(I){I.replaceWidget(this.cp=S)}else{this.appendChild(this.cp=S,true)}if(x){N.replaceHTML(x.$n(),this.desktop,null,true);this.activeBlock=N}else{this.appendChild(this.activeBlock=N,true)}this.fireProtectSheet(A.isProtect());this.fireDisplayGridlines(A.isDisplayGridlines());G._fixSize(this.activeBlock);this._fixSize()}if(!M){this.addSSInitLater(function(){t._resize()})}else{this._resize()}d(this)},restorePos_:function(n){if(!n){return}if(this.bindLevel<0){return}var x=this._wgt,u=this,r=x._cacheCtrl,p=this.dp,o=this.sp,v=this.tp,q=this.lp;var t=n.getDataPanelSize(),w=n.getScrollPanelPos();p.reset(t.width,t.height);o.reset(w.scrollTop,w.scrollLeft);q._updateTopPos(n.getLeftPanelPos());v._updateLeftPos(n.getTopPanelPos())},afterParentChanged_:function(){var A=this,w=this._wgt;this.sheetid=w.uuid;this.serverSheetId=w.getSheetId();var q=w.getRowHeight(),F=w.getColumnWidth();this.maxCols=w.getMaxColumns();this.maxRows=w.getMaxRows();this.topHeight=w.getTopPanelHeight();this.leftWidth=w.getLeftPanelWidth();this.cellPad=w.getCellPadding();this.rowHeight=w.getRowHeight();this.colWidth=w.getColumnWidth();var z=this.initparm={},u=w.getFocusRect();u=u.split(",");z.focus=new zss.Pos(zk.parseInt(u[1]),zk.parseInt(u[0]));var D=w.getSelectionRect();D=D.split(",");z.selrange=new zss.Range(zk.parseInt(D[0]),zk.parseInt(D[1]),zk.parseInt(D[2]),zk.parseInt(D[3]));var p=w.getHighLightRect();if(p){p=p.split(",");z.hlrange=new zss.Range(zk.parseInt(p[0]),zk.parseInt(p[1]),zk.parseInt(p[2]),zk.parseInt(p[3]));this.addSSInitLater(function(){var G=A.initparm.hlrange;A.hlArea.show=true;A.moveHighlight(G.left,G.top,G.right,G.bottom)})}else{z.hlrange=new zss.Range(-1,-1,-1,-1)}this.custColWidth=new zss.PositionHelper(this.colWidth,j(w.getCsc()));this.custColWidth.ids=new zss.Id(0,2);this.custRowHeight=new zss.PositionHelper(this.rowHeight,j(w.getCsr()));this.custRowHeight.ids=new zss.Id(0,2);this.mergeMatrix=new zss.MergeMatrix(g(w.getMergeRange()),this);this.frozenRow=w.getRowFreeze();this.frozenCol=w.getColumnFreeze();var s=this,v=w._cacheCtrl,B=v.getSelectedSheet();this.appendChild(this.inlineEditor=new zss.Editbox(s));if(B){var x=B.rows,o=B.rect,E=o.top,C=o.left,y=o.right,r=o.bottom,t=w._rowHeadHidden,n=w._columnHeadHidden;r=E+20;y=C+20;if(r>o.bottom){r=o.bottom}if(y>o.right){y=o.right}this.appendChild(this.activeBlock=new zss.MainBlockCtrl(s,E,C,r,y,B),true);this.appendChild(this.tp=new zss.TopPanel(s,t,C,y,(B.topFrozen?B.topFrozen:B)),true);this.appendChild(this.lp=new zss.LeftPanel(s,n,E,r,(B.leftFrozen?B.leftFrozen:B)),true);this.appendChild(this.cp=new zss.CornerPanel(s,t,n,C,E,y,r,B),true)}this.innerClicking=0},setFlexSize_:function(p,n){var o=this.$supers(zss.SSheetCtrl,"setFlexSize_",arguments);if(!this._initiated){zss.Spreadsheet.initLaterAfterCssReady(this)}this._resize();return o},isWatchable_:function(o,q,n){if("onSize"==o){return !!this.$n()}else{return this.$supers(zss.SSheetCtrl,"isWatchable_",arguments)}},bind_:function(r,p,o){this.$supers(zss.SSheetCtrl,"bind_",arguments);delete this._wrapRange;zss.SSheetCtrl._initInnerComp(this,this._wgt._autoFilter?this._wgt._autoFilter.range.top:null);this.listen({onContentsChanged:this,onRowHeightChanged:this});var q=this.comp=this.$n();q.ctrl=this},unbind_:function(){this.unlisten({onContentsChanged:this,onRowHeightChanged:this});this.animateHighlight(false);this.invalid=true;if(this.comp){this.comp.ctrl=null}this.comp=this.busycmp=this.maskcmp=this.spcmp=this.topcmp=this.leftcmp=this.sinfocmp=this.infocmp=this.focusmarkcmp=this.selareacmp=this.selchgcmp=this.hlcmp=this.wpcmp=null;if(this.dragging){this.dragging.cleanup();this.dragging=null}this.sp.cleanup();this.dp.cleanup();this.sinfo.cleanup();this.info.cleanup();this.focusMark.cleanup();this.selArea.cleanup();this.selChgArea.cleanup();this.hlArea.cleanup();this.sp=this.dp=this.tp=this.lp=this.cp=this.sinfo=this.info=this.inlineEditor=this.focusMark=this.selArea=this.selChgArea=this.hlArea=null;this.custTHSize=this.custLHSize=this._initLaterQ=this._lastmdelm=this._lastmdstr=null;this.$supers(zss.SSheetCtrl,"unbind_",arguments)},triggerRotateColumn_:function(u,n,q){var o=this._rotateRange;if(!o){o=this._rotateRange={}}var t=o.col;t?o.col=Math.max(t,n):o.col=n;if(u){var s=o.tRow,p=o.bRow;s?o.tRow=Math.min(s,u):o.tRow=u;p?o.bRow=Math.max(p,u):o.bRow=u}if(q){this.fireProcessRotate_()}},fireProcessRotate_:function(){var n=this._rotateRange;if(n!=undefined){this.fire("onProcessRotate",{col:n.col,tRow:n.tRow,bRow:n.bRow});delete this._rotateRange}},triggerOverflowColumn_:function(u,n,q){var o=this._overflowRange;if(!o){o=this._overflowRange={}}var t=o.col;t?o.col=Math.max(t,n):o.col=n;if(u){var s=o.tRow,p=o.bRow;s?o.tRow=Math.min(s,u):o.tRow=u;p?o.bRow=Math.max(p,u):o.bRow=u}if(q){this.fireProcessOverflow_()}},triggerWrap:function(p,o){var n=this._wrapRange=this._wrapRange||{};typeof n.tRow=="undefined"?n.tRow=p:n.tRow=Math.min(n.tRow,p);typeof n.bRow=="undefined"?n.bRow=p:n.bRow=Math.max(n.bRow,p);if(o){this.fireProcessWrap_()}},fireProcessOverflow_:function(){var n=this._overflowRange;if(n!=undefined){this.fire("onProcessOverflow",{col:n.col,tRow:n.tRow,bRow:n.bRow});delete this._overflowRange}},fireProcessWrap_:function(){if(this._wgt.isSheetCSSReady()){var o=this._wrapRange;if(o!=undefined){this.fire("onProcessWrap",{tRow:o.tRow,bRow:o.bRow});delete this._wrapRange}}else{var n=this;setTimeout(function(){n.fireProcessWrap_()},25)}},fireProcessAutoHeight_:function(){},fireProtectSheet:function(n){this.fire("onProtectSheet",{protect:n})},fireDisplayGridlines:function(n){this.fire("onDisplayGridlines",{show:n})},triggerSelection:function(v,o,s,t){var n=this._selectionRange;if(!n){n=this._selectionRange={}}var u=n.tRow,q=n.lCol,p=n.bRow,w=n.rCol;u?n.tRow=Math.min(v,u):n.tRow=v;q?n.lCol=Math.min(o,q):n.lCol=o;p?n.bRow=Math.max(s,p):n.bRow=s;w?n.rCol=Math.max(t,w):n.rCol=t},onContentsChanged:function(n){this.fireProcessOverflow_();this.fireProcessAutoHeight_();var o=this._selectionRange;if(o){this.deferFireCellSelection(o.lCol,o.tRow,o.rCol,o.bRow);this._selectionRange=null}},onRowHeightChanged:function(){var n=this.hlArea;if(n.show){n.relocate()}},_addEditorFocus:function(q,o){var n=this.focusmarkcmp,p=n.cloneNode(true);p.id=p.id+"_"+q;p.style.borderWidth="3px";n.parentNode.appendChild(p);if(!this.editorFocusMark){this.editorFocusMark=new Object()}this.editorFocusMark[q]=new zss.FocusMarkCtrl(this,p,new zss.Pos(0,0));if(this.tp){this.tp.addEditorFocus(q,o)}if(this.lp){this.lp.addEditorFocus(q,o)}if(this.cp){this.cp.addEditorFocus(q,o)}},removeEditorFocus:function(o){if(!this.editorFocusMark){return}var n=this.editorFocusMark[o];if(n){n.comp.parentNode.removeChild(n.comp);n.cleanup()}this.editorFocusMark[o]=null;if(this.tp){this.tp.removeEditorFocus(o)}if(this.lp){this.lp.removeEditorFocus(o)}if(this.cp){this.cp.removeEditorFocus(o)}},moveEditorFocus:function(r,p,n,q,o){if(!this.editorFocusMark||!this.editorFocusMark[r]){this._addEditorFocus(r,p)}this.editorFocusMark[r].relocate(q,o);this.editorFocusMark[r].showMark(n,p);if(this.tp){this.tp.moveEditorFocus(r,p,n,q,o)}if(this.lp){this.lp.moveEditorFocus(r,p,n,q,o)}if(this.cp){this.cp.moveEditorFocus(r,p,n,q,o)}},_resize:function(){if(this.invalid){return}this._fixSize();if(!this.activeBlock.loadForVisible()){this.showMask(false)}},isDragging:function(){return this.dragging?true:false},stopDragging:function(){if(this.dragging){this.dragging.cleanup();this.dragging=null}},setDragging:function(n){this.dragging=n},isAsync:function(){return(this.state&1==1)},addSSInitLater:function(r,q,p,o,n){this._initLaterQ.push([r,q,p,o,n])},insertSSInitLater:function(r,q,p,o,n){this._initLaterQ.unshift([r,q,p,o,n]);this._initLaterQ.urgent++},_doSSInitLater:function(){if(this.invalid){return}var p=this,o=p._initLaterQ;if(o.length==0){return}var n=o.urgent,r,q=0;while((r=o.shift())){r[0](r[1],r[2],r[3],r[4]);if(q>n&&q>=25){setTimeout(function(){p._doSSInitLater()},1);break}q++}o.urgent=0},_cmdCellUpdate:function(r,C){var w=C.type,A=C.r,o=C.c,y=C.val,p=C.server;switch(w){case"udtext":this._updateText(C);break;case"udcell":var B=this._wgt,t=C,v=this._wgt._cacheCtrl,x=v.getSheetBy(r),u=v.getSelectedSheet(),s=this.getLastSelection();if(!u&&!x){v.setSelectedSheet(t);this.update_(t,true);B._triggerContentsChanged=true;this.sendSyncblock(true)}else{if(x){x.update(t);if(x.id==u.id){this.update_(t);B._triggerContentsChanged=true}}}if(s){this.fire("onCellUpdate",s)}break;case"startedit":var n=C.et,q=this.dp;this._skipInsertCellRef=true;if("inlineEditing"==n){if(!q._moveFocus(A,o,true,true)){break}}this._skipInsertCellRef=false;q._startEditing(y,p,n);break;case"stopedit":this.dp._stopEditing();break;case"canceledit":var z=this.getCell(A,o);if(z){z._setText(z.text)}this.dp.cancelEditing(C.et);break;case"retryedit":var z=this.getCell(A,o);if(z){z._setText(z.text)}this.dp.retryEditing(y,A,o);break}},_cmdBlockUpdate:function(w,o,x,n,s,t){switch(w){case"neighbor":this.activeBlock.loadForVisible();if(zk.ie&&zk.ie<11){var q=this.dp.comp,p=this.lp.comp;jq(q).css("display","none");jq(p).css("display","none");zk(q).redoCSS();zk(p).redoCSS();jq(q).css("display","");jq(p).css("display","")}break;case"jump":var u=this.activeBlock,z=this._wgt,r=z._cacheCtrl.getSelectedSheet(),v=new zss.Range(n,x,t,s);u.replaceWidget(this.activeBlock=new zss.MainBlockCtrl(this,x,n,s,t,r));this.dp._fixSize(this.activeBlock);this.activeBlock.loadForVisible(v);break;case"error":break}this.showMask(false);var y=this;setTimeout(function(){y._doSSInitLater()},0)},_cmdInsertRC:function(x){if("colfreeze" in x){this._wgt.setColumnFreeze(x.colfreeze)}if("rowfreeze" in x){this._wgt.setRowFreeze(x.rowfreeze)}if(x.type=="column"){var p=x.col;var w=x.size;var o=x.hs;var q=this._wgt._cacheCtrl.getSelectedSheet();q.insertNewColumn(p,w,o);this._insertNewColumn(p,w,c(o.hs));this._removeColumn(this.maxCols,w);this.custColWidth.shiftMeta(p,w);this.dp.updateWidth(this.colWidth*w);this.maxCols=x.maxcol;var s=this.frozenCol=x.colfreeze;if(s>-1){this.lp._fixSize();this.cp._fixSize()}var r=this.activeBlock;if(p<r.range.left){r.reloadBlock("east")}else{this.triggerOverflowColumn_(null,p)}}else{if(x.type=="row"){var v=x.row;var w=x.size;var o=x.hs;var q=this._wgt._cacheCtrl.getSelectedSheet();q.insertNewRow(v,w,o);this._insertNewRow(v,w,c(o.hs));this._removeRow(this.maxRows,w);this.custRowHeight.shiftMeta(v,w);this.dp.updateHeight(this.rowHeight*w);this.maxRows=x.maxrow;var t=this.frozenRow=x.rowfreeze;if(t>-1){this.tp._fixSize();this.cp._fixSize()}var r=this.activeBlock;if(v<r.range.top){r.reloadBlock("south")}}}this.dp._fixSize(this.activeBlock);this._fixSize();this.sendSyncblock();var n=this.getLastSelection();if(n){this.moveCellSelection(n.left,n.top,n.right,n.bottom)}var u=this;setTimeout(function(){var y=u.hlArea;if(y.show){y.relocate()}u._doSSInitLater()},0)},_cmdRemoveRC:function(C,u){if("colfreeze" in C){this._wgt.setColumnFreeze(C.colfreeze)}if("rowfreeze" in C){this._wgt.setRowFreeze(C.rowfreeze)}var y=true;if(C.type=="column"){var o=C.col,B=C.size,n=C.hs,p=this._wgt._cacheCtrl.getSelectedSheet();p.removeColumns(o,B,n);this._removeColumn(o,B,c(n.hs));var r=this.dp,x=this.custColWidth.getStartPixel(o);x=this.custColWidth.getStartPixel(o+B)-x;r.updateWidth(-x);if(u){this.custColWidth.unshiftMeta(o,B)}this.maxCols=C.maxcol;this.frozenCol=C.colfreeze;this.lp._fixSize();this.cp._fixSize();var q=this.activeBlock;if(o<q.range.left){q.reloadBlock("east");y=false}else{this.triggerOverflowColumn_(null,o)}this._syncColFocusAndSelection(o)}else{if(C.type=="row"){var A=C.row,B=C.size,n=C.hs,p=this._wgt._cacheCtrl.getSelectedSheet();p.removeRows(A,B,n);this._removeRow(A,B,c(n.hs));var r=this.dp,t=this.custRowHeight.getStartPixel(A);t=this.custRowHeight.getStartPixel(A+B)-t;r.updateHeight(-t);if(u){this.custRowHeight.unshiftMeta(A,B)}this.maxRows=C.maxrow;this.frozenRow=C.rowfreeze;this.tp._fixSize();this.cp._fixSize();var q=this.activeBlock;if(A<q.range.top){q.reloadBlock("south");y=false}this._syncRowFocusAndSelection(A)}}r._fixSize(this.activeBlock);this._fixSize();this.sendSyncblock();if(y){this.activeBlock.loadForVisible()}var v=this.getLastFocus(),s;if(v.row>=this.maxRows){v.row=this.maxRows-1;s=true}if(v.column>=this.maxCols){v.column=this.maxCols-1;s=true}if(s){r.moveFocus(v.row,v.column,true,true)}var z=this;setTimeout(function(){var w=z.hlArea;if(w.show){w.relocate()}z._doSSInitLater()},0)},_cmdMaxcolumn:function(p){if(p==this.maxCols){return}var n,t,o,u;var x=p-this.maxCols;var s=x>0;var v=this.custColWidth.getStartPixel(this.maxCols);v=this.custColWidth.getStartPixel(p)-v;var q=this.dp;q.updateWidth(v);this.maxCols=p;q._fixSize(this.activeBlock);this._fixSize();if(s){this.activeBlock.loadForVisible()}else{o=this.getLastFocus();if(o&&(o.column>p-1)){this.moveCellFocus(o.row,p-1)}u=this.getLastSelection();if(u&&(u.right>p-1)){this.moveCellSelection(p-1,o.row,p-1,o.row,true);u=this.getLastSelection();if(this.selType){this._sendOnCellSelection(this.selType,u.left,u.top,u.right,u.bottom)}}this._removeColumn(p,-x)}},_cmdMaxrow:function(q){if(q==this.maxRows){return}var n,u,o,v;var w=q-this.maxRows;var t=w>0;var s=this.custRowHeight.getStartPixel(this.maxRows);s=this.custRowHeight.getStartPixel(q)-s;var p=this.dp;p.updateHeight(s);this.maxRows=q;p._fixSize(this.activeBlock);this._fixSize();if(t){this.activeBlock.loadForVisible()}else{o=this.getLastFocus();if(o&&(o.row>q-1)){this.moveCellFocus(q-1,o.column)}v=this.getLastSelection();if(v&&(v.bottom>q-1)){this.moveCellSelection(o.column,q-1,o.column,q-1,true);v=this.getLastSelection();if(this.selType){this._sendOnCellSelection(this.selType,v.left,v.top,v.right,v.bottom)}}this._removeRow(q,-w)}},_cmdMerge:function(n){var o=n.type;if(o=="remove"){this._removeMergeRange(n)}else{if(o=="add"){this._addMergeRange(n)}else{if(o=="sync"){this._syncMergeRange(n)}}}},_cmdSelection:function(n){var q=n.type,s=n.left,r=n.top,p=n.right,o=n.bottom;if(q=="move"){this._doCellSelection(s,r,p,o)}},_doCellSelection:function(r,q,p,o){this.moveCellSelection(r,q,p,o,true);var n=this.getLastSelection();if(n.left!=r||n.right!=p||n.top!=q||n.bottom!=o){this.selType=zss.SEL.CELL;this._sendOnCellSelection(this.selType,n.left,n.top,n.right,n.bottom)}},_cmdCellFocus:function(n){var p=n.type,q=n.row,o=n.column;if(p=="move"){this.moveCellFocus(q,o);var r=this.getLastFocus();if(r.row!=q||r.column!=o){this._sendOnCellFocus(r.row,r.column)}}},_cmdRetriveFocus:function(n){var p=n.type,q=n.row,o=n.column;if(p=="moveto"){this.dp.moveFocus(q,o,true,true,true)}else{if(p=="retrive"){this.dp._gainFocus(true,true)}}},_cmdSize:function(n){var o=n.type;if(o=="column"){this._setColumnWidth(n.column,n.width,false,true,n.hidden,n.id,true)}else{if(o=="row"){this._setRowHeight(n.row,n.height,false,true,n.hidden,n.id,n.custom)}}},_cmdHighlight:function(n){var o=n.type;if(o=="hide"){this.hideHighlight(true)}else{if(o=="show"){this.moveHighlight(n.left,n.top,n.right,n.bottom)}}},_cmdGridlines:function(n){this.setDisplayGridlines(n)},_shiftMouseSelection:function(w,y,p,x){if(zkS.isEvtKey(w,"s")&&h(w)){var o=this.getLastFocus(),r=o.row,t=o.column,q=p<t?p:t,v=p<t?t:p,u=y<r?y:r,n=y<r?r:y;this.moveCellSelection(q,u,v,n,true);var s=this.getLastSelection();this.selType=x;this._sendOnCellSelection(x,s.left,s.top,s.right,s.bottom);return true}return false},_doMousedown:function(M){this._wgt._checkContext();this.innerClicking++;var q=this;setTimeout(function(){if(q.innerClicking>0){q.innerClicking--}},0);var w=M.domTarget;if(zkS.parentByZSType(w,"SMask")){return}if(this.state==zss.SSheetCtrl.NOFOCUS){this._nfdown=true;this.dp._gainFocus(true);return}else{this._nfdown=false}if(!l(M,"lr")){return}this._lastmdelm=w;this._lastmdstr="";var E,v,s,J,H;if((E=zkS.parentByZSType(w,"SCell"))){var O=zk(E).revisedOffset();J=M.pageX;H=M.pageY;var C=zss.SSheetCtrl._calCellPos(q,J,H,false);v=C[0];s=C[1];var n=this.getCell(v,s);if(n!=null&&n.merr){v=n.mert;s=n.merl}n=this.getCell(v,s);if(!n||!n.isSelectable()){return}if(this._shiftMouseSelection(M,v,s,zss.SEL.CELL)){return}q.dp.moveFocus(v,s,false,true,false,true);this._lastmdstr="c";var x=this.getLastSelection();this.selType=zss.SEL.CELL;this.stopDragging();this.setDragging(new zss.SelDrag(q,this.selType,x.top,x.left,h(M)?"l":"r",x.right));if(h(M)&&this.selArea){this.selArea._startHyperlink(w);if(zk.ff&&w.tagName.toLowerCase()=="a"){M.stop()}}}else{if((E=zkS.parentByZSType(w,"SRow"))){var O=zk(E).revisedOffset();J=M.pageX;H=M.pageY;var C=zss.SSheetCtrl._calCellPos(q,J,H,false);v=C[0];s=C[1];var n=this.getCell(v,s);if(n&&n.merr){v=n.mert;s=n.merl;w=n.comp;this._lastmdelm=w}n=this.getCell(v,s);if(!n||!n.isSelectable()){return}if(this._shiftMouseSelection(M,v,s,zss.SEL.CELL)){return}q.dp.moveFocus(v,s,false,true,false,true);this._lastmdstr="c";var x=this.getLastSelection();this.selType=zss.SEL.CELL;this.stopDragging();this.setDragging(new zss.SelDrag(q,this.selType,x.top,x.left,h(M)?"l":"r",x.right));if(h(M)&&this.selArea){this.selArea._startHyperlink(w)}}else{if((E=zkS.parentByZSType(w,"SSelDot",1))!=null){if(h(M)){if(!this.selType){this.selType=zss.SEL.CELL}this.stopDragging();this.setDragging(new zss.SelChgDrag(q,this.selType,zss.SELDRAG.RESIZE))}}else{if((E=zkS.parentByZSType(w,["SSelInner","SFocus","SHighlight"],1))!=null){J=M.pageX;H=M.pageY;var C=zss.SSheetCtrl._calCellPos(q,J,H,false);v=C[0];s=C[1];var n=this.getCell(v,s);if(n!=null&&n.merr){v=n.mert;s=n.merl}if(this._shiftMouseSelection(M,v,s,zss.SEL.CELL)){return}this._lastmdstr="c";var N=false,z=this.getBtn?this.getBtn(v,s):null;if(h(M)&&z){var t=C[2],r=C[3],R=z.imgleft+z.imgwidth,y=z.imgtop+z.imgheight;N=(t>=z.imgleft&&t<R&&r>=z.imgtop&&r<y)}if(N){this._doBtndown(M,z.btntype,z.$n(),z)}else{if(h(M)||E.getAttribute("zs.t")=="SHighlight"){q.dp.moveFocus(v,s,false,true,false,true);var x=this.getLastSelection();this.selType=zss.SEL.CELL;this.stopDragging();this.setDragging(new zss.SelDrag(q,this.selType,x.top,x.left,h(M)?"l":"r",x.right));if(this.selArea){this.selArea._startHyperlink()}}}}else{if((E=zkS.parentByZSType(w,["SSelect"],1))!=null){J=M.pageX;H=M.pageY;var C=zss.SSheetCtrl._calCellPos(q,J,H,false);v=C[0];s=C[1];var n=this.getCell(v,s);if(n!=null&&n.merr){v=n.mert;s=n.merl}if(this._shiftMouseSelection(M,v,s,zss.SEL.CELL)){return}this._lastmdstr="c";if(h(M)){I=q.selArea.lastRange;if(v>I.bottom){v=I.bottom}else{if(v<I.top){v=I.top}}if(s>I.right){s=I.right}else{if(s<I.left){s=I.left}}if(!this.selType){this.selType=zss.SEL.CELL}this.stopDragging();this.setDragging(new zss.SelChgDrag(q,this.selType,zss.SELDRAG.MOVE,v,s));if(this.selArea){this.selArea._startHyperlink()}}}else{if((E=zkS.parentByZSType(w,"SLheader"))!=null||(E=zkS.parentByZSType(w,"STheader"))!=null){var o=(E.getAttribute("zs.t")=="SLheader")?zss.Header.VER:zss.Header.HOR,v,s,L,x=this.selArea.lastRange,P=M.target,A=this._wgt;this._lastmdstr="h";if(o==zss.Header.HOR){v=-1;s=P.index;if(!this.isHeaderSelectable(s,o)){return}if(s>=x.left&&s<=x.right&&x.top==0&&x.bottom==this.maxRows-1){L=true}}else{v=P.index;s=-1;if(!this.isHeaderSelectable(v,o)){return}if(v>=x.top&&v<=x.bottom&&x.left==0&&x.right==this.maxCols-1){L=true}}if(h(M)||!L){var I=zss.SSheetCtrl._getVisibleRange(this),u;if(v==-1){if(zkS.isEvtKey(M,"s")&&h(M)){var D=this.getLastFocus(),B=D.column;q.moveColumnSelection(s,B);var x=this.getLastSelection();this.selType=zss.SEL.COL;this._sendOnCellSelection(this.selType,x.left,x.top,x.right,x.bottom);return}var G=q.frozenRow;q.dp.moveFocus((G>-1?0:I.top),s,true,true,false,true);q.moveColumnSelection(s);u=zss.SEL.COL}else{if(zkS.isEvtKey(M,"s")&&h(M)){var D=this.getLastFocus(),F=D.row;q.moveRowSelection(v,F);var x=this.getLastSelection();this.selType=zss.SEL.ROW;this._sendOnCellSelection(this.selType,x.left,x.top,x.right,x.bottom);return}var Q=q.frozenCol;q.dp.moveFocus(v,(Q>-1?0:I.left),true,true,false,true);q.moveRowSelection(v);u=zss.SEL.ROW}q.selType=u;this.stopDragging();this.setDragging(new zss.SelDrag(q,u,v,s,h(M)?"l":"r"))}}else{if((E=zkS.parentByZSType(w,"SCorner",1))!=null){var x=this.getLastSelection(),p=0,K=0,R=this.maxCols-1,y=this.maxRows-1;if(p!=x.left||K!=x.top||R!=x.right||y!=x.bottom){this.moveCellSelection(p,K,R,y);this.selType=zss.SEL.ALL;this.stopDragging();this.setDragging(new zss.SelDrag(q,this.selType,0,0,h(M)?"l":"r"))}}}}}}}}this._lastmdstr=this._lastmdstr+"_"+v+"_"+s},_doMouseup:function(n){if(this.isAsync()){return}if(h(n)&&this._lastmdelm&&zkS.parentByZSType(this._lastmdelm,["SCell","SHighlight","SSelInner","SHyperlink"],1)!=null){this._doMouseclick(n,"lc",this._lastmdelm)}this._lastmdelm=null},_doMouseleftclick:function(n){if(this.isAsync()){return}this._doMouseclick(n,"lc");n.stop()},_doMouserightclick:function(n){if(this.isAsync()){return}var o=this.dp;if(typeof o.selectFocustagId=="number"){window.clearTimeout(o.selectFocustagId);delete o.selectFocustagId;o.selectFocustag()}this._doMouseclick(n,"rc");n.stop()},_doMousedblclick:function(n){if(this.isAsync()){return}this._doMouseclick(n,"dbc");n.stop()},getStyleMenupopup:function(){var n=this._styleMenupopup;if(!n){var o=this._wgt;n=this._styleMenupopup=new zss.MenupopupFactory(o).style();n.setDisabled(o.getActionDisabled());this.appendChild(n)}return n},getRowHeaderMenupopup:function(){var n=this._rowHeaderMenupopup;if(!n){var o=this._wgt;n=this._rowHeaderMenupopup=new zss.MenupopupFactory(o).rowHeader();n.setDisabled(o.getActionDisabled());n._zssType="row"}return n},showRowHeaderMenu:function(p,o){var n=this._wgt.isShowContextMenu();if(n){var q=this.getRowHeaderMenupopup();this.openStyleMenupopup(p,o,q)}},getColumnHeaderMenupopup:function(){var n=this._columnHeaderMenupopup;if(!n){var o=this._wgt;n=this._columnHeaderMenupopup=new zss.MenupopupFactory(this._wgt).columnHeader();n.setDisabled(o.getActionDisabled());n._zssType="col"}return n},showColumnHeaderMenu:function(p,o){var n=this._wgt.isShowContextMenu();if(n){var q=this.getColumnHeaderMenupopup();this.openStyleMenupopup(p,o,q)}},getCellMenupopup:function(){var n=this._cellMenupopup;if(!n){var o=this._wgt;n=this._cellMenupopup=new zss.MenupopupFactory(o).cell();n.setDisabled(o.getActionDisabled());n._zssType="cell"}return n},showCellContextMenu:function(p,o){var n=this._wgt.isShowContextMenu();if(n){var q=this.getCellMenupopup();q.updateItemState.call(q,{sheet:this,pageX:p,pageY:o});this.openStyleMenupopup(p,o,q)}},setActionDisabled:function(s){var p=this._wgt.isShowContextMenu();if(p&&s){var o=this.getCellMenupopup();if(o){o.setDisabled(s)}var r=this.getRowHeaderMenupopup();if(r){r.setDisabled(s)}var n=this.getColumnHeaderMenupopup();if(n){n.setDisabled(s)}var q=this.getStyleMenupopup();if(q){q.setDisabled(s)}}},openStyleMenupopup:function(n,t,s){n+=5;t-=85;t=t<0?0:t;var q=this.getStyleMenupopup(),r=this._wgt;var o=function(){q.getMenuContainer().appendChild(s);if(r.isProtect()&&!r.allowFormatCells){jq(q.getStyleContainer()).css("visibility","hidden")}else{jq(q.getStyleContainer()).css("visibility","visible")}jq(s.$n()).css("display","block");q.open(null,[n,t]);s.setVisible(true)};if(zk.ie<11){setTimeout(o,50)}else{o()}},runAfterMouseClick:function(o){var n=this._afterMouseClick;if(!n){n=this._afterMouseClick=[]}n.push(o)},doAfterMouseClick:function(){var n=this._afterMouseClick;if(n){var o;while(o=n.shift()){o()}this._afterMouseClick=null}},_doMouseclick:function(D,q,o){if(this._nfdown){if(this.selArea){this.selArea._stopHyperlink()}return}var r=this,w=r._wgt,v=(o)?o:D.domTarget,B,C=my=0,A=shy=0,u,s,t=zkS._getMouseData(D,this.comp),I="";this.innerClicking++;setTimeout(function(){if(r.innerClicking>0){r.innerClicking--}},0);if((B=zkS.parentByZSType(v,"SCell",0))!=null){var F=B,J=zk(r.comp).revisedOffset(),G=zk(F).revisedOffset();C=D.pageX;my=D.pageY;A=Math.round(C-J[0]);shy=Math.round(my-J[1]);var y=C-G[0],z=zss.SSheetCtrl._calCellPos(r,C,my,false);u=z[0];s=z[1];var n=this.getCell(u,s);if(n!=null&&n.merr){u=n.mert;s=n.merl}I="c_"+u+"_"+s;if(this._lastmdstr==I){if(q=="rc"){this.showCellContextMenu(C,my)}w.fireCellEvt(q,A,shy,t[2],u,s,C,my)}if(q=="lc"&&this.selArea){if(n!=null&&n.merr){var E;n=r.getCell(n.mert,n.merl);if(n&&(E=jq(n).find("a"))&&E.length>0){if(zkS.isOverlapByPoint(E,C,my)){v=E[0]}}}this.selArea._setHyperlinkElment(v);this.selArea._tryAndEndHyperlink(u,s,D)}}else{if((B=zkS.parentByZSType(v,"SRow",0))!=null){var F=B,J=zk(r.comp).revisedOffset(),G=zk(F).revisedOffset();C=D.pageX;my=D.pageY;A=Math.round(C-J[0]);shy=Math.round(my-J[1]);var y=C-G[0],z=zss.SSheetCtrl._calCellPos(r,C,my,false);u=z[0];s=z[1];var n=this.getCell(u,s);if(n!=null&&n.merr){u=n.mert;s=n.merl;v=n.comp}I="c_"+u+"_"+s;if(this._lastmdstr==I){w.fireCellEvt(q,A,shy,t[2],u,s,C,my)}if(q=="lc"&&this.selArea){this.selArea._setHyperlinkElment(v);this.selArea._tryAndEndHyperlink(u,s,D)}}else{if((B=zkS.parentByZSType(v,"SSelDot",1))!=null){}else{if((B=zkS.parentByZSType(v,[(zk.ie8&&zk.ie<11)?"SSelInner":"SSelect","SFocus","SHighlight"],1))!=null){var J=zk(r.comp).revisedOffset();C=D.pageX;my=D.pageY;A=Math.round(C-J[0]);shy=Math.round(my-J[1]);var z=zss.SSheetCtrl._calCellPos(r,C,my,false),p=z[4];u=z[0];s=z[1];var n=this.getCell(u,s);if(n!=null&&n.merr){u=n.mert;s=n.merl}if(q=="lc"&&this.selArea){this.selArea._tryAndEndHyperlink(u,s,D)}I="c_"+u+"_"+s;if(this._lastmdstr==I){if(q=="rc"){this.showCellContextMenu(C,my)}else{if(q=="dbc"){r._enterEditing(null)}}w.fireCellEvt(q,A,shy,t[2],u,s,C,my)}}else{if((B=zkS.parentByZSType(v,"STheader",1))!=null||(B=zkS.parentByZSType(v,"SLheader",1))!=null){var H=B,J=zk(r.comp).revisedOffset();C=D.pageX;my=D.pageY;A=Math.round(C-J[0]);shy=Math.round(my-J[1]);if(H.ctrl.type==zss.Header.HOR){u=-1;s=H.ctrl.index}else{u=H.ctrl.index;s=-1}I="h_"+u+"_"+s;if(this._lastmdstr==I){if(q==="rc"){if(H.ctrl.type=="V"){this.showRowHeaderMenu(C,my)}else{this.showColumnHeaderMenu(C,my)}}w.fireHeaderEvt(q,A,shy,t[2],u,s,C,my)}}}}}}this.doAfterMouseClick()},_sendOnCellFocus:function(p,n){var o=this._wgt;o.fire("onCellFocus",{sheetId:this.serverSheetId,row:p,col:n})},_sendOnCellSelection:function(p,r,q,o,n){this._wgt.fire("onCellSelection",{sheetId:this.serverSheetId,type:p,left:r,top:q,right:o,bottom:n})},_sendOnCellSelectionUpdate:function(t,q,o,u,v,n,r,w,p,s){this._wgt.fire("onCellSelectionUpdate",{sheetId:this.serverSheetId,type:t,action:q,left:o,top:u,right:v,bottom:n,orgileft:r,orgitop:w,orgiright:p,orgibottom:s})},_sendOnCellHyperlink:function(t,p,o,q,n){var s=this._wgt,r=zk.copy(n.data,{sheetId:this.serverSheetId,row:t,col:p,href:o,type:q});s.fire("onCellHyperlink",r,q==2||s.isListen("onCellHyperlink")?{toServer:true}:null)},_sendOnTextHeight:function(q,o,n){var p=this._wgt;p.fire("onZSSTextHeight",{sheetId:this.serverSheetId,row:q,col:o,height:n},{toServer:true})},_sendOnTextWidth:function(q,n,o){var p=this._wgt;p.fire("onZSSTextWidth",{sheetId:this.serverSheetId,row:q,col:n,width:o},{toServer:true})},_timeoutId:null,_fireOnOpenAndEdit:function(n){clearTimeout(this._timeoutId);this._timeoutId=setTimeout(this.proxy(this._onOpenAndEdit),n>=0?n:100)},_onOpenAndEdit:function(){this.dp._startEditing()},_doKeypress:function(n){if(this._skipress){return}var o=n.which,p=i(o==0&&n.keyCode==9?keyCode:o);if(p!=null&&!(n.altKey||n.ctrlKey)&&this.state!=zss.SSheetCtrl.EDITING){if(this.state==zss.SSheetCtrl.START_EDIT){this._clienttxt+=p}else{if(this.state==zss.SSheetCtrl.FOCUSED){if(this.dp.startEditing(n,p)){this._clienttxt=p}}}this._fireOnOpenAndEdit();n.stop()}},_enterIMEEditing:function(n){if(this.dp.startEditing(n,undefined,undefined,undefined,true)){this.dp._openEditbox("")}},_enterEditing:function(n){var o=this.getLastFocus();this.dp.startEditing(n,this.getCell(o.row,o.column).edit);this.dp._openEditbox()},_doKeydown:function(o){this._skipress=false;if(this.isAsync()){return}if(this._wgt._ctrlPasteDown){o.stop()}var n=o.keyCode,p;switch(n){case 33:this.dp.movePageup(o);o.stop();break;case 34:this.dp.movePagedown(o);o.stop();break;case 35:if(this.isAllowKeyNavigation()){this.dp.moveEnd(o)}break;case 36:if(this.isAllowKeyNavigation()){this.dp.moveHome(o)}break;case 37:if(this.isAllowKeyNavigation()){this.dp.moveLeft(o)}break;case 38:if(this.isAllowKeyNavigation()){this.dp.moveUp(o)}break;case 9:if(this.state==zss.SSheetCtrl.EDITING){if(o.altKey||o.ctrlKey){break}this.dp.stopEditing(o.shiftKey?"moveleft":"moveright");o.stop();break}if(o.shiftKey){this.dp.moveLeft();o.stop()}else{if(!(o.altKey||o.ctrlKey)){this.dp.moveRight();o.stop()}}break;case 39:var q=this.editingFormulaInfo;if(this.isAllowKeyNavigation()){this.dp.moveRight(o)}break;case 40:if(this.isAllowKeyNavigation()){this.dp.moveDown(o)}break;case 229:if(zk.ie&&zk.ie<10&&this.state==zss.SSheetCtrl.FOCUSED){this._enterIMEEditing(o)}break;case 113:if(this.state==zss.SSheetCtrl.FOCUSED){this._enterEditing(o)}o.stop();break;case 13:if(this.state==zss.SSheetCtrl.EDITING){if(o.altKey||o.ctrlKey){this.dp.getEditor().newLine();o.stop();break}this.dp.stopEditing("movedown");o.stop()}else{if(this.state==zss.SSheetCtrl.FOCUSED){if(!this._wgt._copysrc){this.dp.moveDown(o);o.stop()}}}break;case 27:if(this.state==zss.SSheetCtrl.EDITING){this.dp.cancelEditing();o.stop()}else{if(this.state==zss.SSheetCtrl.FOCUSED){}}break}if(!f(n)){this._skipress=true}},isAllowKeyNavigation:function(){var n=this.editingFormulaInfo;if((n&&!n.moveCell)||this.state==zss.SSheetCtrl.FOCUSED||this.enableKeyNavigation){return true}return false},pasteToSheet:function(){var p=this._wgt,n=this,o=function(){if(!p._doPasteFromServer){var r=n.dp.getInputNode(),q=jq(r).val(),s=n.dp._speedCopy(q);if(s){p._onResponseCallback.push(function(){n._doCellSelection(s.left,s.top,s.right,s.bottom)})}}if(n.isPasteFromClipboard){n.isPasteFromClipboard=null}};if(p._sendAu){p._onResponseCallback.push(o)}else{o()}},resizeTo:function(n,p){var q=this.comp;if(n){jq(q).css("width",n)}if(p){jq(q).css("height",p)}var o=this;setTimeout(function(){o._resize()},0)},_fixSize:function(){var o=this.comp,q=this.sp.comp,r=zk(o),u=r.offsetWidth(),p=r.offsetHeight();if(p<=0){p=100}var v=zkS._hasScrollBar(q)?zss.Spreadsheet.scrollWidth:0,x=zkS._hasScrollBar(q,true)?zss.Spreadsheet.scrollWidth:0,s=zk(this.dp.comp),n=Math.min(s.offsetWidth()-this.leftWidth,u-this.leftWidth-x),t=Math.min(s.offsetHeight()-this.topHeight,p-this.topHeight-v);this.tp._updateWidth(n);this.lp._updateHeight(t);this.sp._doScrolling()},getLastFocus:function(){if(!this.focusMark){return null}return new zss.Pos(this.focusMark.row,this.focusMark.column)},getLastSelection:function(){if(!this.selArea){return null}var n=this.selArea.lastRange;return !n?null:new zss.Range(n.left,n.top,n.right,n.bottom)},moveColumnSelection:function(p,o){if(!o&&o!=0){o=p}var n=p;if(p>o){p=o;o=n}this.moveCellSelection(p,0,o,this.maxRows-1)},moveRowSelection:function(p,o){if(!o&&o!=0){o=p}var n=p;if(p>o){p=o;o=n}this.moveCellSelection(0,p,this.maxCols-1,o)},setColumnWidth:function(n,o){this._setColumnWidth(n,o,true,true)},_setColumnsWidth:function(t,q,r,u,n,s,p){for(var o=t;o<=q;++o){this._setColumnWidth(o,r,u,n,s,p)}},_setColumnWidth:function(t,J,K,B,N,s){var A=this._wgt,Q=this.sheetid,r=this.custColWidth,x=this.custRowHeight,P=r.getSize(t);if(J<0){J=0}var E=r.getMeta(t),o;if(N===undefined){N=(J==0)}if(N){J=P}var v=this.cellPad,D,u=J-2*v;var q=false;if(u<0){q=true;u=J}D=J;var R=A.getSelectorPrefix(),G=A.getSheetCSSId(),z=".zs_header";if(zk.opera){z=true}if(!E){o=zkS.t(s)?s:r.ids.next();r.setCustomizedSize(t,J,o,N);this._appendZSW(t,o);this._wgt._cacheCtrl.getSelectedSheet().updateColumnWidthId(t,o)}else{o=zkS.t(s)?s:E[2];r.setCustomizedSize(t,J,o,N)}if(J<=0||N){zcss.setRule(R+" .zsw"+o,"display","none",z,G)}else{zcss.setRule(R+" .zsw"+o,["display","width"],["",D+"px"],z,G);zcss.setRule(R+" .zswi"+o,"width",u+"px",z,G);if(q){zcss.setRule(R+" .zsw"+o,"padding","0px",z,G)}else{zcss.setRule(R+" .zsw"+o,"padding","",z,G)}}var p=this.mergeMatrix.getRangesByColumn(t),H=p.length,F;for(var M=0;M<H;M++){F=p[M];var C=r.getStartPixel(F.right+1);C-=r.getStartPixel(F.left);var O=x.getStartPixel(F.bottom+1);O-=x.getStartPixel(F.top);u=C-2*v;q=false;if(u<0){q=true;u=C}D=C;if(C<=0||O<=0){zcss.setRule(R+" .zsmerge"+F.id,"display","none",true,G)}else{zcss.setRule(R+" .zsmerge"+F.id,"display","inline-block",true,G);zcss.setRule(R+" .zsmerge"+F.id,"width",jq.px0(D),true,G);zcss.setRule(R+" .zsmerge"+F.id+" .zscelltxt","width",jq.px0(u),true,G);if(q){zcss.setRule(R+" .zsmerge"+F.id,"padding","0px",true,G)}else{zcss.setRule(R+" .zsmerge"+F.id,"padding","",true,G)}}}var n=this.tp,L=n?n.getHeader(t):null;if(L){L.setColumnHeader(N)}if(t<this.maxCols){var I=this.dp;this.triggerOverflowColumn_(null,t+1,true);this.triggerRotateColumn_(null,t,true);if(this.frozenCol>=t){this.lp._fixSize();this.cp._fixSize()}if(!this._deferUS){this._deferUS=true;var y=this;setTimeout(function(){delete y._deferUS;I._fixSize(y.activeBlock);y._fixSize()},20)}this._wgt.syncWidgetPos(-1,t)}this._syncColFocusAndSelection(t);if(K){this._wgt.fire("onHeaderUpdate",{sheetId:this.serverSheetId,type:"top",action:"resize",index:t,size:J,id:o,hidden:N,custom:true},{toServer:true,sendAhead:true},25)}if(t<this.maxCols&&B){if(!this._deferL4V){this._deferL4V=true;var y=this;setTimeout(function(){delete y._deferL4V;y.activeBlock.loadForVisible();y._fixSize()},25)}}},_syncColFocusAndSelection:function(s){var o=this.getLastFocus(),q=o.column,p=this.getLastSelection(),r=p.left,n=p.right;if(s<=q){this.moveCellFocus(o.row,q)}if(s<=n){this.moveCellSelection(r,p.top,n,p.bottom)}},_syncRowFocusAndSelection:function(r){var n=this.getLastFocus(),q=n.row,o=this.getLastSelection(),s=o.top,p=o.bottom;if(r<=q){this.moveCellFocus(q,n.column)}if(r<=p){this.moveCellSelection(o.left,s,o.right,p)}},_appendZSW:function(n,o){this.activeBlock.appendZSW(n,o);this.cp.appendZSW(n,o);this.tp.appendZSW(n,o);this.lp.appendZSW(n,o)},_appendZSH:function(o,n){this.activeBlock.appendZSH(o,n);this.cp.appendZSH(o,n);this.tp.appendZSH(o,n);this.lp.appendZSH(o,n)},setRowHeight:function(o,n){this._setRowHeight(o,n,true,true,false,null,true)},_setRowsHeight:function(t,n,u,o,p,q,r,s){for(var v=t;v<=n;++v){this._setRowHeight(v,u,o,p,q,r,s)}},_setRowHeight:function(s,I,K,A,N,r,C){var y=this._wgt,P=this.sheetid,q=this.custColWidth,t=this.custRowHeight,n=t.getSize(s);I=I<=0?0:I;var Q="#"+P,E=t.getMeta(s),z;if(N===undefined){N=(I==0)}if(N){I=n}var p;if((zk.ie&&zk.ie<11)||zk.safari||zk.opera){p=I>0?I:0}else{p=I}if(!E){z=zkS.t(r)?r:t.ids.next();t.setCustomizedSize(s,I,z,N,C);this._appendZSH(s,z);this._wgt._cacheCtrl.getSelectedSheet().updateRowHeightId(s,z)}else{z=zkS.t(r)?r:E[2];t.setCustomizedSize(s,I,z,N,C)}var Q=y.getSelectorPrefix(),G=y.getSheetCSSId(),x=".zs_header";if(zk.opera){x=true}if(I<=0||N){zcss.setRule(Q+" .zsh"+z,"height","0px",x,G);zcss.setRule(Q+" .zshi"+z,["height","border-bottom-width","overflow"],["0px","0px","hidden"],x,G);zcss.setRule(Q+" .zslh"+z,["height","line-height","border-bottom-width"],["0px","0px","0px"],x,G);zcss.setRule(Q+" .zshr"+z,["max-height"],["0px"],x,G)}else{zcss.setRule(Q+" .zsh"+z,"height",I+"px",x,G);zcss.setRule(Q+" .zshi"+z,["height","border-bottom-width","overflow"],[p+"px","1px",""],x,G);zcss.setRule(Q+" .zslh"+z,["height","line-height","border-bottom-width"],[I+"px",I+"px","1px"],x,G);zcss.setRule(Q+" .zshr"+z,["max-height"],[I+"px"],x,G)}var o=this.mergeMatrix.getRangesByRow(s),H=o.length,F;for(var M=0;M<H;M++){F=o[M];var O=t.getStartPixel(F.bottom+1);O-=t.getStartPixel(F.top);var B=q.getStartPixel(F.right+1);B-=q.getStartPixel(F.left);celltextheight=O;p=(zk.ie&&zk.ie<11)||zk.safari||zk.opera?celltextheight:O;if(O<=0||B<=0){zcss.setRule(Q+" .zsmerge"+F.id,"display","none",true,G)}else{zcss.setRule(Q+" .zsmerge"+F.id,"display","inline-block",true,G);zcss.setRule(Q+" .zsmerge"+F.id,"height",jq.px0(p),true,G);zcss.setRule(Q+" .zsmerge"+F.id+" .zscelltxt","height",jq.px0(celltextheight),true,G);zcss.setRule(Q+" .zsmerge"+F.id,"border-bottom-width","1px",true,G)}}var v=this.lp,L=v?v.getHeader(s):null;if(L){L.setRowHeader(N)}if(s<this.maxRows){var J=this.dp;var D=this.frozenRow;if(D>=s){this.tp._fixSize();this.cp._fixSize()}if(!this._deferUS){this._deferUS=true;var u=this;setTimeout(function(){delete u._deferUS;J._fixSize(u.activeBlock);u._fixSize()},20)}this._wgt.syncWidgetPos(s,-1)}this._syncRowFocusAndSelection(s);this.fire("onRowHeightChanged",{row:s});if(K){this._wgt.fire("onHeaderUpdate",{sheetId:this.serverSheetId,type:"left",action:"resize",index:s,size:I,id:z,hidden:N,custom:C},{toServer:true,sendAhead:true},25)}if(s<this.maxRows&&A){if(!this._deferL4V){this._deferL4V=true;var u=this;setTimeout(function(){delete u._deferL4V;u.activeBlock.loadForVisible();u._fixSize()},25)}}},_updateText:function(o){var n=this.activeBlock.getCell(o.r,o.c);if(n){n.setText(o.val,true)}},update_:function(r,p){var n=this.cp.block;var o=this.tp.block;var q=this.lp.block;var s;this.activeBlock.update_(r.t,r.l,r.b,r.r,p);if(n&&r.cornerFrozen){s=r.cornerFrozen;n.update_(s.t,s.l,s.b,s.r,p)}if(o&&r.topFrozen){s=r.topFrozen;o.update_(s.t,s.l,s.b,s.r,p)}if(q&&r.leftFrozen){s=r.leftFrozen;q.update_(s.t,s.l,s.b,s.r,p)}},_updateHeaderSelectionCss:function(p,n){var s=p.top,o=p.bottom,r=p.left,q=p.right;this.tp.updateSelectionCSS(r,q,n);this.lp.updateSelectionCSS(s,o,n);if(this.cp.tp){this.cp.tp.updateSelectionCSS(r,q,n)}if(this.cp.lp){this.cp.lp.updateSelectionCSS(s,o,n)}},setDisplayGridlines:function(n){var p=this._wgt,o=n?"":"#FFFFFF";zcss.setRule(p.getSelectorPrefix()+" .zscell",["border-bottom-color","border-right-color"],[o,o],true,p.getSheetCSSId());this.fireDisplayGridlines(n)},deferFireCellSelection:function(s,r,q,p){var t=this._fireCellSelectionId,o=this,n=this._skipInsertCellRef;if(t){clearTimeout(t)}this._fireCellSelectionId=setTimeout(function(){o.fire("onCellSelection",{left:s,top:r,right:q,bottom:p,skipInsertCellRef:n})},50)},moveCellSelection:function(q,y,D,v,A,x){var o=this.selArea.lastRange;if(o){this._updateHeaderSelectionCss(o,true)}var G=!(this.state==zss.SSheetCtrl.NOFOCUS);if(A){var u=D,w=q;for(var z=v;z>=y;--z){var F=this.getCell(z,u);if(F&&F.merr>u){u=F.merr}var n=this.getCell(z,w);if(n&&n.merl<w){w=n.merl}}D=u;q=w;var B=v,t=y;for(var E=u;E>=w;--E){var s=this.getCell(B,E);if(s&&s.merb>B){B=s.merb}var C=this.getCell(t,E);if(C&&C.mert<t){t=C.mert}}v=B;y=t}else{var p=this.getCell(y,q);if(y==v&&p){if(p.merr>D){D=p.merr}if(p.merb>v){v=p.merb}}}if(!this.isRangeSelectable(q,y,D,v)){return}var H=new zss.Range(q,y,D,v);this.state==zss.SSheetCtrl.START_EDIT?this.fire("onCellSelection",{left:q,top:y,right:D,bottom:v}):this.deferFireCellSelection(q,y,D,v);this.selArea.relocate(H);if(G){this._updateHeaderSelectionCss(H,false);this.selArea.showArea()}if(this.tp.selArea){this.tp.selArea.relocate(H);if(G){this.tp.selArea.showArea()}}if(this.lp.selArea){this.lp.selArea.relocate(H);if(G){this.lp.selArea.showArea()}}if(this.cp.selArea){this.cp.selArea.relocate(H);if(G){this.cp.selArea.showArea()}}if(!x){this._prepareCopy()}},isRangeSelectable:function(s,r,q,n){var t=this._wgt;if(!t.isProtect()||t.allowSelectLockedCells){return true}if(!t.allowSelectUnlockedCells){return false}for(var p=r;p<=n;p++){for(var o=s;o<=q;o++){if(this.isCellLocked(p,o)){return false}}}return true},isHeaderSelectable:function(n,o){var p=this._wgt;if(!p.isProtect()||p.allowSelectLockedCells){return true}if(!p.allowSelectUnlockedCells){return false}if(!p.unlockInfo){return false}if(o==zss.Header.HOR){if(a(p.unlockInfo.chs,n)){return true}}else{var r=p.unlockInfo.rhs;for(var q in r){if(r[q]==n){return true}}}return false},isCellLocked:function(p,n){var o=this._wgt.unlockInfo;if(!o){return true}for(var q in o.cs){if(o.cs[q].i==p){if(a(o.cs[q].data,n)){return false}if(a(o.cs[q].lockData,n)){return true}}}if(a(o.chs,n)){return false}for(var q in o.rhs){if(o.rhs[q]==p){return false}}return true},_prepareCopy:function(){var t=this._wgt._cacheCtrl.getSelectedSheet(),s=this.getLastSelection(),v=s.top,p=Math.min(s.bottom,s.top+zss.clientCopy.maxRowCount-1),q=s.left,y=Math.min(s.right,s.left+zss.clientCopy.maxColumnCount-1),B="";if(t){var A=t.rows;for(var n=v;n<=p;++n){var z=A[n];for(var u=q;u<=y;++u){var o="";if(z){var x=z.cells[u];if(x){o=x.formatText}}B+=o;if(u<y){B+="\t"}}B+="\n"}}else{for(var n=v;n<=p;++n){for(var u=q;u<=y;++u){var x=this.getCell(n,u),o=!x?null:x.getPureText();if(o!=null){B+=o}if(u<y){B+="\t"}}B+="\n"}}if(this.state!=zss.SSheetCtrl.FOCUSED){return}var w=this.dp.getInputNode();jq(w).val(B);this.dp.deferSelectFocustag()},hideCellSelection:function(){this.selArea.hideArea();if(this.tp.selArea){this.tp.selArea.hideArea()}if(this.lp.selArea){this.lp.selArea.hideArea()}if(this.cp.selArea){this.cp.selArea.hideArea()}var n=this.selArea.lastRange;if(n){this._updateHeaderSelectionCss(n,true)}},showCellSelection:function(){this.selArea.showArea();if(this.tp.selArea){this.tp.selArea.showArea()}if(this.lp.selArea){this.lp.selArea.showArea()}if(this.cp.selArea){this.cp.selArea.showArea()}var n=this.selArea.lastRange;if(n){this._updateHeaderSelectionCss(n,true)}},moveSelectionChange:function(r,q,p,o){var n=new zss.Range(r,q,p,o);this.selChgArea.relocate(n);this.selChgArea.showArea();if(this.tp.selChgArea){this.tp.selChgArea.relocate(n);this.tp.selChgArea.showArea()}if(this.lp.selChgArea){this.lp.selChgArea.relocate(n);this.lp.selChgArea.showArea()}if(this.cp.selChgArea){this.cp.selChgArea.relocate(n);this.cp.selChgArea.showArea()}},hideSelectionChange:function(){this.selChgArea.hideArea();if(this.tp.selChgArea){this.tp.selChgArea.hideArea()}if(this.lp.selChgArea){this.lp.selChgArea.hideArea()}if(this.cp.selChgArea){this.cp.selChgArea.hideArea()}},moveCellFocus:function(r,p,q){var o=!(this.state==zss.SSheetCtrl.NOFOCUS),n=this.getCell(r,p);if(n&&n.merl<p){p=n.merl;r=n.mert}this.focusMark.relocate(r,p);if(!q){this.fire("onFocused",{row:r,col:p})}if(o){this.focusMark.showMark()}if(this.tp.focusMark){this.tp.focusMark.relocate(r,p);if(o){this.tp.focusMark.showMark()}}if(this.lp.focusMark){this.lp.focusMark.relocate(r,p);if(o){this.lp.focusMark.showMark()}}if(this.cp.focusMark){this.cp.focusMark.relocate(r,p);if(o){this.cp.focusMark.showMark()}}},hideCellFocus:function(){this.focusMark.hideMark();if(this.tp.focusMark){this.tp.focusMark.hideMark()}if(this.lp.focusMark){this.lp.focusMark.hideMark()}if(this.cp.focusMark){this.cp.focusMark.hideMark()}},_realRight:function(s,o,p){var n=p;for(var q=o;q>=s;--q){var t=this.getCell(q,n);if(t&&t.merl<n){n=t.merl}}return n},_realBottom:function(r,p,o){var q=o;for(var s=p;s>=r;--s){var n=this.getCell(q,s);if(n&&n.mert<q){q=n.mert}}return q},_realLeft:function(t,n,s){var p=s;for(var q=n;q>=t;--q){var o=this.getCell(q,p);if(o&&o.merr>p){p=o.merr}}return p},_realTop:function(q,n,p){var r=p;for(var s=n;s>=q;--s){var o=this.getCell(r,s);if(o&&o.merb>r){r=o.merb}}return r},shiftSelection:function(I){var y=this.getLastSelection(),w=this.getLastFocus(),x=w.row,u=w.column,s=y.left,G=y.top,H=y.right,A=y.bottom,B=false,z=this.custRowHeight,r=this.custColWidth,v=this.selType?this.selType:zss.SEL.CELL;switch(I){case"up":A=this._realBottom(s,H,A);if(x<A){var F=z.getDecUnhidden(A-1,0);if(F>=0){A=F}}else{var o=z.getDecUnhidden(G-1,0);if(o>=0){G=o}}break;case"down":G=this._realTop(s,H,G);if(x>G){var o=z.getIncUnhidden(G+1,this.maxRows-1);if(o>=0){G=o}}else{var F=z.getIncUnhidden(A+1,this.maxRows-1);if(F>=0){A=F}}break;case"left":H=this._realRight(G,A,H);if(u<H){var E=r.getDecUnhidden(H-1,0);if(E>=0){H=E}}else{var C=r.getDecUnhidden(s-1,0);if(C>=0){s=C}}break;case"right":s=this._realLeft(G,A,s);if(u>s){var C=r.getIncUnhidden(s+1,this.maxCols-1);if(C>=0){s=C}}else{var E=r.getIncUnhidden(H+1,this.maxCols-1);if(E>=0){H=E}}break;case"home":H=u;s=r.getIncUnhidden(0,H);if(v==zss.SEL.ALL){v=zss.SEL.COL}else{if(v==zss.SEL.ROW){v=zss.SEL.CELL}}break;case"end":s=u;H=r.getDecUnhidden(this.maxCols-1,s);if(s==0){if(v==zss.SEL.COL){v=zss.SEL.ALL}else{if(v==zss.SEL.CELL){v=zss.SEL.ROW}}}break;case"pgup":if(x<A){var F=A-this.pageKeySize;if(F<0){F=0}var p=F>0?z.getDecUnhidden(F,0):z.getIncUnhidden(F,A);if(p<0){p=z.getIncUnhidden(F,A)}A=p;if(A<x){G=A;A=x}}else{var o=G-this.pageKeySize;if(o<0){o=0}var D=o>0?z.getDecUnhidden(o,0):z.getIncUnhidden(o,G);if(D<0){D=z.getIncUnhidden(o,G)}G=D}break;case"pgdn":if(x>G){var o=G+this.pageKeySize;if(o>this.maxRows-1){o=this.maxRows-1}var D=o<this.maxRows-1?z.getIncUnhidden(o,this.maxRows-1):z.getDecUnhidden(o,G);if(D<0){D=z.getDecUnhidden(o,G)}G=D;if(G>x){A=G;G=x}}else{var F=A+this.pageKeySize;if(F>this.maxRows-1){F=this.maxRows-1}var p=F<this.maxRows-1?z.getIncUnhidden(F,this.maxRows-1):z.getDecUnhidden(F,A);if(p<0){p=z.getDecUnhidden(F,A)}A=p}break;default:this.selType=v;return}if(s<0){s=0}if(H>=this.maxCols){H=this.maxCols-1}if(G<0){G=0}if(A>=this.maxRows){A=this.maxRows-1}var t=(A>x)?A:G;var q=(H>u)?H:s;this.sp.scrollToVisible(t,q);this.activeBlock.loadCell(t,q,5);if(s!=y.left||G!=y.top||H!=y.right||A!=y.bottom){this.moveCellSelection(s,G,H,A,true);var n=this.getLastSelection();if(n.left!=y.left||n.top!=y.top||n.right!=y.right||n.bottom!=y.bottom){this.selType=v;this._sendOnCellSelection(v,n.left,n.top,n.right,n.bottom)}}},moveHighlight:function(r,q,p,o){var n=this.hlArea.show;if(r<0||q<0||p<0||o<0){this.hideHighlight();return}var s=new zss.Range(r,q,p,o);this.hlArea.relocate(s);this.hlArea.show=true;this.hlArea.showArea();if(this.tp.hlArea){this.tp.hlArea.relocate(s);if(n){this.tp.hlArea.showArea()}}if(this.lp.hlArea){this.lp.hlArea.relocate(s);if(n){this.lp.hlArea.showArea()}}if(this.cp.hlArea){this.cp.hlArea.relocate(s);if(n){this.cp.hlArea.showArea()}}},getLastHighlight:function(){var n=this.hlArea.lastRange;return !n?null:new zss.Range(n.left,n.top,n.right,n.bottom)},isHighlightVisible:function(){return this.hlArea.isVisible()},hideHighlight:function(n){if(n){this.hlArea.lastRange=new zss.Range(-1,-1,-1,-1)}this.hlArea.hideArea();if(this.tp.hlArea){this.tp.hlArea.hideArea()}if(this.lp.hlArea){this.lp.hlArea.hideArea()}if(this.cp.hlArea){this.cp.hlArea.hideArea()}},animateHighlight:function(n){this.hlArea.doAnimation(n);if(this.tp.hlArea){this.tp.hlArea.doAnimation(n)}if(this.lp.hlArea){this.lp.hlArea.doAnimation(n)}if(this.cp.hlArea){this.cp.hlArea.doAnimation(n)}},showInfo:function(o,n){this.info.setInfoText(o);this.info.showInfo(n)},hideInfo:function(){this.info.hideInfo()},showMask:function(o,n){jq(this.maskcmp).css("visibility",o?"visible":"hidden");if(n){jq(this._wgt.$n("masktxt")).text(n)}},getFocusedCell:function(){var n=this.getLastFocus();return this.getCell(n.row,n.column)},getCell:function(u,p){var r=this.frozenRow,o=this.frozenCol,n=null;if(u<=r&&p<=o){var s=this.cp;n=s&&s.block?s.block.getCell(u,p):null}else{if(r>=0&&u<=r){var t=this.tp;n=t&&t.block?t.block.getCell(u,p):null}else{if(o>=0&&p<=o){var q=this.lp;n=q&&q.block?q.block.getCell(u,p):null}else{n=this.activeBlock.getCell(u,p)}}}return n},getRow:function(r,o){var q=this.frozenRow,n=this.frozenCol,p=[];if(r<=q){if(o<=n){p.push(this.cp.block.getRow(r))}p.push(this.tp.block.getRow(r))}else{if(o<=n){p.push(this.lp.block.getRow(r))}p.push(this.activeBlock.getRow(r))}return p},sendSyncblock:function(o){var r=this.sp.comp,s=this.dp,p=this.activeBlock.range,n=this._wgt._cacheCtrl.getSelectedSheet();if(!n){return}var q=this._wgt._cacheCtrl.getSelectedSheet().rect;this._wgt.fire("onZSSSyncBlock",{sheetId:this.sheetid,dpWidth:-1,dpHeight:-1,viewWidth:-1,viewHeight:-1,blockLeft:p.left,blockTop:p.top,blockRight:p.right,blockBottom:p.bottom,fetchLeft:-1,fetchTop:-1,fetchWidth:-1,fetchHeight:-1,rangeLeft:q.left,rangeTop:q.top,rangeRight:q.right,rangeBottom:q.bottom},o?{toServer:true}:null,(o?25:-1));if(zk.ie&&zk.ie==9){this.sp._resetIE9ScrollPosition()}},_insertNewColumn:function(p,q,o){this.activeBlock.insertNewColumn(p,q);var n=this.frozenCol;if(p<=n){this.lp.insertNewColumn(p,q);this.cp.insertNewColumn(p,q,o)}this.tp.insertNewColumn(p,q,o)},_insertNewRow:function(q,o,n){this.activeBlock.insertNewRow(q,o);var p=this.frozenRow;if(q<=p){this.tp.insertNewRow(q,o);this.cp.insertNewRow(q,o,n)}this.lp.insertNewRow(q,o,n)},_removeColumn:function(p,q,o){this.activeBlock.removeColumn(p,q);var n=this.frozenCol;if(p<=n){this.lp.removeColumn(p,q);this.cp.removeColumn(p,q,o)}this.tp.removeColumn(p,q,o)},_removeRow:function(q,o,n){this.activeBlock.removeRow(q,o);var p=this.frozenRow;if(q<=p){this.tp.removeRow(q,o);this.cp.removeRow(q,o,n)}this.lp.removeRow(q,o,n)},_syncMergeRange:function(o){var u=this.getLastFocus();var s=this._removeMergeRangeX,t=o.rects;this.mergeMatrix.removeAllMergeRange(this,s);for(var p=0,q=t.length;p<q;++p){var v=t[p];this._addMergeRangeX(v)}if(!(this.state==zss.SSheetCtrl.NOFOCUS)&&u){var n=u.column,r=u.row;this.moveCellSelection(n,r,n,r,false,true);this.moveCellFocus(r,n)}},_removeMergeRange:function(n){var o=n.id;this.mergeMatrix.removeMergeRange(o);this._removeMergeRangeX(n)},_removeMergeRangeX:function(y){var p=y.id,r=y.left,w=y.top,x=y.right,n=y.bottom,s=this.sheetid,u=s+"-sheet"+((zk.opera)?"-opera":""),o="#"+s,t=this.cp.block,v=this.tp.block,q=this.lp.block;zcss.removeRule(o+" .zsmerge"+p,u);zcss.removeRule(o+" .zsmerge"+p+" .zscelltxt",u);this.activeBlock.removeMergeRange(p,r,w,x,n);if(t){t.removeMergeRange(p,r,w,x,n)}if(v){v.removeMergeRange(p,r,w,x,n)}if(q){q.removeMergeRange(p,r,w,x,n)}},_addMergeRange:function(n){this._addMergeRangeX(n);if(!(this.state==zss.SSheetCtrl.NOFOCUS)){var p=n.left,o=n.top;this.moveCellSelection(p,o,p,o,false,true);this.moveCellFocus(o,p)}},_addMergeRangeX:function(u){var z=u.id,o=u.left,x=u.top,E=u.right,r=u.bottom,A=u.width,y=u.height,q=this.cellPad,p=A-2*q,v=A,t=y,n=y,s=this._wgt,w=s.getSheetCSSId(),F=s.getSelectorPrefix(),B=this.cp.block,D=this.tp.block,C=this.lp.block;if(A<=0||y<=0){zcss.setRule(F+" .zsmerge"+z,"display","none",true,w);zcss.setRule(F+" .zsmerge"+z+" .zscelltxt","display","none",true,w)}else{zcss.setRule(F+" .zsmerge"+z,["width","height","display","border-bottom-width"],[v+"px",n+"px","inline-block","1px"],true,w);zcss.setRule(F+" .zsmerge"+z+" .zscelltxt",["width","height"],[p+"px",t+"px"],true,w)}this.mergeMatrix.addMergeRange(z,o,x,E,r);this.activeBlock.addMergeRange(z,o,x,E,r);if(B){B.addMergeRange(z,o,x,E,r)}if(D){D.addMergeRange(z,o,x,E,r)}if(C){C.addMergeRange(z,o,x,E,r)}},afterKeyDown_:function(n){var o=this._wgt;n.target=o;return o.afterKeyDown_(n,true)},redraw:function(r){var v=this._wgt,n=this.uuid,t=this.activeBlock,s=this.tp,q=this.lp,u=this.cp,o=v.isColumnHeadHidden(),p=v.isRowHeadHidden();r.push("<div "+this.domAttrs_()+'><textarea id="',n,'-fo" class="zsfocus"></textarea>','<div id="',n,'-mask" class="zssmask" zs.t="SMask"><div class="zssmask2"><div id="',n,'-masktxt" class="zssmasktxt" align="center"></div></div></div>','<div id="',n,'-sp" class="zsscroll" zs.t="SScrollpanel">','<div id="',n,'-dp" class="zsdata" zs.t="SDatapanel">','<div id="',n,'-datapad" class="zsdatapad"></div>');if(t){t.redraw(r)}r.push('<div id="',n,'-select" class="zsselect" zs.t="SSelect"><div id="',n,'-selecti" class="zsselecti" zs.t="SSelInner"></div><div class="zsseldot" zs.t="SSelDot"></div></div>','<div id="',n,'-selchg" class="zsselchg" zs.t="SSelChg"><div id="',n,'-selchgi" class="zsselchgi"></div></div>','<div id="',n,'-focmark" class="zsfocmark" zs.t="SFocus"><div id="',n,'-focmarki" class="zsfocmarki"></div></div>','<div id="',n,'-highlight" class="zshighlight" zs.t="SHighlight"><div id="',n,'-highlighti" class="zshighlighti" zs.t="SHlInner"></div></div>','</div><div id="',n,'-wp" class="zswidgetpanel" zs.t="SWidgetpanel"></div><div id="',n,'-pp" class="zspopuppanel"></div></div>');if(s){s.redraw(r)}if(q){q.redraw(r)}r.push(this.inlineEditor.redrawHTML_()+'<span id="',n,'-sinfo" class="zsscrollinfo"><span class="zsscrollinfoinner"></span></span>','<span id="',n,'-info" class="zsinfo"><span class="zsinfoinner"></span></span>');if(u){u.redraw(r)}r.push("</div>")},fire:function(q,p,n,o){if("onStopEditing"==q&&p!=undefined){this._updateCellDomText(p.row,p.col,p.value)}return this.$supers(zss.SSheetCtrl,"fire",arguments)},_updateCellDomText:function(p,o,n){if(this._updateBlockCellDomText(this.cp.block,p,o,n)){return}if(this._updateBlockCellDomText(this.tp.block,p,o,n)){return}if(this._updateBlockCellDomText(this.lp.block,p,o,n)){return}this._updateBlockCellDomText(this.activeBlock,p,o,n)},_updateBlockCellDomText:function(s,y,p,u){if(s){var o=s.range,q=o.left,x=o.top,n=o.right,v=o.bottom;if(q<=p&&p<=n&&x<=y&&y<=v){var w=s.getCell(y,p);if(w&&w.edit!=u){w.getTextNode().innerHTML=u}return true}}return false},isPercentCell:function(p,o){var n=this.getCell(p,o);if(n!=null){if(n.cellType==0&&n.text.endsWith("%")){return true}}return false}},{NOFOCUS:0,FOCUSED:2,START_EDIT:5,EDITING:6,STOP_EDIT:9,_initInnerComp:function(n,q){n.maskcmp=n.$n("mask");n.busycmp=n.$n("busy");n.spcmp=n.$n("sp");n.topcmp=n.$n("top");n.leftcmp=n.$n("left");n.wpcmp=n.$n("wp");n.sinfocmp=n.$n("sinfo");n.infocmp=n.$n("info");n.dp=new zss.DataPanel(n);n.sp=new zss.ScrollPanel(n);var p=n.$n("datapad");var o=n.$n("select");if(o.getAttribute("zs.t")=="SSelect"){n.selareacmp=o;n.selchgcmp=n.$n("selchg");n.focusmarkcmp=n.$n("focmark");n.hlcmp=n.$n("highlight");n.editorcmp=n.$n("eb");n.focusMark=new zss.FocusMarkCtrl(n,n.focusmarkcmp,n.initparm.focus.clone());n.selArea=new zss.SelAreaCtrl(n,n.selareacmp,n.initparm.selrange.clone());n.selChgArea=new zss.SelChgCtrl(n,n.selchgcmp);n.hlArea=new zss.Highlight(n,n.hlcmp,n.initparm.hlrange.clone(),"inner")}else{}n.sinfo=new zss.ScrollInfo(n,n.sinfocmp);n.info=new zss.Info(n,n.infocmp)},_getVisibleRange:function(x){if(zk.ie&&zk.ie==9){x.sp._resetIE9ScrollPosition()}var o=x.sp,u=o.comp,s=u.scrollLeft,p=u.scrollTop,y=x.custColWidth,B=x.custRowHeight,v=y.getStartPixel(x.frozenCol+1),w=B.getStartPixel(x.frozenRow+1),t=u.clientWidth-x.leftWidth,r=u.clientHeight-x.topHeight,q=y.getCellIndex(s+v)[0],z=B.getCellIndex(p+w)[0],A=y.getCellIndex(s+t)[0],n=B.getCellIndex(p+r)[0];if(q>x.maxCols-1){q=x.maxCols-1}if(z>x.maxRows-1){z=x.maxRows-1}if(A>x.maxCols-1){A=x.maxCols-1}if(n>x.maxRows-1){n=x.maxRows-1}return new zss.Range(q,z,A,n)},_calCellPos:function(s,B,v,z){var D=col=-1,w=zk(s.dp.comp).revisedOffset(),t=s.custColWidth,E=s.custRowHeight,o=B,n=v,A=s.frozenRow,r=s.frozenCol;if(!z&&(A>-1||r>-1)){var q=zk(s.comp).revisedOffset(),p=fy=-1;if(r>-1){p=t.getStartPixel(r+1)}if(A>-1){fy=E.getStartPixel(A+1)}o=B-q[0]-s.leftWidth;n=v-q[1]-s.topHeight;if(o>p&&n>fy){o=B-w[0]-s.leftWidth;n=v-w[1]-s.topHeight}else{if(n>fy){n=v-w[1]-s.topHeight}else{if(o>p){o=B-w[0]-s.leftWidth}}}}else{o=B-w[0]-s.leftWidth;n=v-w[1]-s.topHeight}var C=t.getCellIndex(o),u=E.getCellIndex(n);return[u[0],C[0],o,n,C[1],u[1]]}})})();
/*
ss.js

{{IS_NOTE
	Purpose:
		
	Description:
		
	History:
		January 10, 2008 4:58:31 PM , Created by Dennis Chen
}}IS_NOTE

Copyright (C) 2008 Potix Corporation. All Rights Reserved.

{{IS_RIGHT
	This program is distributed under GPL Version 2.0 in the hope that
	it will be useful, but WITHOUT ANY WARRANTY.
}}IS_RIGHT
*/


/* common method */
zkS = {};

/**
 * a util method to check if(val || val==0), in many case of attribute, 
 * i want if scentance pass even val=0
 */
zkS.t = function (val) {
	return val || val === 0;
};

zkS._delayInit = false;/*should i init header and cell by dealy bath*/
zkS._delayQ = [];//delay and batch invoke queue
zkS._delayBatchSize = 50;
zkS._delaySched = false;
zkS.addDelayBatch = function(fn, front, arg0, arg1){
	if (front) {
		zkS._delayQ.unshift([fn, arg0, arg1]);
	} else {
		zkS._delayQ.push([fn, arg0, arg1]);
	}
	if (!zkS._delaySched) {
		zkS._delaySched = true;
		setTimeout(zkS._doDelayBatch, 250);
	}
};


zkS._doDelayBatch = function () {
	zkS._delaySched = false;	
	var size = zkS._delayQ.length;
	size = zkS._delayBatchSize > size ? size : zkS._delayBatchSize;
	var batch;

	for (var i = 0; i < size; i++) {
		batch = zkS._delayQ.shift();
		batch[0].call(this,batch[1], batch[2]);
	}
	batch = null;
	if (zkS._delayQ.length > 0 && !zkS._delaySched) {
		zkS._delaySched = true;
		setTimeout(zkS._doDelayBatch, 100);
	}
};


/* method that handle round-trip (a method needs be call after client -> server -> client )function*/
zkS._callbacks = {};
zkS._cbtoken = 0;
/**
 * 
 * @param {Object} fn
 * @param {Object} arg0
 * @param {Object} arg1
 * @return a round-trip token
 */
zkS.addCallback = function(fn, arg0, arg1){
	var token = (zkS._cbtoken++) + '';
	zkS._callbacks[token] = [fn, arg0, arg1];
	if(zkS._cbtoken > 9999) zkS._cbtoken = 0;
	return  token;
};
zkS.removeCallback = function (token) {
	var r = zkS._callbacks[token];
	if (r)
		delete zkS._callbacks[token];
};
zkS.doCallback = function (token) {
	var r = zkS._callbacks[token];
	if (r) {
		delete zkS._callbacks[token];
		r[0].call(this, r[1], r[2]);
	}
};

zkS.parentByZSType = function(el, type, pathlen) {
	if (el) {
		if (!(type instanceof Array))
			type = [type];
		var i = 0,
			size = type.length, 
			n = el;
		for(; !!n; n = n.parentNode) {
			if (!n.attributes) 
				continue;
			j = size;
			while (j--) {
				if (n.getAttribute('zs.t') == type[j])
					return n;
			}
			if (pathlen && i++ > pathlen)
				break;
		}
	}
	return null;
};

zkS.copyParm = function (src, dest, parms) {
	var i = parms.length;
	while(i--)
		dest[parms[i]] = src[parms[i]];	
};

/** Returns the data for onClick. */
zkS._getMouseData = function (evt, target) {
	var extra = "";
	if (evt.altKey) extra += "a";
	if (evt.ctrlKey) extra += "c";
	if (evt.shiftKey) extra += "s";
	
	var ofs = zk(target).cmOffset(target),
		x = evt.pageX - ofs[0],
		y = evt.pageY - ofs[1];

	return [x, y, extra];
};


zkS.isEvtKey = function (evt, flag) {
	if (evt && ((flag.indexOf("a") != -1 && evt.altKey) || 
		(flag.indexOf("c") != -1 && evt.ctrlKey) ||
		(flag.indexOf("s") !=- 1 && evt.shiftKey) )) return true;
	return false;
};


/**
 * check to see if cmp has scroll bar
 * @param {Object} cmp component to check
 * @param {Object} vert false to check horizontal, true for vertical
 * @return true or false.
 */
zkS._hasScrollBar = function (cmp, vert) {
	var off,
		client;
	if(vert){
		off = cmp.offsetWidth;
		client = cmp.clientWidth;
	}else{
		off = cmp.offsetHeight;
		client = cmp.clientHeight;  
	}
	return (off - client) > 3 ? true : false;
};

zkS._enterChar = String.fromCharCode(13);

/**
 * check if point(x, y) is overlap to element
 * @param element a dom element
 * @param x x of upper left corner
 * @param y y of upper left corner
 * @returns true or false
 */
zkS.isOverlapByPoint = function(element, x, y) {
	var zkElement = zk(element),
		offset = zkElement.revisedOffset(),
		x1 = offset[0],
		y1 = offset[1],
		x2 = x1 + zkElement.offsetWidth(),
		y2 = y1 + zkElement.offsetHeight();
	return x >= x1 && x <= x2 && y >= y1 && y <= y2;
}

//ZSS-1214
zkS._ZERO = '0'.charAt(0);
zkS._NINE = '9'.charAt(0);
// Returns whether the character provided is a single digit
zkS.isSingleDigit = function(val) {
	if (val === undefined || val.length != 1) {
		return false;
	}
	var char = val.charAt(0);
	return zkS._ZERO <= char && char <= zkS._NINE;
}


zss.Util=zk.$extends(zk.Object,{},{_vpts:{},$parent:function(b){var a=zss.Util._vpts[b.id];return a?a:b.parentNode}});
zcss={p2saReg:/(-[a-z])/gi};zcss.nonNegativeAttr=["width","height"];zcss.getSSheet=function(b){var a=document.getElementById(b);if(a&&a.type=="text/css"){return zcss._getElementSheet(a)}return null};zcss.findRule=function(a,e){var c;if(e){c=zcss.getSSheet(e);if(!c){return null}c=[c]}else{c=document.styleSheets}for(var b=c.length-1;b>=0;b--){var d=zcss._findRuleInStyleSheet(a,c[b]);if(d){return d}}return null};zcss._findRuleInStyleSheet=function(a,d){var e=zcss._matchRule(a,d);if(e){return e}var b=d.imports;if(b){for(var c=b.length;--c>=0;){e=zcss._findRuleInStyleSheet(a,b[c]);if(e){return e}}}return null};zcss._matchRule=function(a,c){var e=zcss._getSSRules(c);if(e){for(var b=e.length-1;b>=0;b--){var d=e[b];if(a.toLowerCase()==d.selectorText.toLowerCase()){return d}}}return null};zcss._findRuleIndex=function(e,a){var d=zcss._getSSRules(e);if(!d){return -1}for(var b=d.length-1;b>=0;b--){var c=d[b];if(a.toLowerCase()==c.selectorText.toLowerCase()){return b}}return -1};zcss.addRule=function(c,f,b,h){var a;if(b){a=zcss.getSSheet(b);if(!a){return null}}else{a=document.styleSheets;a=a[a.length-1]}var j=zcss._getSSRules(a);if(!j){return null}var e;if(a&&h&&typeof h=="string"){e=zcss._findRuleIndex(a,h);if(e<0){e=j.length}}else{e=j.length}if(!(c instanceof Array)){var g=zcss._insertRule2Sheet(a,c,(f?f:""),e);return g}else{var j=[],k=c.length;for(var d=0;d<k;d++){j[d]=zcss._insertRule2Sheet(a,c[d],(f?f:""),e);e++}return j}};zcss.setRule=function(c,a,h,f,b){if(!(c instanceof Array)){c=[c]}var k=false;for(var e=0;e<c.length;e++){var g=zcss.findRule(c[e],b);if(!g&&f){g=zcss.addRule(c[e],"",b,f)}if(g){if(a instanceof Array){for(var d=0;d<a.length;d++){zcss._setRuleProperty(g,a[d],h[d])}}else{zcss._setRuleProperty(g,a,h)}k=true}else{k=false}}return k};zcss.removeRule=function(a,c){if(!c){return}var b=zcss.getSSheet(c);if(!b){return}if(!(a instanceof Array)){a=[a]}zcss._removeRulesFromSheet(b,a)};zcss._porp2attr=function(a){return a.$camel()};zcss._getSSRules=function(){if((zk.ie&&zk.ie<11)||zk.safari){return function(a){return a.rules}}else{return function(b){try{return b.cssRules}catch(a){return null}}}}();zcss._getElementSheet=function(){if(zk.ie&&zk.ie<11){return function(a){return a.styleSheet}}else{return function(a){return a.sheet}}}();zcss._insertRule2Sheet=function(){if(zk.ie&&zk.ie<11){return function(d,a,c,b){d.addRule(a,"{"+c+"}",b);return d.rules[b]}}if(zk.opera){return function(e,b,d,c){var a=e.cssRules.length;e.insertRule(b+" {"+d+"}",c);return e.cssRules[c]}}else{return function(d,a,c,b){d.insertRule(a+"{"+c+"}",b);return d.cssRules[b]}}}();zcss._removeRulesFromSheet=function(){if(zk.ie&&zk.ie<11){return function(e,c){var d=zcss._getSSRules(e);if(!d){return}for(var b=d.length-1;b>=0;b--){for(var a=c.length-1;a>=0;a--){if(c[a]==d[b].selectorText){e.removeRule(b);break}}}}}else{return function(e,c){var d=zcss._getSSRules(e);if(!d){return}for(var b=d.length-1;b>=0;b--){for(var a=c.length-1;a>=0;a--){if(c[a]==d[b].selectorText){e.deleteRule(b);break}}}}}}();zcss._setRuleProperty=function(){if(zk.ie&&zk.ie<11){return function(b,c,a){c=zcss._porp2attr(c);b.style[c]=a}}else{return function(b,c,a){b.style.setProperty(c,a,"")}}}();zcss._setStyleProperty=function(){if(zk.ie&&zk.ie<11){return function(b,d,c,a){if(zcss.nonNegativeAttr.$contains(d)&&typeof c=="string"&&c.indexOf("-")==0){c="0"+zcss._trimPrefixNumber(c)}d=zcss._porp2attr(d);b[d]=c}}else{return function(b,d,c,a){if(zcss.nonNegativeAttr.$contains(d)&&typeof c=="string"&&c.indexOf("-")==0){c="0"+zcss._trimPrefixNumber(c)}b.setProperty(d,c,"")}}}();zcss._trimPrefixNumber=function(c){var b=/[^-+0-9]/,a=c.search(b);if(a>0){return c.substr(a,c.length)}return c};zcss.setStyle=function(b,d,c){if(d instanceof Array){for(var a=0;a<d.length;a++){zcss._setStyleProperty(b.style,d[a],c[a],b)}}else{zcss._setStyleProperty(b.style,d,c,b)}};zcss.copyStyle=function(h,g,f,b){var e=f.length,c,a;for(var d=0;d<e;d++){a=zcss._porp2attr(f[d]);c=h.style[a];if(c){g.style[a]=c}else{if(b){g.style[a]=""}}}};

}finally{zk.setLoaded(zk._p.n);}});zk.setLoaded('zss',1);